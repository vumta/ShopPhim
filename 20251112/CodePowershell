Ho√†n to√†n ƒë∆∞·ª£c ‚úÖ ‚Äî m√¨nh s·∫Ω c·∫≠p nh·∫≠t script PowerShell ƒë·ªÉ:

1. Th√™m t√πy ch·ªçn -Silent ‚Üí khi ch·∫°y t·ª± ƒë·ªông (Task Scheduler ho·∫∑c mu·ªën ch·∫°y ng·∫ßm), kh√¥ng popup, ch·ªâ log.


2. D√πng toast notification thay cho popup b√¨nh th∆∞·ªùng ‚Üí nh·∫π nh√†ng, kh√¥ng c·∫£n thao t√°c c·ªßa b·∫°n.



M√¨nh s·∫Ω d√πng module BurntToast (c·∫ßn c√†i 1 l·∫ßn n·∫øu ch∆∞a c√≥) ƒë·ªÉ hi·ªán toast notification.


---

üíª Script PowerShell Final (v6) ‚Äì Toast + Silent mode

param(
    [switch]$Restore,
    [switch]$Silent
)

# ========================
# === CONFIG SECTION ====
# ========================
$padFolder   = "$env:USERPROFILE\Documents\Power Automate Desktop"
$backupRoot  = "$env:USERPROFILE\Documents\PAD_Backups"
$timestamp   = (Get-Date).ToString("yyyyMMdd_HHmmss")
$backupFile  = "$backupRoot\PAD_Backup_$timestamp.zip"
$maxBackups  = 5
$logFile     = "$backupRoot\AutoBackupPAD.log"

# ========================
# === IMPORT BURNTTOAST ===
# ========================
if (-not (Get-Module -ListAvailable -Name BurntToast)) {
    Install-Module -Name BurntToast -Force -Scope CurrentUser
}
Import-Module BurntToast

# ========================
# === FUNCTION SECTION ===
# ========================

function Write-Log {
    param([string]$message)
    $time = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
    $logEntry = "[$time] $message"
    Add-Content -Path $logFile -Value $logEntry
    Write-Host $logEntry
}

function Show-Toast {
    param(
        [string]$Text,
        [string]$Title = "PAD Auto Backup"
    )
    if (-not $Silent) {
        New-BurntToastNotification -Text $Title, $Text
    }
}

function Is-PADRunning {
    $processes = Get-Process -ErrorAction SilentlyContinue | Where-Object { $_.ProcessName -match "PAD\.Desktop" }
    return ($processes.Count -gt 0)
}

function Backup-PAD {
    if (-not (Test-Path $backupRoot)) {
        New-Item -ItemType Directory -Path $backupRoot | Out-Null
    }

    if (Test-Path $padFolder) {
        try {
            Compress-Archive -Path "$padFolder\*" -DestinationPath $backupFile -Force
            Write-Log "‚úÖ Backup completed: $backupFile"
            Cleanup-OldBackups
            Show-Toast "Backup completed successfully.`nSaved: $backupFile"
        } catch {
            Write-Log "‚ùå Backup failed: $($_.Exception.Message)"
            Show-Toast "Backup failed!`nError: $($_.Exception.Message)"
        }
    } else {
        Write-Log "‚ö†Ô∏è PAD folder not found at $padFolder"
        Show-Toast "PAD folder not found.`nPath: $padFolder"
    }
}

function Cleanup-OldBackups {
    $backups = Get-ChildItem -Path $backupRoot -Filter "*.zip" | Sort-Object LastWriteTime -Descending
    if ($backups.Count -gt $maxBackups) {
        $toDelete = $backups[$maxBackups..($backups.Count - 1)]
        foreach ($file in $toDelete) {
            try {
                Remove-Item $file.FullName -Force
                Write-Log "üóëÔ∏è Deleted old backup: $($file.Name)"
            } catch {
                Write-Log "‚ö†Ô∏è Could not delete $($file.Name): $($_.Exception.Message)"
            }
        }
    }
}

function Restore-PAD {
    $backups = Get-ChildItem -Path $backupRoot -Filter "*.zip" | Sort-Object LastWriteTime -Descending
    if ($backups.Count -eq 0) {
        Write-Log "‚ùå No backup files found in $backupRoot"
        Show-Toast "No backup files found to restore!" "PAD Auto Restore"
        return
    }

    $latest = $backups[0]
    Write-Host "üïê Latest backup found: $($latest.Name)"
    $confirm = Read-Host "Do you want to restore this backup? (Y/N)"
    if ($confirm -eq "Y") {
        try {
            Expand-Archive -Path $latest.FullName -DestinationPath $padFolder -Force
            Write-Log "‚úÖ Restored backup: $($latest.FullName)"
            Show-Toast "Restore completed successfully.`nRestored from: $($latest.Name)" "PAD Auto Restore"
        } catch {
            Write-Log "‚ùå Restore failed: $($_.Exception.Message)"
            Show-Toast "Restore failed!`nError: $($_.Exception.Message)" "PAD Auto Restore"
        }
    } else {
        Write-Log "‚ùé Restore canceled by user."
        Show-Toast "Restore canceled." "PAD Auto Restore"
    }
}

# ========================
# === MAIN EXECUTION ====
# ========================

if ($Restore) {
    Restore-PAD
} else {
    if (Is-PADRunning) {
        Write-Log "üü¢ PAD is running. Starting backup..."
        Show-Toast "Power Automate Desktop is running.`nStarting automatic backup..."
        Backup-PAD
    } else {
        Write-Log "üü° PAD not running. Backup skipped."
        Show-Toast "Power Automate Desktop is not running.`nBackup skipped."
    }
}


---

‚öôÔ∏è C√°ch s·ª≠ d·ª•ng

1Ô∏è‚É£ T·ª± ƒë·ªông (Task Scheduler) ‚Üí Silent + toast nh·∫π:

powershell.exe -ExecutionPolicy Bypass -File "C:\Scripts\AutoBackupPAD.ps1" -Silent

Kh√¥ng popup ch·∫∑n thao t√°c

V·∫´n hi·ªán toast th√¥ng b√°o nh·∫π v√† log ƒë·∫ßy ƒë·ªß


2Ô∏è‚É£ Restore th·ªß c√¥ng (c√≥ toast & prompt):

powershell.exe -ExecutionPolicy Bypass -File "C:\Scripts\AutoBackupPAD.ps1" -Restore

Hi·ªán toast + prompt ƒë·ªÉ x√°c nh·∫≠n restore



---

‚úÖ ∆Øu ƒëi·ªÉm

Kh√¥ng l√†m phi·ªÅn khi b·∫°n ƒëang code PAD ‚Üí toast nh·ªè g·ªçn.

Gi·ªØ 5 b·∫£n backup g·∫ßn nh·∫•t ‚Üí auto delete b·∫£n c≈©.

Ghi log chi ti·∫øt ‚Üí ti·ªán ki·ªÉm tra l·ªãch s·ª≠ backup/restore.

Thao t√°c restore th·ªß c√¥ng linh ho·∫°t, v·∫´n toast th√¥ng b√°o.



---

N·∫øu b·∫°n mu·ªën, m√¨nh c√≥ th·ªÉ update th√™m t√≠nh nƒÉng: toast ch·ªâ hi·ªán khi Task Scheduler ch·∫°y v√†o ban ng√†y, c√≤n ban ƒë√™m silent ho√†n to√†n, ch·ªâ log, ƒë·ªÉ kh√¥ng b·ªã phi·ªÅn khi b·∫°n ngh·ªâ ng∆°i.

B·∫°n c√≥ mu·ªën m√¨nh l√†m lu√¥n kh√¥ng?
