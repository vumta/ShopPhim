Tuyá»‡t vá»i, mÃ¬nh sáº½ cáº­p nháº­t toÃ n bá»™ **Office Script** Ä‘á»ƒ xá»­ lÃ½ tÃ¬nh huá»‘ng:

- âœ… Báº¡n dÃ¡n **nhiá»u láº§n (multiple source files)** vÃ o **cÃ¹ng má»™t file Ä‘Ã­ch**  
- âœ… Pháº£i kiá»ƒm tra hÃ ng cuá»‘i cÃ¹ng Ä‘Ã£ cÃ³ dá»¯ liá»‡u trong file Ä‘Ã­ch  
- âœ… TÃ¬m Ä‘Ãºng cá»™t dá»±a theo tÃªn náº±m á»Ÿ dÃ²ng 2 (row index = 1)  
- âœ… DÃ¡n **tiáº¿p theo sau hÃ ng cuá»‘i**, khÃ´ng pháº£i luÃ´n báº¯t Ä‘áº§u tá»« row 3

---

## âœ… âš™ï¸ Office Script cáº­p nháº­t hoÃ n chá»‰nh (dÃ¡n ná»‘i tiáº¿p dÆ°á»›i dá»¯ liá»‡u cÅ©)

```ts
function main(workbook: ExcelScript.Workbook, inputData: ColumnData[]): void {
  const sheet = workbook.getActiveWorksheet();

  // === 1. Äá»c tÃªn cá»™t tá»« dÃ²ng 2 ===
  const maxCols = 100;
  const headerRange = sheet.getRangeByIndexes(1, 0, 1, maxCols);
  const headerValues = headerRange.getValues()[0].map(v => v?.toString().trim());

  // === 2. Táº¡o map tÃªn cá»™t => chá»‰ sá»‘ cá»™t
  let colMap: Record<string, number> = {};
  for (let i = 0; i < headerValues.length; i++) {
    if (headerValues[i]) colMap[headerValues[i]] = i;
  }

  // === 3. TÃ¬m hÃ ng cuá»‘i cÃ¹ng cÃ³ dá»¯ liá»‡u (báº¯t Ä‘áº§u tá»« row 2)
  const maxRowsToCheck = 100000;
  const dataCheckRange = sheet.getRangeByIndexes(2, 0, maxRowsToCheck, maxCols);
  const dataValues = dataCheckRange.getValues();

  let lastRow = 1; // vÃ¬ dÃ²ng Ä‘áº§u dÃ¡n báº¯t Ä‘áº§u tá»« dÃ²ng 2 (index 1)
  for (let i = dataValues.length - 1; i >= 0; i--) {
    const row = dataValues[i];
    if (row.some(cell => cell !== null && cell !== "")) {
      lastRow = i + 2; // offset: +2 vÃ¬ data báº¯t Ä‘áº§u tá»« dÃ²ng 3 (index 2)
      break;
    }
  }

  // === 4. Táº¡o báº£ng dá»¯ liá»‡u Ä‘áº§y Ä‘á»§ cáº§n dÃ¡n (máº£ng 2D)
  const maxRowsToInsert = Math.max(...inputData.map(item => item.values.length));
  let fullInsert: (string | number | boolean)[][] = Array.from({ length: maxRowsToInsert }, () => Array(maxCols).fill(""));

  for (let item of inputData) {
    const colIndex = colMap[item.columnName];
    if (colIndex === undefined) continue;

    for (let i = 0; i < item.values.length; i++) {
      fullInsert[i][colIndex] = item.values[i][0]; // chá»‰ láº¥y giÃ¡ trá»‹ Ä‘áº§u tiÃªn má»—i hÃ ng
    }
  }

  // === 5. DÃ¡n dá»¯ liá»‡u vÃ o sheet
  const insertRange = sheet.getRangeByIndexes(lastRow, 0, maxRowsToInsert, maxCols);
  insertRange.setValues(fullInsert);
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

## âœ… Chi tiáº¿t Power Automate â€“ Step by Step (xá»­ lÃ½ nhiá»u file Ä‘áº§u vÃ o)

### ðŸ” Ã tÆ°á»Ÿng: Duyá»‡t qua nhiá»u file Excel nguá»“n, dÃ¡n tá»«ng batch ná»‘i tiáº¿p vÃ o file Ä‘Ã­ch

---

### ðŸŸ© **Step 1. Trigger**  
- TÃ¹y báº¡n: khi cÃ³ file, thá»§ cÃ´ng, hoáº·c theo giá»

---

### ðŸ“¥ **Step 2. Get Files (nguá»“n)**  
- DÃ¹ng `List files in folder` (OneDrive/SharePoint)  
- Folder chá»©a cÃ¡c file nguá»“n báº¡n muá»‘n xá»­ lÃ½

---

### ðŸ” **Step 3. Apply to each (má»—i file nguá»“n)**  
BÃªn trong vÃ²ng láº·p:

#### a. `Get file content using path` (vá»›i tá»«ng file)

#### b. `Run Script` (Excel nguá»“n)
- Script: `TrichCotTheoTenCot`
- Input: `["PhÃ²ng ban", "TÃªn", ...]`
- Output: `outputData`

#### c. `Parse JSON` (outputData)

#### d. `Run Script` (Excel Ä‘Ã­ch)
- Script: **cáº­p nháº­t á»Ÿ trÃªn** (dÃ¡n ná»‘i tiáº¿p sau dÃ²ng cuá»‘i)
- Input: toÃ n bá»™ `output` tá»« Parse JSON

---

### âœ… Sau khi vÃ²ng láº·p xong â†’ táº¥t cáº£ file nguá»“n Ä‘Ã£ Ä‘Æ°á»£c dÃ¡n ná»‘i tiáº¿p vÃ o Excel Ä‘Ã­ch, Ä‘Ãºng cá»™t, Ä‘Ãºng dÃ²ng.

---

## ðŸ§  Gá»£i Ã½ thÃªm

| Má»¥c tiÃªu | CÃ¡ch lÃ m |
|----------|----------|
| TrÃ¡nh trÃ¹ng dá»¯ liá»‡u | Kiá»ƒm tra tÃªn file Ä‘Ã£ xá»­ lÃ½ vÃ  ghi láº¡i vÃ o danh sÃ¡ch |
| Bá» file lá»—i | ThÃªm Try-Catch trong tá»«ng `Run script` |
| TÄƒng tá»‘c Ä‘á»™ | Gom tá»«ng nhÃ³m 5 file â†’ batch dÃ¡n náº¿u cáº§n |

---

Báº¡n cÃ³ muá»‘n mÃ¬nh táº¡o **flow JSON máº«u** Ä‘á»ƒ báº¡n paste trá»±c tiáº¿p vÃ o Power Automate Designer khÃ´ng? Hoáº·c mÃ¬nh cÃ³ thá»ƒ gá»­i áº£nh minh há»a tá»«ng bÆ°á»›c náº¿u báº¡n cáº§n visual há»— trá»£.
