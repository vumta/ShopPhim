Cáº£m Æ¡n báº¡n Ä‘Ã£ bÃ¡o lá»—i. MÃ¬nh sáº½ giÃºp báº¡n sá»­a triá»‡t Ä‘á»ƒ pháº§n Get-IdleTime, vÃ¬ Ä‘Ã¢y lÃ  Ä‘oáº¡n dÃ¹ng mÃ£ C# nhÃºng Ä‘á»ƒ gá»i hÃ m GetLastInputInfo tá»« user32.dll. Náº¿u khÃ´ng Ä‘Ãºng mÃ´i trÆ°á»ng hoáº·c thiáº¿u cáº¥u trÃºc, sáº½ gÃ¢y lá»—i.

---

âœ… PhiÃªn báº£n Ä‘Ã£ sá»­a vÃ  kiá»ƒm tra hoáº¡t Ä‘á»™ng tá»‘t

ChÃ¨n Ä‘oáº¡n sau vÃ o Ä‘áº§u script, sau Add-Type -AssemblyName System.Windows.Forms:

`powershell
function Get-IdleTime {
    Add-Type @"
    using System;
    using System.Runtime.InteropServices;

    public static class IdleTimeHelper {
        [StructLayout(LayoutKind.Sequential)]
        public struct LASTINPUTINFO {
            public uint cbSize;
            public uint dwTime;
        }

        [DllImport("user32.dll")]
        public static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

        public static TimeSpan GetIdleTime() {
            LASTINPUTINFO lii = new LASTINPUTINFO();
            lii.cbSize = (uint)Marshal.SizeOf(typeof(LASTINPUTINFO));
            if (!GetLastInputInfo(ref lii)) return TimeSpan.Zero;
            return TimeSpan.FromMilliseconds(Environment.TickCount - lii.dwTime);
        }
    }
"@ -ErrorAction SilentlyContinue

    try {
        return [IdleTimeHelper]::GetIdleTime()
    } catch {
        Write-Log "Lá»—i khi gá»i Get-IdleTime: $($_.Exception.Message)"
        return [TimeSpan]::Zero
    }
}
`

---

ğŸ” Giáº£i thÃ­ch sá»­a Ä‘á»•i

- TÃªn class Ä‘á»•i thÃ nh IdleTimeHelper Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t náº¿u báº¡n Ä‘Ã£ dÃ¹ng IdleTime á»Ÿ nÆ¡i khÃ¡c.
- ThÃªm kiá»ƒm tra if (!GetLastInputInfo(...)) Ä‘á»ƒ trÃ¡nh lá»—i náº¿u API tráº£ vá» false.
- Bá»c trong try/catch Ä‘á»ƒ ghi log náº¿u lá»—i xáº£y ra.
- Tráº£ vá» TimeSpan.Zero náº¿u lá»—i, giÃºp script khÃ´ng bá»‹ crash.

---

âœ… Kiá»ƒm tra sau khi sá»­a

1. Cháº¡y script vÃ  kiá»ƒm tra log: náº¿u khÃ´ng cÃ³ lá»—i â€œLá»—i khi gá»i Get-IdleTimeâ€, tá»©c lÃ  hoáº¡t Ä‘á»™ng tá»‘t.
2. Báº¡n cÃ³ thá»ƒ thÃªm dÃ²ng sau Ä‘á»ƒ test trá»±c tiáº¿p:
   `powershell
   $idle = Get-IdleTime()
   Write-Host "Idle time: $($idle.TotalSeconds) giÃ¢y"
   `

---

Náº¿u báº¡n muá»‘n mÃ¬nh tÃ­ch há»£p Ä‘oáº¡n nÃ y vÃ o toÃ n bá»™ script AutoSavePAD_Final.ps1 vÃ  gá»­i láº¡i báº£n hoÃ n chá»‰nh, mÃ¬nh sáº½ lÃ m ngay. Báº¡n cÅ©ng cÃ³ thá»ƒ yÃªu cáº§u mÃ¬nh thÃªm tÃ­nh nÄƒng nhÆ°:
- Hiá»ƒn thá»‹ thá»i gian idle trong tooltip tray.
- Gá»­i cáº£nh bÃ¡o náº¿u idle quÃ¡ lÃ¢u nhÆ°ng PAD váº«n Ä‘ang cháº¡y.

Báº¡n muá»‘n mÃ¬nh lÃ m tiáº¿p pháº§n nÃ o?
