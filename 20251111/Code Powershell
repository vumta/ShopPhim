Tuy·ªát v·ªùi üòé ‚Äî m√¨nh s·∫Ω c·∫≠p nh·∫≠t script AutoBackupPAD.ps1 ƒë·ªÉ:

1. T·ª± ƒë·ªông ki·ªÉm tra n·∫øu BurntToast ch∆∞a c√†i ‚Üí c√†i 1 l·∫ßn.


2. Nh·ªØng l·∫ßn ch·∫°y sau ‚Üí d√πng ngay m√† kh√¥ng h·ªèi g√¨.


3. V·∫´n gi·ªØ toast notification + silent mode + log + 5 b·∫£n backup g·∫ßn nh·∫•t.




---

üíª Script PowerShell Final (v7) ‚Äì T·ª± ƒë·ªông c√†i BurntToast

param(
    [switch]$Restore,
    [switch]$Silent
)

# ========================
# === CONFIG SECTION ====
# ========================
$padFolder   = "$env:USERPROFILE\Documents\Power Automate Desktop"
$backupRoot  = "$env:USERPROFILE\Documents\PAD_Backups"
$timestamp   = (Get-Date).ToString("yyyyMMdd_HHmmss")
$backupFile  = "$backupRoot\PAD_Backup_$timestamp.zip"
$maxBackups  = 5
$logFile     = "$backupRoot\AutoBackupPAD.log"

# ========================
# === CHECK & IMPORT BURNTTOAST ===
# ========================
try {
    if (-not (Get-Module -ListAvailable -Name BurntToast)) {
        Write-Host "BurntToast not found. Installing..."
        Install-Module -Name BurntToast -Force -Scope CurrentUser -ErrorAction Stop
    }
    Import-Module BurntToast -ErrorAction Stop
} catch {
    Write-Host "‚ùå Failed to install/load BurntToast: $($_.Exception.Message)"
    Write-Host "Toast notifications will be disabled."
    $Silent = $true
}

# ========================
# === FUNCTION SECTION ===
# ========================
function Write-Log {
    param([string]$message)
    $time = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
    $logEntry = "[$time] $message"
    Add-Content -Path $logFile -Value $logEntry
    Write-Host $logEntry
}

function Show-Toast {
    param(
        [string]$Text,
        [string]$Title = "PAD Auto Backup"
    )
    if (-not $Silent) {
        try {
            New-BurntToastNotification -Text $Title, $Text
        } catch {
            Write-Log "‚ö†Ô∏è Could not show toast: $($_.Exception.Message)"
        }
    }
}

function Is-PADRunning {
    $processes = Get-Process -ErrorAction SilentlyContinue | Where-Object { $_.ProcessName -match "PAD\.Desktop" }
    return ($processes.Count -gt 0)
}

function Backup-PAD {
    if (-not (Test-Path $backupRoot)) {
        New-Item -ItemType Directory -Path $backupRoot | Out-Null
    }

    if (Test-Path $padFolder) {
        try {
            Compress-Archive -Path "$padFolder\*" -DestinationPath $backupFile -Force
            Write-Log "‚úÖ Backup completed: $backupFile"
            Cleanup-OldBackups
            Show-Toast "Backup completed successfully.`nSaved: $backupFile"
        } catch {
            Write-Log "‚ùå Backup failed: $($_.Exception.Message)"
            Show-Toast "Backup failed!`nError: $($_.Exception.Message)"
        }
    } else {
        Write-Log "‚ö†Ô∏è PAD folder not found at $padFolder"
        Show-Toast "PAD folder not found.`nPath: $padFolder"
    }
}

function Cleanup-OldBackups {
    $backups = Get-ChildItem -Path $backupRoot -Filter "*.zip" | Sort-Object LastWriteTime -Descending
    if ($backups.Count -gt $maxBackups) {
        $toDelete = $backups[$maxBackups..($backups.Count - 1)]
        foreach ($file in $toDelete) {
            try {
                Remove-Item $file.FullName -Force
                Write-Log "üóëÔ∏è Deleted old backup: $($file.Name)"
            } catch {
                Write-Log "‚ö†Ô∏è Could not delete $($file.Name): $($_.Exception.Message)"
            }
        }
    }
}

function Restore-PAD {
    $backups = Get-ChildItem -Path $backupRoot -Filter "*.zip" | Sort-Object LastWriteTime -Descending
    if ($backups.Count -eq 0) {
        Write-Log "‚ùå No backup files found in $backupRoot"
        Show-Toast "No backup files found to restore!" "PAD Auto Restore"
        return
    }

    $latest = $backups[0]
    Write-Host "üïê Latest backup found: $($latest.Name)"
    $confirm = Read-Host "Do you want to restore this backup? (Y/N)"
    if ($confirm -eq "Y") {
        try {
            Expand-Archive -Path $latest.FullName -DestinationPath $padFolder -Force
            Write-Log "‚úÖ Restored backup: $($latest.FullName)"
            Show-Toast "Restore completed successfully.`nRestored from: $($latest.Name)" "PAD Auto Restore"
        } catch {
            Write-Log "‚ùå Restore failed: $($_.Exception.Message)"
            Show-Toast "Restore failed!`nError: $($_.Exception.Message)" "PAD Auto Restore"
        }
    } else {
        Write-Log "‚ùé Restore canceled by user."
        Show-Toast "Restore canceled." "PAD Auto Restore"
    }
}

# ========================
# === MAIN EXECUTION ====
# ========================

if ($Restore) {
    Restore-PAD
} else {
    if (Is-PADRunning) {
        Write-Log "üü¢ PAD is running. Starting backup..."
        Show-Toast "Power Automate Desktop is running.`nStarting automatic backup..."
        Backup-PAD
    } else {
        Write-Log "üü° PAD not running. Backup skipped."
        Show-Toast "Power Automate Desktop is not running.`nBackup skipped."
    }
}


---

‚úÖ ∆Øu ƒëi·ªÉm b·∫£n n√†y

1. T·ª± ƒë·ªông c√†i BurntToast n·∫øu ch∆∞a c√≥ ‚Üí l·∫ßn sau ch·∫°y ngay.


2. Silent mode ‚Üí ch·∫°y ng·∫ßm, toast v·∫´n hi·ªÉn th·ªã nh∆∞ng kh√¥ng popup ch·∫∑n.


3. Toast notification nh·∫π nh√†ng, kh√¥ng c·∫£n thao t√°c.


4. Ghi log ƒë·∫ßy ƒë·ªß ‚Üí backup/restore + xo√° backup c≈©.


5. Gi·ªØ t·ªëi ƒëa 5 b·∫£n backup g·∫ßn nh·∫•t.


6. Restore th·ªß c√¥ng linh ho·∫°t ‚Üí toast + prompt x√°c nh·∫≠n.




---

N·∫øu mu·ªën, m√¨nh c√≥ th·ªÉ b·ªï sung th√™m ch·∫ø ƒë·ªô ‚Äúsilent ho√†n to√†n ban ƒë√™m‚Äù, t·ª± ƒë·ªông t·∫Øt toast trong kho·∫£ng gi·ªù ngh·ªâ, v·∫´n backup + log.
B·∫°n c√≥ mu·ªën m√¨nh l√†m lu√¥n kh√¥ng?
