ƒê·ªÉ **x√°c ƒë·ªãnh m·ªôt item trong JSON tr·∫£ v·ªÅ t·ª´ SharePoint l√† file hay folder**, b·∫°n ch·ªâ c·∫ßn nh√¨n v√†o **c·∫•u tr√∫c d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ API** ‚Äî m·ªói lo·∫°i (`File` v√† `Folder`) s·∫Ω c√≥ c√°c ƒë·∫∑c ƒëi·ªÉm kh√°c nhau. D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt:

---

## ‚úÖ 1. **N·∫øu b·∫°n d√πng API**:
```http
/_api/web/GetFolderByServerRelativeUrl('<path>')?$expand=Folders,Files
```

Th√¨:
- `Files` s·∫Ω l√† m·ªôt **m·∫£ng c√°c file**.
- `Folders` s·∫Ω l√† m·ªôt **m·∫£ng c√°c folder**.

V√¨ v·∫≠y b·∫°n **ƒë√£ bi·∫øt ch·∫Øc** c√°i n√†o l√† file v√† c√°i n√†o l√† folder v√¨ ch√∫ng n·∫±m trong 2 m·∫£ng ri√™ng bi·ªát.

---

## ‚úÖ 2. **N·∫øu b·∫°n d√πng API list all items trong folder (Files + Folders l·∫´n l·ªôn)**

V√≠ d·ª•:
```http
/_api/web/GetFolderByServerRelativeUrl('<path>')/ListItemAllFields?$expand=File,Folder
```

Ho·∫∑c:
```http
/_api/web/GetFolderByServerRelativeUrl('<path>')/Folders?$expand=ListItemAllFields
```

Khi ƒë√≥ b·∫°n **ph·∫£i ki·ªÉm tra trong t·ª´ng item ƒë·ªÉ bi·∫øt n√≥ l√† file hay folder**.

---

## ‚úÖ 3. **C√°ch x√°c ƒë·ªãnh File hay Folder trong JSON (khi l·∫´n l·ªôn)**

Trong m·ªói item tr·∫£ v·ªÅ, b·∫°n c√≥ th·ªÉ d·ª±a v√†o c√°c tr∆∞·ªùng sau:

| C√°ch | M√¥ t·∫£ | C√¥ng th·ª©c d√πng trong Power Automate |
|------|------|-------------------------------------|
| `FSObjType` | `0 = File`, `1 = Folder` | `item()?['FSObjType']` |
| `FileSystemObjectType` | `0 = File`, `1 = Folder` | `item()?['FileSystemObjectType']` |
| C√≥ `File` hay `Folder` object | N·∫øu c√≥ tr∆∞·ªùng `File` l√† file, n·∫øu c√≥ `Folder` l√† folder | `if(contains(keys(item()), 'File'), 'File', 'Folder')` |
| `ItemType` (n·∫øu l·∫•y t·ª´ SharePoint list) | C≈©ng th∆∞·ªùng l√† `0 = file`, `1 = folder` | `item()?['ItemType']` |

---

### ‚úÖ C√°ch ph·ªï bi·∫øn nh·∫•t: **D·ª±a v√†o `FileSystemObjectType` ho·∫∑c `FSObjType`**

Trong Power Automate, b·∫°n c√≥ th·ªÉ d√πng `Condition`:

```plaintext
Condition: item()?['FileSystemObjectType'] is equal to 1
```
‚Üí ƒê√¢y l√† folder.

```plaintext
Condition: item()?['FileSystemObjectType'] is equal to 0
```
‚Üí ƒê√¢y l√† file.

---

## üß™ V√≠ d·ª• JSON tr·∫£ v·ªÅ

```json
{
  "Name": "Document1.pdf",
  "ServerRelativeUrl": "/sites/yoursite/Shared Documents/Document1.pdf",
  "FSObjType": 0,
  "FileSystemObjectType": 0,
  "File": {
    "Name": "Document1.pdf"
  }
}
```

```json
{
  "Name": "SubFolder",
  "ServerRelativeUrl": "/sites/yoursite/Shared Documents/SubFolder",
  "FSObjType": 1,
  "FileSystemObjectType": 1,
  "Folder": {
    "Name": "SubFolder"
  }
}
```

---

## ‚úÖ T√≥m t·∫Øt

| D·∫•u hi·ªáu | File | Folder |
|----------|------|--------|
| `FSObjType` ho·∫∑c `FileSystemObjectType` | `0` | `1` |
| C√≥ tr∆∞·ªùng `File` | ‚úÖ | ‚ùå |
| C√≥ tr∆∞·ªùng `Folder` | ‚ùå | ‚úÖ |

---

N·∫øu b·∫°n c·∫ßn m√¨nh gi√∫p b·∫°n vi·∫øt m·ªôt kh·ªëi `Condition` ho·∫∑c x·ª≠ l√Ω JSON n√†y trong Power Automate cho file/folder, m√¨nh c√≥ th·ªÉ vi·∫øt m·∫´u c·ª• th·ªÉ lu√¥n. B·∫°n ƒëang l·∫•y d·ªØ li·ªáu t·ª´ action n√†o v·∫≠y? REST API hay "Get files (properties only)"?
================================
N·∫øu b·∫°n th·∫•y `Files = null` trong k·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ SharePoint REST API, c√≥ m·ªôt v√†i nguy√™n nh√¢n th∆∞·ªùng g·∫∑p, v√† m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°ch **x·ª≠ l√Ω tri·ªát ƒë·ªÉ** ƒë·ªÉ b·∫°n lu√¥n l·∫•y ƒë∆∞·ª£c danh s√°ch file ch√≠nh x√°c, k·ªÉ c·∫£ khi c√≥ subfolder ho·∫∑c kh√¥ng c√≥ file n√†o.

---

## üß† **Hi·ªÉu r√µ v·∫•n ƒë·ªÅ: V√¨ sao `Files = null`**

### ‚úÖ Tr∆∞·ªùng h·ª£p c√≥ th·ªÉ x·∫£y ra:
| T√¨nh hu·ªëng                               | Di·ªÖn gi·∫£i                                                                 |
|-----------------------------------------|--------------------------------------------------------------------------|
| Folder kh√¥ng ch·ª©a file n√†o              | Gi√° tr·ªã `Files` s·∫Ω l√† `null` ho·∫∑c m·∫£ng r·ªóng.                             |
| B·∫°n g·ªçi sai endpoint API                | C√≥ th·ªÉ `Files` kh√¥ng ƒë∆∞·ª£c expand ƒë√∫ng n√™n kh√¥ng c√≥ trong response.      |
| B·∫°n ƒëang l·∫•y th√¥ng tin `Folder`, kh√¥ng ph·∫£i `Folder/File collection` | C√≥ th·ªÉ ch·ªâ ƒëang xem th√¥ng tin folder ch·ª© kh√¥ng l·∫•y n·ªôi dung trong ƒë√≥.   |

---

## ‚úÖ **C√°ch kh·∫Øc ph·ª•c d·ª©t ƒëi·ªÉm**

### üîß C√°ch g·ªçi REST API ƒë√∫ng:

#### D√πng ƒë√∫ng endpoint ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ c·∫£ `Files` v√† `Folders`:
```plaintext
/_api/web/GetFolderByServerRelativeUrl('<serverRelativePath>')?$expand=Folders,Files
```

#### V√≠ d·ª•:
```plaintext
/_api/web/GetFolderByServerRelativeUrl('/Shared Documents/Reports')?$expand=Folders,Files
```

> Kh√¥ng n√™n g·ªçi `/Folders?$expand=Folders,Files` nh∆∞ tr∆∞·ªõc, v√¨ n√≥ ch·ªâ li·ªát k√™ c√°c folder con, **kh√¥ng hi·ªÉn th·ªã `Files` tr·ª±c ti·∫øp trong folder cha**.

---

## ‚úÖ **C√°ch x·ª≠ l√Ω n·∫øu `Files` l√† `null`**

Trong Power Automate, khi `Files` l√† `null`, b·∫°n ph·∫£i ki·ªÉm tra tr∆∞·ªõc khi duy·ªát m·∫£ng:

### üëá C√°ch x·ª≠ l√Ω an to√†n trong `Apply to each`:

1. **S·ª≠ d·ª•ng `coalesce()`**:
   D√≤ng n√†y s·∫Ω ƒë·∫£m b·∫£o n·∫øu `Files` null th√¨ thay b·∫±ng m·∫£ng r·ªóng `[]`.

```plaintext
coalesce(body('Parse_JSON')?['Files'], [])
```

2. **D√πng trong v√≤ng l·∫∑p Apply to each**:

```plaintext
Apply to each: value = coalesce(body('Parse_JSON')?['Files'], [])
```

‚û°Ô∏è ƒêi·ªÅu n√†y gi√∫p b·∫°n tr√°nh l·ªói khi `Files = null` v√† v·∫´n ti·∫øp t·ª•c flow.

---

## ‚úÖ **C√°ch test nhanh**

Th√™m m·ªôt action `Compose` sau khi g·ªçi API v√† g√°n:
```plaintext
body('Send_an_HTTP_request_to_SharePoint')?['Files']
```

Ch·∫°y th·ª≠ v√† xem k·∫øt qu·∫£:  
- N·∫øu l√† `null`: folder kh√¥ng c√≥ file n√†o ho·∫∑c b·∫°n d√πng sai API.
- N·∫øu l√† `[]`: kh√¥ng c√≥ file nh∆∞ng API ƒë√∫ng.
- N·∫øu c√≥ m·∫£ng: b·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c x·ª≠ l√Ω b√¨nh th∆∞·ªùng.

---

## ‚úÖ **G·ª£i √Ω m·ªü r·ªông**
N·∫øu b·∫°n ƒëang duy·ªát ƒë·ªá quy c√°c subfolder:

- V·ªõi m·ªói l·∫ßn g·ªçi API, h√£y g·ªçi ƒë√∫ng endpoint:
```plaintext
/_api/web/GetFolderByServerRelativeUrl('@{items('Apply_to_each')?['ServerRelativeUrl']}')?$expand=Folders,Files
```

---

## üìå T·ªïng k·∫øt

| V·∫•n ƒë·ªÅ                        | C√°ch x·ª≠ l√Ω                                 |
|------------------------------|--------------------------------------------|
| `Files = null`               | D√πng `coalesce()` ƒë·ªÉ chuy·ªÉn sang m·∫£ng r·ªóng |
| Kh√¥ng th·∫•y `Files` trong JSON | Ki·ªÉm tra endpoint g·ªçi API ƒë√£ ƒë√∫ng ch∆∞a     |
| Kh√¥ng c√≥ file trong folder   | ƒê√¢y l√† b√¨nh th∆∞·ªùng, kh√¥ng ph·∫£i l·ªói         |

---

C·∫ßn m√¨nh t·∫°o m·∫´u flow demo d√πng `coalesce()` + ƒë·ªá quy ƒë·∫ßy ƒë·ªß th√¨ m√¨nh c√≥ th·ªÉ h∆∞·ªõng d·∫´n b·∫°n ti·∫øp nh√©. B·∫°n mu·ªën d√πng trong Cloud Flow hay Power Automate Desktop?
