DÆ°á»›i Ä‘Ã¢y lÃ  **hÆ°á»›ng dáº«n step-by-step** Ä‘á»ƒ táº¡o **Power Automate Cloud Flow Ä‘á»‡ quy vá»›i â€œList folderâ€** nháº±m **láº¥y táº¥t cáº£ file trong thÆ° má»¥c SharePoint bao gá»“m cáº£ subfolder**:

---

## ğŸ§  Ã tÆ°á»Ÿng chÃ­nh:
1. **Báº¯t Ä‘áº§u vá»›i thÆ° má»¥c gá»‘c** â†’ Ä‘Æ°a vÃ o danh sÃ¡ch Ä‘á»£i (`FolderQueue`)
2. **Láº·p (Do Until)**:
   - Láº¥y ra 1 folder tá»« queue
   - Gá»i `List folder` Ä‘á»ƒ láº¥y danh sÃ¡ch má»¥c con
   - Náº¿u lÃ  file â†’ lÆ°u vÃ o `AllFiles`
   - Náº¿u lÃ  folder â†’ thÃªm vÃ o `FolderQueue`
3. Dá»«ng khi khÃ´ng cÃ²n folder nÃ o trong queue.

---

## âœ… CÃ¡c bÆ°á»›c chi tiáº¿t:

### ğŸŸ¨ **Step 1: Táº¡o Flow vÃ  cÃ¡c biáº¿n khá»Ÿi táº¡o**

1. **Táº¡o Cloud Flow** (Scheduled hoáº·c Instant tÃ¹y báº¡n).
2. **Add "Initialize variable"**:
   - `Name`: `FolderQueue`
   - `Type`: `Array`
   - `Value`: `["Shared Documents/Reports"]` (folder gá»‘c)

3. **Add "Initialize variable"**:
   - `Name`: `AllFiles`
   - `Type`: `Array`
   - `Value`: `[]`

---

### ğŸŸ¨ **Step 2: Táº¡o Do Until loop Ä‘á»ƒ duyá»‡t háº¿t folder**

**Add "Do Until"**

- **Condition**: `length(variables('FolderQueue'))` is equal to `0`  
  (Ã½ lÃ  láº·p Ä‘áº¿n khi queue rá»—ng)

---

### ğŸŸ© **BÃªn trong "Do Until":**

#### ğŸ”¹ 1. Get current folder to process

- **Add "Compose"**
  - `Inputs`: `first(variables('FolderQueue'))`

#### ğŸ”¹ 2. Remove it from FolderQueue

- **Add "Append to array variable" (táº¡m thá»i táº¡o biáº¿n má»›i náº¿u muá»‘n, hoáº·c dÃ¹ng expression)**

- **Set variable `FolderQueue`**:
  - **Value**:  
    ```json
    skip(variables('FolderQueue'), 1)
    ```

#### ğŸ”¹ 3. List folder content

- **Add action**: `List folder`
  - **Site Address**: site cá»§a báº¡n
  - **Folder Path**: `Outputs` cá»§a step Compose á»Ÿ trÃªn

---

#### ğŸ”¹ 4. Apply to each â†’ tá»«ng item trong "List folder"

- **Apply to each**: `value` tá»« káº¿t quáº£ `List folder`

BÃªn trong:

##### ğŸ”¸ a. Náº¿u lÃ  file â†’ Add vÃ o `AllFiles`

- **Condition**:  
  ```plaintext
  empty(items('Apply_to_each')?['Folder'])
  ```

  Náº¿u TRUE â†’ lÃ  file

- Náº¿u Ä‘Ãºng: **Append to array variable `AllFiles`**  
  Vá»›i item dáº¡ng:
  ```json
  {
    "Name": "@items('Apply_to_each')?['Name']",
    "Path": "@items('Apply_to_each')?['Path']",
    "Link": "@items('Apply_to_each')?['Link']"
  }
  ```

##### ğŸ”¸ b. Náº¿u lÃ  folder â†’ add vÃ o `FolderQueue`

- Náº¿u FALSE (nghÄ©a lÃ  folder), thÃ¬:
  - **Append to array variable `FolderQueue`**
  - Value:  
    ```plaintext
    items('Apply_to_each')?['Path']
    ```

---

### ğŸŸ© Sau Do Until: Xuáº¥t danh sÃ¡ch file

- Báº¡n cÃ³ thá»ƒ log `AllFiles`, xuáº¥t ra file Excel, gá»­i qua email, v.v.

---

## âœ… Káº¿t quáº£:
- Máº£ng `AllFiles` sáº½ chá»©a **toÃ n bá»™ file tá»« thÆ° má»¥c SharePoint gá»‘c vÃ  táº¥t cáº£ subfolder khÃ´ng giá»›i háº¡n cáº¥p Ä‘á»™**.

---

## âš¡ Gá»£i Ã½ nÃ¢ng cao:
- Báº¡n cÃ³ thá»ƒ thÃªm **filter theo loáº¡i file**, **cá»¡ file**, hoáº·c thÃªm log thá»i gian cho tá»«ng folder náº¿u cáº§n debug.
- Náº¿u muá»‘n trÃ¡nh cháº¡y quÃ¡ lÃ¢u, cÃ³ thá»ƒ giá»›i háº¡n `Do Until` theo thá»i gian hoáº·c sá»‘ vÃ²ng láº·p.

---

Náº¿u báº¡n muá»‘n mÃ¬nh **xuáº¥t ra báº£n máº«u Flow JSON** Ä‘á»ƒ import vÃ o Power Automate cho nhanh, chá»‰ cáº§n cho mÃ¬nh biáº¿t chÃ­nh xÃ¡c:
- ÄÆ°á»ng dáº«n thÆ° má»¥c gá»‘c
- Site name SharePoint

MÃ¬nh sáº½ táº¡o sáºµn báº£n Ä‘á»ƒ báº¡n chá»‰ viá»‡c import ğŸ‘Œ
