Trong Power Automate, náº¿u báº¡n dÃ¹ng `createArray()` vÃ  nÃ³ tráº£ vá» `[]`, tá»©c lÃ  máº£ng rá»—ng â€“ thÃ¬ Ä‘á»ƒ **kiá»ƒm tra xem máº£ng cÃ³ rá»—ng hay khÃ´ng**, báº¡n dÃ¹ng biá»ƒu thá»©c:

---

### âœ… **CÃ¡ch kiá»ƒm tra máº£ng rá»—ng (`[]`):**

```plaintext
empty( createArray(...) )
```

ğŸ“Œ VÃ­ dá»¥:
```plaintext
empty(createArray(items('Apply_to_each')))
```

---

### âœ… Náº¿u báº¡n Ä‘ang kiá»ƒm tra sau khi gá»i Child Flow:

Giáº£ sá»­ báº¡n cÃ³ máº£ng tráº£ vá» tá»« Child Flow lÃ :

```plaintext
outputs('ChildFlow')?['Subfolders']
```

ThÃ¬ kiá»ƒm tra rá»—ng:
```plaintext
empty(outputs('ChildFlow')?['Subfolders'])
```

---

### âœ… DÃ¹ng trong Condition:

Trong khá»‘i `Condition`, báº¡n:
- Chá»n kiá»ƒu â€œExpressionâ€
- DÃ¡n:  
```plaintext
empty(outputs('ChildFlow')?['Subfolders'])
```

Rá»“i nháº¥n â€œOKâ€ lÃ  Ä‘Æ°á»£c.

---

### ğŸ¯ Máº¹o:
Báº¡n cÃ³ thá»ƒ káº¿t há»£p `if()` Ä‘á»ƒ ráº½ nhÃ¡nh:
```plaintext
if(empty(outputs('ChildFlow')?['Subfolders']), 'Trá»‘ng', 'CÃ³ dá»¯ liá»‡u')
```

---

Cáº§n mÃ¬nh build flow máº«u hoáº·c giÃºp kiá»ƒm tra Ä‘iá»u kiá»‡n thá»±c táº¿ báº¡n Ä‘ang gáº·p thÃ¬ gá»­i thÃªm chi tiáº¿t nhÃ©!


======
Báº¡n Ä‘Ãºng rá»“i â€“ Power Automate **khÃ´ng há»— trá»£ toÃ¡n tá»­ `+` Ä‘á»ƒ ná»‘i array**, nÃªn biá»ƒu thá»©c:

```plaintext
createArray(items('Apply_to_each')) + variables('NextPendingFolders')
```

sáº½ bá»‹ **lá»—i**.

---

## âœ… Giáº£i phÃ¡p Ä‘Ãºng: DÃ¹ng hÃ m `union()` Ä‘á»ƒ "ná»‘i máº£ng"
Báº¡n cÃ³ thá»ƒ thay tháº¿ báº±ng cÃ¡ch dÃ¹ng `union()` nhÆ° sau:

```plaintext
union(createArray(items('Apply_to_each')), variables('NextPendingFolders'))
```

- `createArray(items('Apply_to_each'))` â†’ chuyá»ƒn item hiá»‡n táº¡i thÃ nh máº£ng
- `union()` sáº½ ná»‘i máº£ng Ä‘Ã³ vÃ o Ä‘áº§u `NextPendingFolders`

ğŸ“Œ VÃ¬ `union()` **bá» trÃ¹ng**, náº¿u báº¡n muá»‘n **giá»¯ trÃ¹ng**, thÃ¬ dÃ¹ng `array concat workaround` nhÆ° dÆ°á»›i:

---

## ğŸ” Náº¿u báº¡n cáº§n giá»¯ **trÃ¹ng láº·p**, dÃ¹ng trick vá»›i `concat()` chuá»—i vÃ  `json()`

### CÃ¡ch 1: Biá»ƒu thá»©c Ä‘áº§y Ä‘á»§
```plaintext
json(concat('[', json(items('Apply_to_each')), ',', substring(string(variables('NextPendingFolders')), 1)))
```

NhÆ°ng cÃ¡i nÃ y khÃ³ báº£o trÃ¬.

---

## âœ… CÃ¡ch Ä‘Æ¡n giáº£n & chuáº©n nháº¥t
**Cáº­p nháº­t `NextPendingFolders`** vá»›i:
```plaintext
Set variable - NextPendingFolders =
union(createArray(items('Apply_to_each')), variables('NextPendingFolders'))
```

DÃ¹ng Ä‘Æ°á»£c luÃ´n, dá»… hiá»ƒu, vÃ  Ä‘Ãºng thá»© tá»± DFS.

---

Náº¿u báº¡n muá»‘n mÃ¬nh build vÃ  gá»­i báº¡n `.zip` máº«u cá»§a flow nÃ y Ä‘á»ƒ import tháº³ng thÃ¬ mÃ¬nh cÃ³ thá»ƒ táº¡o giÃºp nhÃ©!


==================
ChÃ­nh xÃ¡c! Theo máº·c Ä‘á»‹nh, **`Append to array variable` luÃ´n thÃªm vÃ o cuá»‘i**, nÃªn thá»© tá»± xá»­ lÃ½ sáº½ lÃ :

```
FolderA â†’ A1 â†’ A2 â†’ A1a â†’ FolderB
```

NhÆ°ng báº¡n muá»‘n xá»­ lÃ½ theo chiá»u **Depth-First** Ä‘Ãºng chuáº©n:

```
FolderA â†’ A1 â†’ A1a â†’ A2 â†’ FolderB
```

---

## âœ… Giáº£i phÃ¡p: **Insert vÃ o Ä‘áº§u máº£ng (giá»‘ng stack)**
Power Automate khÃ´ng cÃ³ action sáºµn Ä‘á»ƒ *insert at beginning*, nhÆ°ng ta cÃ³ thá»ƒ lÃ m **thá»§ cÃ´ng** nhÆ° sau:

---

### ğŸ§± Step-by-step: Insert tá»«ng `Subfolder` vÃ o Ä‘áº§u `PendingFolders`

#### ğŸ”¹ 1. Táº¡o láº¡i `NextPendingFolders` tá»« `skip(PendingFolders, 1)`

```plaintext
skip(variables('PendingFolders'), 1)
```

â†’ GÃ¡n vÃ o biáº¿n `NextPendingFolders` (máº£ng táº¡m)

---

#### ğŸ”¹ 2. **Apply to each â€“ NgÆ°á»£c chiá»u** (xá»­ lÃ½ Ä‘áº£o máº£ng)

Äáº£o thá»© tá»± máº£ng `Subfolders` trÆ°á»›c Ä‘á»ƒ khi chÃ¨n vÃ o Ä‘áº§u, váº«n giá»¯ Ä‘Ãºng thá»© tá»± DFS:

ğŸ‘‰ **Input**:
```plaintext
reverse(outputs('ChildFlow')?['Subfolders'])
```

---

#### ğŸ”¹ 3. Trong `Apply to each`:

ğŸ‘‰ **Action**: `Set variable - NextPendingFolders`

```plaintext
createArray(items('Apply_to_each')) + variables('NextPendingFolders')
```

> ğŸ“ LÆ°u Ã½: `createArray(x)` + array lÃ  cÃ¡ch chÃ¨n `x` vÃ o Ä‘áº§u máº£ng!

---

#### ğŸ”¹ 4. GÃ¡n `PendingFolders = NextPendingFolders`

---

## ğŸ§ª VÃ­ dá»¥

Giáº£ sá»­:
- `PendingFolders = ["FolderA", "FolderB"]`
- `Subfolders = ["A1", "A2"]`

ThÃ¬ sau khi xá»­ lÃ½:
```
PendingFolders = ["A1", "A2", "FolderB"]
```

---

## ğŸ” Káº¿t quáº£ duyá»‡t sáº½ lÃ :

```
FolderA
â†’ A1
â†’ A1a
â†’ A2
FolderB
```

---

Náº¿u báº¡n cáº§n mÃ¬nh **táº¡o Flow máº«u (.zip)** vá»›i cÃ¡ch xá»­ lÃ½ `insert at beginning` nhÆ° trÃªn, chá»‰ cáº§n nÃ³i nhÃ©!
===============================================
Báº¡n hoÃ n toÃ n Ä‘Ãºng! Trong Power Automate:

> âŒ `concat()` **chá»‰ hoáº¡t Ä‘á»™ng vá»›i chuá»—i (string)**, **khÃ´ng hoáº¡t Ä‘á»™ng vá»›i array**.

---

## âœ… Má»¥c tiÃªu cá»§a báº¡n lÃ :
Báº¡n muá»‘n **ná»‘i 2 máº£ng**:
- `Subfolders` tráº£ vá» tá»« Child Flow  
- `PendingFolders` sau khi Ä‘Ã£ `skip(1)`

---

## âœ… Giáº£i phÃ¡p: DÃ¹ng `join arrays` thá»§ cÃ´ng báº±ng cÃ¡ch `append each`

VÃ¬ báº¡n **khÃ´ng thá»ƒ dÃ¹ng `concat()` cho máº£ng**, báº¡n cÃ³ thá»ƒ lÃ m nhÆ° sau:

---

### ğŸ§± Step-by-step thay tháº¿ `concat()` cho array

#### ğŸ”¹ 1. **Compose â€“ CurrentFolder**
```plaintext
first(variables('PendingFolders'))
```

---

#### ğŸ”¹ 2. **Child Flow â€“ input: CurrentFolder**
- Output: `Files[]`, `Subfolders[]`

---

#### ğŸ”¹ 3. **Append `Files[]` vÃ o AllFiles**
```plaintext
Set variable â†’ AllFiles = concat(variables('AllFiles'), outputs('ChildFlow')?['Files'])
```

ğŸ‘‰ `AllFiles` váº«n lÃ  máº£ng, báº¡n cÃ³ thá»ƒ dÃ¹ng `union()` hoáº·c `concat()` vÃ¬ báº¡n **Ä‘Ã£ Ä‘áº£m báº£o 2 máº£ng cÃ¹ng kiá»ƒu dá»¯ liá»‡u**.

---

#### ğŸ”¹ 4. **Táº¡o biáº¿n táº¡m `NextPendingFolders`**
- **Initialize variable** (array): `NextPendingFolders = skip(variables('PendingFolders'), 1)`

---

#### ğŸ”¹ 5. **Apply to each - Subfolder**
- Input: `outputs('ChildFlow')?['Subfolders']`  
- Trong loop:
  - `Append to array variable` â†’ `NextPendingFolders`

---

#### ğŸ”¹ 6. **Set láº¡i `PendingFolders = NextPendingFolders`**

---

## ğŸ¯ TÃ³m láº¡i:
Báº¡n thay vÃ¬ dÃ¹ng `concat(máº£ng1, máº£ng2)` â†’ báº¡n:
1. DÃ¹ng `skip()` táº¡o máº£ng má»›i
2. DÃ¹ng `Apply to each` Ä‘á»ƒ thÃªm tá»«ng pháº§n tá»­ Subfolders vÃ o máº£ng táº¡m
3. GÃ¡n láº¡i `PendingFolders`

---

Náº¿u báº¡n muá»‘n mÃ¬nh táº¡o `.zip` máº«u vá»›i cÃ¡ch nÃ y Ä‘á»ƒ import tháº³ng vÃ o Power Automate thÃ¬ mÃ¬nh cÃ³ thá»ƒ lÃ m giÃºp luÃ´n!


========================
Tuyá»‡t vá»i, mÃ¬nh sáº½ hÆ°á»›ng dáº«n báº¡n **step-by-step chi tiáº¿t** Ä‘á»ƒ xÃ¢y dá»±ng Flow cha theo Ä‘Ãºng yÃªu cáº§u:

---

## ğŸ¯ Má»¥c tiÃªu
- Sá»­ dá»¥ng **Child Flow** Ä‘á»ƒ Ä‘á»c 1 folder â†’ tráº£ vá» máº£ng `Files[]` vÃ  `Subfolders[]`
- **Flow cha** quáº£n lÃ½ hÃ ng Ä‘á»£i (`Queue`) cÃ¡c folder Ä‘ang chá» xá»­ lÃ½.
- Duyá»‡t **tuáº§n tá»± tá»«ng nhÃ¡nh folder** (xá»­ lÃ½ háº¿t cÃ¡c con cá»§a má»™t folder rá»“i má»›i sang folder tiáº¿p theo).

---

## ğŸ“‚ Cáº¥u trÃºc xá»­ lÃ½: Giá»‘ng thuáº­t toÃ¡n **Depth-First Search (DFS)**

- Sá»­ dá»¥ng **biáº¿n máº£ng `PendingFolders`** nhÆ° má»™t **stack** (thÃªm báº±ng `insert at beginning`)
- LuÃ´n xá»­ lÃ½ folder á»Ÿ Ä‘áº§u danh sÃ¡ch â†’ Ä‘áº£m báº£o duyá»‡t theo chiá»u sÃ¢u.

---

## ğŸ— Step-by-step xÃ¢y dá»±ng Flow Cha

### ğŸ”¸ Biáº¿n cáº§n khai bÃ¡o:
| TÃªn biáº¿n | Kiá»ƒu | GiÃ¡ trá»‹ khá»Ÿi táº¡o |
|----------|------|------------------|
| `PendingFolders` | Array | `[â€˜/Shared Documentsâ€™]` hoáº·c folder gá»‘c |
| `AllFiles` | Array | `[]` |

---

### ğŸ”„ BÆ°á»›c láº·p: `Do Until`  
**Condition**: `length(variables('PendingFolders')) is equal to 0`

---

### ğŸ§± CÃ¡c bÆ°á»›c bÃªn trong `Do Until`

#### ğŸ§© 1. **Get folder Ä‘áº§u tiÃªn Ä‘á»ƒ xá»­ lÃ½**
- **Action**: `Compose - CurrentFolder`
  ```plaintext
  first(variables('PendingFolders'))
  ```

---

#### ğŸ§© 2. **Gá»i Child Flow**
- **Input**: `FolderPath = outputs('Compose - CurrentFolder')`
- **Output giáº£ sá»­**:
  - `Files[]`
  - `Subfolders[]`

---

#### ğŸ§© 3. **Append file vÃ o biáº¿n AllFiles**
- **Action**: `Append to array variable - AllFiles`
  ```plaintext
  variables('AllFiles') + outputs('Child_Flow')?['Files']
  ```

---

#### ğŸ§© 4. **Chuáº©n hÃ³a Subfolders**
- **Action**: `Compose - SafeSubfolders`
  ```plaintext
  if(empty(outputs('Child_Flow')?['Subfolders']), createArray(), outputs('Child_Flow')?['Subfolders'])
  ```

---

#### ğŸ§© 5. **Cáº­p nháº­t PendingFolders**
##### a. Remove folder Ä‘áº§u tiÃªn
- **Action**: `Compose - Remaining`
  ```plaintext
  skip(variables('PendingFolders'), 1)
  ```

##### b. GhÃ©p Subfolders vÃ o Ä‘áº§u danh sÃ¡ch (Duyá»‡t sÃ¢u trÆ°á»›c)
- **Action**: `Set variable - PendingFolders`
  ```plaintext
  concat(outputs('Compose - SafeSubfolders'), outputs('Compose - Remaining'))
  ```

---

## âœ… Káº¿t thÃºc vÃ²ng láº·p
Sau khi `PendingFolders` = `[]`, flow Ä‘Ã£ duyá»‡t toÃ n bá»™ cÃ¢y folder vÃ  lÆ°u toÃ n bá»™ file vÃ o biáº¿n `AllFiles`.

---

## ğŸ”„ CÃ¡ch Flow xá»­ lÃ½ theo Depth-First (DFS):

Giáº£ sá»­ cÃ³ cáº¥u trÃºc:
```
FolderA/
  â”œâ”€â”€ A1/
  â”‚    â””â”€â”€ A1a/
  â””â”€â”€ A2/
FolderB/
```

Flow sáº½ duyá»‡t:
```
FolderA â†’ A1 â†’ A1a â†’ A2 â†’ FolderB
```

---

## ğŸ’¡ Gá»£i Ã½ thÃªm:
- Báº¡n cÃ³ thá»ƒ **gá»i tá»« UiPath qua HTTP request**, khi flow cha hoÃ n táº¥t thÃ¬ **tráº£ JSON** chá»©a toÃ n bá»™ `AllFiles` vá» cho UiPath xá»­ lÃ½.

---

## ğŸ—‚ Báº¡n cáº§n Flow máº«u?

MÃ¬nh cÃ³ thá»ƒ táº¡o file `.zip` máº«u gá»“m:
- Flow cha: `Recursive_GetAllFiles_Main`
- Flow con: `ReadFolder_GetFilesAndSubfolders`

Báº¡n muá»‘n mÃ¬nh chuáº©n bá»‹ giÃºp khÃ´ng? Náº¿u cÃ³ thÃ¬ cho biáº¿t tÃªn folder gá»‘c máº·c Ä‘á»‹nh hoáº·c báº¡n muá»‘n truyá»n tá»« UiPath.
