Ráº¥t hay! VÃ¬ Office Script **cÃ³ giá»›i háº¡n vá» kÃ­ch thÆ°á»›c vÃ¹ng `getRangeByIndexes`** mÃ  báº¡n Ä‘ang lÃ m viá»‡c vá»›i file lá»›n (nhiá»u hÆ¡n 5000 dÃ²ng hoáº·c 60 cá»™t), ta cáº§n:

---

## âœ… Cáº­p nháº­t chiáº¿n lÆ°á»£c: **DÃ² tá»«ng dÃ²ng vÃ  tá»«ng cá»™t theo cá»¥m (batch)**

- **TrÃ¡nh quÃ©t quÃ¡ nhiá»u Ã´ 1 lÃºc**.
- Chia viá»‡c quÃ©t dá»¯ liá»‡u thÃ nh **nhiá»u Ä‘á»£t nhá»** (vÃ­ dá»¥: 500 dÃ²ng má»—i láº§n).
- Khi tÃ¬m ra dÃ²ng cuá»‘i vÃ  sá»‘ cá»™t thá»±c táº¿ rá»“i, **chá»‰ trÃ­ch xuáº¥t Ä‘Ãºng vÃ¹ng thá»±c sá»±**.

---

## âœ… Code hoÃ n chá»‰nh cho dá»¯ liá»‡u lá»›n (cÃ³ thá»ƒ >5000 dÃ²ng, >60 cá»™t):

```ts
function main(workbook: ExcelScript.Workbook, columnNames: string[]): ColumnData[] {
  const sheet = workbook.getActiveWorksheet();

  const scanBatchRows = 500;
  const scanBatchCols = 20;

  const maxRowLimit = 100000; // tÃ¹y theo dá»¯ liá»‡u lá»›n cá»¡ nÃ o
  const maxColLimit = 100;    // tÄƒng lÃªn náº¿u báº¡n cÃ³ nhiá»u cá»™t

  // --- 1. XÃ¡c Ä‘á»‹nh sá»‘ cá»™t thá»±c táº¿ ---
  let lastCol = 0;
  for (let colStart = 0; colStart < maxColLimit; colStart += scanBatchCols) {
    const colCount = Math.min(scanBatchCols, maxColLimit - colStart);
    const range = sheet.getRangeByIndexes(0, colStart, 100, colCount); // chá»‰ cáº§n vÃ i dÃ²ng Ä‘áº§u
    const values = range.getValues();

    for (let j = 0; j < colCount; j++) {
      const colIndex = colStart + j;
      const hasData = values.some(row => row[j] !== "" && row[j] !== null);
      if (hasData && colIndex + 1 > lastCol) lastCol = colIndex + 1;
    }
  }

  // --- 2. XÃ¡c Ä‘á»‹nh dÃ²ng cuá»‘i cÃ¹ng cÃ³ dá»¯ liá»‡u ---
  let lastRow = 2; // báº¯t Ä‘áº§u tá»« dÃ²ng 3 (index = 2)
  for (let rowStart = 2; rowStart < maxRowLimit; rowStart += scanBatchRows) {
    const rowCount = Math.min(scanBatchRows, maxRowLimit - rowStart);
    const range = sheet.getRangeByIndexes(rowStart, 0, rowCount, lastCol);
    const values = range.getValues();

    for (let i = rowCount - 1; i >= 0; i--) {
      const rowIndex = rowStart + i;
      if (values[i].some(cell => cell !== "" && cell !== null)) {
        if (rowIndex + 1 > lastRow) lastRow = rowIndex + 1;
        break;
      }
    }
  }

  // --- 3. Láº¥y tiÃªu Ä‘á» tá»« dÃ²ng 1 ---
  const headerRange = sheet.getRangeByIndexes(0, 0, 1, lastCol);
  const headers = headerRange.getValues()[0] as string[];

  // --- 4. Láº¥y dá»¯ liá»‡u tá»« dÃ²ng 3 trá»Ÿ Ä‘i ---
  const dataRowCount = lastRow - 2;
  const dataRange = sheet.getRangeByIndexes(2, 0, dataRowCount, lastCol);
  const dataValues = dataRange.getValues();

  // --- 5. Tráº£ dá»¯ liá»‡u dáº¡ng [TÃªnCá»™t, [["1"], ["2"]] ...] ---
  let result: ColumnData[] = [];

  for (let name of columnNames) {
    const colIndex = headers.indexOf(name);
    if (colIndex === -1) continue;

    const columnData = dataValues.map(row => [String(row[colIndex] ?? "")]);
    result.push({
      columnName: name,
      values: columnData
    });
  }

  return result;
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

## âœ… Æ¯u Ä‘iá»ƒm:

| Äiá»ƒm máº¡nh | Giáº£i thÃ­ch |
|-----------|------------|
| âœ… KhÃ´ng bá»‹ timeout | Do chá»‰ quÃ©t tá»«ng cá»¥m nhá» |
| âœ… Dá»¯ liá»‡u lá»›n | CÃ³ thá»ƒ Ä‘á»c >100k dÃ²ng, >100 cá»™t |
| âœ… Tráº£ Ä‘Ãºng Ä‘á»‹nh dáº¡ng mong muá»‘n | `[TÃªnCá»™t, [["1"], ["2"]]]` |

---

## ğŸ”§ Cáº§n Ä‘iá»u chá»‰nh?

- TÄƒng `maxRowLimit` hoáº·c `maxColLimit` náº¿u báº¡n cÃ³ file ráº¥t lá»›n.
- CÃ³ thá»ƒ thÃªm `console.log` Ä‘á»ƒ debug náº¿u muá»‘n biáº¿t nÃ³ Ä‘ang Ä‘á»c Ä‘áº¿n Ä‘Ã¢u.

---

Báº¡n muá»‘n mÃ¬nh ghÃ©p Ä‘oáº¡n nÃ y vÃ o toÃ n bá»™ ká»‹ch báº£n Office Script + Power Automate Ä‘á»ƒ xá»­ lÃ½ luÃ´n file Ä‘Ã­ch khÃ´ng cÃ³ Table khÃ´ng?
