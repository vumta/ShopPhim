Ráº¥t rÃµ rÃ ng rá»“i! Báº¡n muá»‘n:

- âœ… Office Script **chá»‰ xá»­ lÃ½ 1 cá»™t** táº¡i má»™t thá»i Ä‘iá»ƒm (input lÃ  1 object Ä‘Æ¡n láº», khÃ´ng pháº£i array nhiá»u cá»™t).
- âœ… Power Automate **duyá»‡t qua tá»«ng cá»™t** trong output tá»« Excel nguá»“n, **tÃ¡ch ra tá»«ng `columnName` vÃ  `values`** â†’ rá»“i truyá»n tá»«ng cÃ¡i vÃ o script dÃ¡n dá»¯ liá»‡u.

---

## ğŸ§  TÃ³m táº¯t yÃªu cáº§u

1. TrÃ­ch nhiá»u cá»™t tá»« Excel nguá»“n
2. Tá»«ng cá»™t sáº½ Ä‘Æ°á»£c dÃ¡n riÃªng biá»‡t vÃ o Excel Ä‘Ã­ch (theo tÃªn cá»™t dÃ²ng 2)
3. Script pháº£i:
   - TÃ¬m Ä‘Ãºng cá»™t theo tÃªn
   - TÃ¬m dÃ²ng cuá»‘i cÃ¹ng Ä‘Ã£ cÃ³ dá»¯ liá»‡u
   - DÃ¡n xuá»‘ng dÃ²ng tiáº¿p theo

---

## âœ… PHáº¦N 1 â€” Office Script cáº­p nháº­t (nháº­n 1 cá»™t)

```ts
function main(workbook: ExcelScript.Workbook, inputData: ColumnData): void {
  const sheet = workbook.getActiveWorksheet();

  // 1. Äá»c tÃªn cá»™t tá»« dÃ²ng 2
  const maxCols = 100;
  const headerRow = sheet.getRangeByIndexes(1, 0, 1, maxCols).getValues()[0];
  let colMap: Record<string, number> = {};
  for (let i = 0; i < headerRow.length; i++) {
    const header = headerRow[i]?.toString().trim();
    if (header) colMap[header] = i;
  }

  // 2. TÃ¬m cá»™t Ä‘Ã­ch
  const colIndex = colMap[inputData.columnName];
  if (colIndex === undefined) return; // KhÃ´ng tÃ¬m tháº¥y cá»™t

  // 3. TÃ¬m dÃ²ng cuá»‘i cá»§a cá»™t Ä‘Ã³
  const checkRange = sheet.getRangeByIndexes(2, colIndex, 100000, 1);
  const colValues = checkRange.getValues();

  let lastRow = 2; // index báº¯t Ä‘áº§u dÃ¡n
  for (let i = colValues.length - 1; i >= 0; i--) {
    if (colValues[i][0] !== "" && colValues[i][0] !== null) {
      lastRow = i + 3;
      break;
    }
  }

  // 4. DÃ¡n dá»¯ liá»‡u
  const rowCount = inputData.values.length;
  const targetRange = sheet.getRangeByIndexes(lastRow, colIndex, rowCount, 1);
  targetRange.setValues(inputData.values);
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

## âœ… PHáº¦N 2 â€” HÆ°á»›ng dáº«n Power Automate chi tiáº¿t

### ğŸ¯ Má»¥c tiÃªu:
- Duyá»‡t tá»«ng file Excel nguá»“n
- TrÃ­ch dá»¯ liá»‡u tá»« cÃ¡c cá»™t Ä‘Ã£ chá»n
- DÃ¡n **tá»«ng cá»™t riÃªng biá»‡t** vÃ o file Excel Ä‘Ã­ch

---

### ğŸ§© Step-by-step Power Automate Flow

#### ğŸ”¹ Step 1: Trigger
- VÃ­ dá»¥: "Manually trigger a flow" (hoáº·c recurrence)

---

#### ğŸ”¹ Step 2: List Files (nguá»“n)
- `List files in folder` â†’ thÆ° má»¥c chá»©a file nguá»“n Excel

---

#### ğŸ”¹ Step 3: Apply to each (file nguá»“n)
**BÃªn trong vÃ²ng láº·p:**

##### ğŸŸ¦ a. Get file content
- Action: `Get file content using path` â†’ file Excel nguá»“n

##### ğŸŸ¦ b. Run script (Excel nguá»“n)
- Script: `TrichCotTheoTenCot` (tráº£ vá» toÃ n bá»™ data cÃ¡c cá»™t)
- Output: `outputData`  
  VÃ­ dá»¥:
```json
[
  {
    "columnName": "PhÃ²ng ban",
    "values": [["IT"], ["HR"], ["Finance"]]
  },
  {
    "columnName": "TÃªn",
    "values": [["Nam"], ["Lan"], ["HÃ¹ng"]]
  }
]
```

##### ğŸŸ¦ c. Parse JSON
- Content: `outputData`
- Schema:
```json
{
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "columnName": { "type": "string" },
      "values": {
        "type": "array",
        "items": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
```

---

#### ğŸ”¹ Step 4: Apply to each (cá»™t dá»¯ liá»‡u)
- Input: `body` tá»« Parse JSON (outputData array)
- Má»—i vÃ²ng láº·p xá»­ lÃ½ 1 object dáº¡ng:
```json
{
  "columnName": "PhÃ²ng ban",
  "values": [["IT"], ["HR"], ["Finance"]]
}
```

**BÃªn trong loop:**

##### ğŸŸ© a. Run script (Excel Ä‘Ã­ch)
- Script: `PasteOneColumnToCorrectRow`
- Input: entire item:
  - `columnName`: `items('Apply_to_each')?['columnName']`
  - `values`: `items('Apply_to_each')?['values']`

Báº¡n truyá»n cáº£ object `inputData` kiá»ƒu:

```json
{
  "columnName": "PhÃ²ng ban",
  "values": [["IT"], ["HR"], ["Finance"]]
}
```

---

## ğŸ“Œ TÃ³m táº¯t kiáº¿n trÃºc:

```text
Trigger
 â””â”€â”€ List Files
     â””â”€â”€ Apply to Each File
         â”œâ”€â”€ Get Content
         â”œâ”€â”€ Run Script (source)
         â”œâ”€â”€ Parse JSON
         â””â”€â”€ Apply to Each Column
             â””â”€â”€ Run Script (dest) â€” dÃ¡n 1 cá»™t
```

---

## ğŸ Báº¡n cáº§n thÃªm?

- HÃ¬nh áº£nh hÆ°á»›ng dáº«n thao tÃ¡c trong Power Automate Designer?
- MÃ¬nh táº¡o JSON máº«u (code view)?
- Tá»‘i Æ°u thÃªm: lá»c file theo tÃªn, bá» qua file trá»‘ng, log file Ä‘Ã£ xá»­ lÃ½?

Báº¡n muá»‘n mÃ¬nh há»— trá»£ pháº§n nÃ o thÃªm?
