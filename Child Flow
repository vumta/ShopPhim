Khi báº¡n gáº·p lá»—i vá»›i action **"Run a Child Flow"** nhÆ° `"Run a Child Flow not only user run"` hoáº·c tÆ°Æ¡ng tá»±, thÃ¬ nguyÃªn nhÃ¢n thÆ°á»ng lÃ  do **quyá»n truy cáº­p (permissions)** vÃ  **kiá»ƒu Flow trigger** chÆ°a Ä‘Ãºng. DÆ°á»›i Ä‘Ã¢y lÃ  phÃ¢n tÃ­ch vÃ  cÃ¡ch kháº¯c phá»¥c.

---

## â— NguyÃªn nhÃ¢n phá»• biáº¿n:

### âœ… 1. **Child Flow khÃ´ng dÃ¹ng Ä‘Ãºng trigger**
Child Flow báº¯t buá»™c pháº£i dÃ¹ng trigger:  
> **â€œManually trigger a flowâ€** tá»« loáº¡i **Power Apps / Flow trigger**

Náº¿u báº¡n dÃ¹ng trigger kiá»ƒu **â€œWhen an HTTP request is receivedâ€** hay **tá»± Ä‘á»™ng (automated)** thÃ¬ sáº½ khÃ´ng gá»i Ä‘Æ°á»£c tá»« action "Run a Child Flow".

ğŸ‘‰ **CÃ¡ch kiá»ƒm tra**:
- Má»Ÿ Child Flow
- Trigger pháº£i lÃ :  
  ![Manually trigger a flow icon](https://learn.microsoft.com/en-us/power-automate/media/child-flows/manual-trigger-flow-icon.png)  
  vÃ  khÃ´ng cÃ³ UI phá»©c táº¡p.

---

### âœ… 2. **Flow khÃ´ng náº±m trong cÃ¹ng má»™t Solution**

Action **â€œRun a Child Flowâ€** chá»‰ hoáº¡t Ä‘á»™ng náº¿u **cáº£ Parent vÃ  Child Ä‘á»u náº±m trong cÃ¹ng 1 Solution**.

ğŸ‘‰ **CÃ¡ch kháº¯c phá»¥c**:
- Náº¿u báº¡n táº¡o ngoÃ i Solution â†’ pháº£i export rá»“i import láº¡i **vÃ o Solution**.

---

### âœ… 3. **Thiáº¿u quyá»n chia sáº» Child Flow**

DÃ¹ cÃ¹ng Solution, nhÆ°ng náº¿u báº¡n **khÃ´ng chia sáº» quyá»n cháº¡y Child Flow cho chÃ­nh báº¡n hoáº·c nhá»¯ng ngÆ°á»i dÃ¹ng khÃ¡c** thÃ¬ sáº½ lá»—i.

ğŸ‘‰ **Kháº¯c phá»¥c**:
- Má»Ÿ **Child Flow**
- Báº¥m **Share**
- ThÃªm chÃ­nh báº¡n (hoáº·c account cá»§a Parent Flow)

---

### âœ… 4. **User khÃ´ng pháº£i lÃ  owner hoáº·c khÃ´ng cÃ³ quyá»n cháº¡y**

ÄÃ´i khi tÃ i khoáº£n cháº¡y Parent Flow khÃ´ng cÃ³ quyá»n cháº¡y Flow con.

ğŸ‘‰ Share Flow vá»›i user Ä‘Ã³, Ä‘áº£m báº£o user:
- LÃ  **Owner** hoáº·c cÃ³ quyá»n **Run Only**
- ÄÆ°á»£c chia sáº» site SharePoint vÃ  cÃ¡c connection liÃªn quan (SharePoint, Power Automate, OneDrive, v.v.)

---

## âœ… TÃ³m táº¯t cÃ¡ch kháº¯c phá»¥c:

| Kiá»ƒm tra | CÃ¡ch sá»­a |
|----------|----------|
| Trigger cá»§a Child Flow | DÃ¹ng "Manually trigger a flow" |
| Flow khÃ´ng náº±m trong Solution | Di chuyá»ƒn cáº£ hai vÃ o cÃ¹ng 1 Solution |
| ChÆ°a chia sáº» Flow | Share Flow vá»›i chÃ­nh báº¡n hoáº·c user cháº¡y |
| User khÃ´ng Ä‘á»§ quyá»n | Kiá»ƒm tra quyá»n Run Only & Connection |
| KhÃ´ng cÃ¹ng mÃ´i trÆ°á»ng | Äáº£m báº£o Ä‘ang lÃ m trong cÃ¹ng 1 Environment |

---

## âœ… Gá»£i Ã½ test nhanh:

1. Táº¡o Solution má»›i
2. Táº¡o Child Flow vá»›i trigger â€œManually triggerâ€
3. Táº¡o Parent Flow vÃ  gá»i Child
4. Cáº£ 2 flow do báº¡n táº¡o (cháº¯c cháº¯n cÃ³ quyá»n)
5. Test luÃ´n tá»« Power Automate â†’ Ä‘áº£m báº£o khÃ´ng lá»—i

---

Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ chuáº©n bá»‹:
- Má»™t Solution máº«u gá»“m cáº£ Parent + Child Flow
- KÃ¨m hÆ°á»›ng dáº«n import

Báº¡n muá»‘n mÃ¬nh gá»­i Solution máº«u khÃ´ng?
=========================================================================================
Tuyá»‡t vá»i! DÆ°á»›i Ä‘Ã¢y lÃ  **hÆ°á»›ng dáº«n chi tiáº¿t tá»«ng bÆ°á»›c (step-by-step)** Ä‘á»ƒ xÃ¢y dá»±ng giáº£i phÃ¡p **Power Automate sá»­ dá»¥ng Child Flow vÃ  Parent Flow**, cho phÃ©p báº¡n láº¥y **táº¥t cáº£ file trong thÆ° má»¥c SharePoint bao gá»“m cáº£ subfolder**, **khÃ´ng cáº§n Ä‘á»‡ quy tháº­t sá»±**.

---

## ğŸ§± Tá»•ng quan giáº£i phÃ¡p

| Flow | Vai trÃ² |
|------|--------|
| **Child Flow** | Nháº­n `FolderPath`, tráº£ vá» danh sÃ¡ch file & subfolder 1 cáº¥p |
| **Parent Flow** | Quáº£n lÃ½ danh sÃ¡ch folder chá» xá»­ lÃ½ (giáº£ láº­p Ä‘á»‡ quy), gá»i Child Flow cho tá»«ng folder |

---

## ğŸ§° YÃªu cáº§u trÆ°á»›c khi báº¯t Ä‘áº§u:

- Táº¡o má»™t **Solution** trong Power Automate
- Báº­t **Child Flow Support**
- Táº¡o cáº£ **Child Flow vÃ  Parent Flow trong cÃ¹ng Solution**

---

## ğŸŸ¨ BÆ¯á»šC 1: Táº¡o Solution

1. Truy cáº­p [Power Automate Portal](https://make.powerautomate.com)
2. Chá»n **Solutions** > **+ New solution**
   - **Name**: `GetAllFilesSolution`
   - **Publisher**: Chá»n hoáº·c táº¡o
3. Má»Ÿ Solution Ä‘Ã³

---

## ğŸŸ© BÆ¯á»šC 2: Táº¡o **Child Flow** â€“ xá»­ lÃ½ 1 folder

### ğŸ¯ Má»¥c tiÃªu:
- Input: `FolderPath`
- Output:
  - `Files`: Danh sÃ¡ch file trong thÆ° má»¥c
  - `SubFolders`: Danh sÃ¡ch folder con

### âœï¸ Táº¡o Flow

1. Trong Solution: **+ New > Cloud Flow > Instant Cloud Flow**
2. TÃªn: `GetFolderContent`
3. Trigger: **Manually trigger a flow**
4. Add Input:
   - `FolderPath` (Kiá»ƒu Text)

### ğŸ”§ CÃ¡c bÆ°á»›c trong Flow

#### 1. Khá»Ÿi táº¡o biáº¿n:
- `Files` (Array): `[]`
- `SubFolders` (Array): `[]`

#### 2. Action: `List folder`
- **Site**: chá»n site SharePoint
- **Folder Path**: `FolderPath` (input cá»§a trigger)

#### 3. Apply to each: `value` cá»§a `List folder`

BÃªn trong:

##### a. Náº¿u lÃ  file:
- DÃ¹ng Ä‘iá»u kiá»‡n:
```plaintext
empty(items('Apply_to_each')?['Folder'])
```
- Náº¿u Ä‘Ãºng â†’ `Append to array variable` `Files`
  ```json
  {
    "Name": "@items('Apply_to_each')?['Name']",
    "Path": "@items('Apply_to_each')?['Path']"
  }
  ```

##### b. Náº¿u lÃ  folder:
- `Append to array variable` `SubFolders` â†’ `items('Apply_to_each')?['Path']`

#### 4. Response:
- Add action: `Respond to a PowerApp or flow`
- Output:
  - `Files` â†’ variable `Files`
  - `SubFolders` â†’ variable `SubFolders`

---

## ğŸŸ¦ BÆ¯á»šC 3: Táº¡o **Parent Flow** â€“ xá»­ lÃ½ Ä‘á»‡ quy

1. Trong cÃ¹ng Solution â†’ **+ New > Cloud Flow > Instant**
2. TÃªn: `GetAllFilesRecursively`
3. Trigger: `Manually trigger a flow`
4. Input: `RootFolderPath` (Text)

---

### âœï¸ BÃªn trong Parent Flow

#### 1. Khá»Ÿi táº¡o biáº¿n:
- `PendingFolders` (Array) â†’ `createArray(triggerBody()['RootFolderPath'])`
- `AllFiles` (Array) â†’ `[]`

#### 2. Do Until:
- Äiá»u kiá»‡n: `length(variables('PendingFolders'))` is equal to `0`

---

### ğŸ§© BÃªn trong Do Until

#### a. **Láº¥y folder Ä‘áº§u tiÃªn**
- Compose: `first(variables('PendingFolders'))`

#### b. **Cáº­p nháº­t PendingFolders (xÃ³a folder Ä‘áº§u tiÃªn)**
- Set variable `PendingFolders`:
  - `skip(variables('PendingFolders'), 1)`

#### c. **Gá»i Child Flow**
- Action: `Run a Child Flow`
  - Flow: `GetFolderContent`
  - Input: `FolderPath`: output cá»§a Compose

â†’ Child Flow sáº½ tráº£ vá»:
- `Files`
- `SubFolders`

#### d. **Append vÃ o AllFiles**
- `Append to array variable` â†’ `AllFiles`
- Value: `outputs('Run_a_Child_Flow')?['body/Files']`  
  (nhá»› chá»n Ä‘Ãºng tÃªn output)

> **Náº¿u cáº§n gá»™p máº£ng**: dÃ¹ng `union(variables('AllFiles'), body('Run_a_Child_Flow')?['Files'])`

#### e. **Append SubFolders vÃ o PendingFolders**
- Append array: `PendingFolders` â† `outputs('Run_a_Child_Flow')?['body/SubFolders']`

---

### âœ… Sau `Do Until`: AllFiles chá»©a toÃ n bá»™ danh sÃ¡ch file SharePoint.

Báº¡n cÃ³ thá»ƒ:
- Export ra Excel
- Log báº±ng Compose
- Gá»­i mail
- Upload file log

---

## ğŸ BONUS: Gá»£i Ã½ xuáº¥t ra Excel (náº¿u cáº§n)
- Táº¡o máº£ng `AllFiles` vá»›i cÃ¡c field nhÆ° `Name`, `Path`
- DÃ¹ng "Create CSV table" â†’ tá»« `AllFiles`
- "Create file" â†’ Excel/CSV trong OneDrive/SharePoint

---

## â“Báº¡n cÃ³ thá»ƒ muá»‘n:
- JSON máº«u Ä‘á»ƒ import vÃ o Power Automate?
- HÆ°á»›ng dáº«n thÃªm xuáº¥t káº¿t quáº£ ra Excel?

Chá»‰ cáº§n gá»­i cho mÃ¬nh:
- TÃªn site SharePoint
- Folder gá»‘c (náº¿u báº¡n cÃ³ cá»¥ thá»ƒ)
MÃ¬nh sáº½ chuáº©n bá»‹ luÃ´n Flow máº«u Ä‘á»ƒ báº¡n chá»‰ cáº§n import vÃ  chá»‰nh sá»­a nháº¹ ğŸ”§








=======================================================================================================================================================================================================
DÆ°á»›i Ä‘Ã¢y lÃ  **hÆ°á»›ng dáº«n step-by-step sá»­ dá»¥ng Child Flow** trong Power Automate Ä‘á»ƒ **láº¥y toÃ n bá»™ file trong SharePoint bao gá»“m cáº£ subfolder**, báº±ng cÃ¡ch Ä‘á»‡ quy chÃ­nh Flow con gá»i láº¡i chÃ­nh nÃ³.

---

## âœ… Tá»•ng quan giáº£i phÃ¡p dÃ¹ng **Child Flow (Recursive)**

1. Táº¡o **1 Child Flow** (Flow con), nháº­n `FolderPath` lÃ m input.
2. Flow con:
   - Gá»i `List folder` Ä‘á»ƒ láº¥y file vÃ  folder con.
   - Náº¿u gáº·p **file** â†’ lÆ°u vÃ o máº£ng káº¿t quáº£.
   - Náº¿u gáº·p **folder** â†’ gá»i láº¡i chÃ­nh **Child Flow**, truyá»n vÃ o path folder con.
   - Gá»™p káº¿t quáº£ file cá»§a mÃ¬nh + tá»« cÃ¡c flow con tráº£ vá».
3. Táº¡o **Parent Flow** (Flow chÃ­nh) â†’ chá»‰ viá»‡c gá»i Child Flow 1 láº§n vá»›i Folder gá»‘c.

---

## ğŸ§± Äiá»u kiá»‡n báº¯t buá»™c:
- Flow pháº£i náº±m trong **Solution**
- Báº­t **Child Flows support**
- Cáº§n sá»­ dá»¥ng action **"Run a Child Flow"**

---

## ğŸŸ¨ BÆ°á»›c 1: Táº¡o Solution vÃ  Flow

1. VÃ o Power Automate > Chá»n **Solutions** > New Solution (náº¿u chÆ°a cÃ³)
2. Má»Ÿ Solution â†’ chá»n **+ New > Cloud flow > Instant cloud flow**
3. Táº¡o Flow con: Ä‘áº·t tÃªn vÃ­ dá»¥ `GetFilesRecursively`
   - Trigger: **Manually trigger a flow**
   - Add input: `FolderPath` (kiá»ƒu Text)

---

## ğŸŸ© BÆ°á»›c 2: Trong Flow con â€“ xá»­ lÃ½ Ä‘á»‡ quy

### ğŸŸ¦ Biáº¿n khá»Ÿi táº¡o:

- **Initialize Variable**: `AllFiles`  
  - Type: Array  
  - Value: `[]`

---

### ğŸŸ¦ List folder content:

- Action: `List folder`
  - Site: chá»n Site SharePoint
  - Folder path: `FolderPath` (láº¥y tá»« trigger input)

---

### ğŸŸ¦ Loop qua tá»«ng item (file/folder)

- **Apply to each**: `value` cá»§a `List folder`

BÃªn trong:

#### â¤ Náº¿u lÃ  **file**:
- Äiá»u kiá»‡n:
  ```plaintext
  empty(items('Apply_to_each')?['Folder'])
  ```
- Náº¿u Ä‘Ãºng â†’ `Append to array variable` â†’ `AllFiles`
  - Value:
    ```json
    {
      "Name": "@items('Apply_to_each')?['Name']",
      "Path": "@items('Apply_to_each')?['Path']"
    }
    ```

#### â¤ Náº¿u lÃ  **folder**:
- Gá»i láº¡i chÃ­nh Flow con (Ä‘á»‡ quy):

- **Run a Child Flow**:
  - Flow: chá»n chÃ­nh `GetFilesRecursively`
  - Input:  
    `FolderPath`: `items('Apply_to_each')?['Path']`

- Sau Ä‘Ã³, **Append káº¿t quáº£** vÃ o `AllFiles`

  - DÃ¹ng action: `Append to array variable`
  - Value: `outputs('Run_a_Child_Flow')?['body']`

---

### ğŸŸ¦ Sau vÃ²ng láº·p: Tráº£ káº¿t quáº£ ra

- **Response**: Tráº£ láº¡i `AllFiles`  
  - Body: `AllFiles`

---

## ğŸŸ¨ BÆ°á»›c 3: Táº¡o Flow chÃ­nh gá»i Child Flow

1. Trong cÃ¹ng Solution â†’ táº¡o 1 Cloud Flow má»›i (Instant hoáº·c Scheduled)
2. Add action: **Run a Child Flow**
   - Chá»n flow: `GetFilesRecursively`
   - Input: `FolderPath`: vÃ­ dá»¥ `"Shared Documents/Reports"`

3. Sau Ä‘Ã³ cÃ³ thá»ƒ:
   - Log ra káº¿t quáº£
   - Xuáº¥t ra Excel
   - DÃ¹ng káº¿t quáº£ tiáº¿p tá»¥c xá»­ lÃ½

---

## âœ… Káº¿t quáº£
- `AllFiles` lÃ  máº£ng chá»©a **toÃ n bá»™ file trong thÆ° má»¥c gá»‘c vÃ  má»i subfolder**, khÃ´ng giá»›i háº¡n cáº¥p Ä‘á»™ lá»“ng.

---

## ğŸ” Æ¯u Ä‘iá»ƒm cá»§a dÃ¹ng Child Flow:

- Cá»±c ká»³ dá»… hiá»ƒu & gá»n.
- KhÃ´ng cáº§n xá»­ lÃ½ queue hay vÃ²ng láº·p thá»§ cÃ´ng.
- Má»—i folder xá»­ lÃ½ riÃªng â†’ dá»… debug vÃ  chia nhá» thá»i gian cháº¡y.

---

## ğŸš€ Náº¿u báº¡n muá»‘n:
MÃ¬nh cÃ³ thá»ƒ cung cáº¥p **Flow máº«u JSON** cho cáº£ Parent vÃ  Child Flow Ä‘á»ƒ báº¡n import trá»±c tiáº¿p â€“ chá»‰ cáº§n báº¡n cho mÃ¬nh:

- **Site SharePoint**
- **ThÆ° má»¥c gá»‘c cáº§n duyá»‡t**

Báº¡n muá»‘n mÃ¬nh xuáº¥t JSON máº«u khÃ´ng?
