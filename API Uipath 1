CÃ¢u tráº£ lá»i ngáº¯n: âœ… **CÃ³ thá»ƒ**, nhÆ°ng báº¡n **pháº£i cÃ³ quyá»n Ä‘Äƒng kÃ½ App** vÃ  App Ä‘Ã³ pháº£i Ä‘Æ°á»£c **cáº¥p quyá»n truy cáº­p SharePoint Online API (Graph hoáº·c REST)** trong Azure â€” náº¿u khÃ´ng sáº½ **khÃ´ng thá»ƒ truy cáº­p SharePoint báº±ng HTTP Request dÃ¹ cÃ³ Username, Password, Client ID**.

---

## ğŸ¯ TrÆ°á»ng há»£p cá»§a báº¡n:

Báº¡n cÃ³:
- âœ… `Client ID` (Application ID)
- âœ… `Username` (ngÆ°á»i dÃ¹ng khÃ´ng MFA)
- âœ… `Password`
- âœ… Muá»‘n truy cáº­p SharePoint Ä‘á»ƒ **láº¥y táº¥t cáº£ file trong folder (ká»ƒ cáº£ subfolder)** báº±ng UiPath

Váº­y ta sáº½ dÃ¹ng **ROPC flow** Ä‘á»ƒ láº¥y Access Token â†’ Gá»i SharePoint REST API.

---

## ğŸ” 1. ROPC Flow - Láº¥y Access Token

### ğŸ“Œ Endpoint:

```
https://login.microsoftonline.com/<TENANT_ID>/oauth2/v2.0/token
```

**Náº¿u khÃ´ng cÃ³ Tenant ID** â†’ cÃ³ thá»ƒ dÃ¹ng `common` hoáº·c `organizations`, nhÆ°ng **khuyáº¿n nghá»‹ cÃ³ tenant ID rÃµ rÃ ng**.

---

### ğŸ“Œ Body (x-www-form-urlencoded):

```text
client_id=YOUR_CLIENT_ID
&scope=https%3A%2F%2F<sharepoint_domain>%2F.default
&username=YOUR_USERNAME
&password=YOUR_PASSWORD
&grant_type=password
```

> â— `scope` vá»›i SharePoint pháº£i lÃ :  
> `https://contoso.sharepoint.com/.default`

---

### ğŸ›‘ LÆ°u Ã½:
- App pháº£i Ä‘Æ°á»£c **cáº¥p quyá»n SharePoint (Delegated)** trong Azure App Registration.
- Náº¿u chÆ°a Ä‘Æ°á»£c cáº¥p â†’ báº¡n sáº½ nháº­n lá»—i `access_denied` hoáº·c `invalid_scope`.

---

## ğŸŒ 2. Gá»i SharePoint REST API Ä‘á»ƒ láº¥y danh sÃ¡ch file

### ğŸ“Œ Endpoint:

```http
GET https://contoso.sharepoint.com/sites/TestSite/_api/web/GetFolderByServerRelativeUrl('/sites/TestSite/Shared Documents/Reports')/Files?$expand=ListItemAllFields
```

- Hoáº·c Ä‘á»ƒ láº¥y cáº£ **subfolder**, báº¡n sáº½ pháº£i dÃ¹ng:
```http
GET .../Folders?$expand=Folders,Files
```

---

### ğŸ“Œ Header:

```
Authorization: Bearer <ACCESS_TOKEN>
Accept: application/json;odata=verbose
```

---

## âœ… CÃ¡c bÆ°á»›c trong UiPath

### Step-by-step:

#### 1. `Assign`: Chuáº©n bá»‹ `requestBody` (cho ROPC)

```vb
requestBody = "client_id=" + clientId + 
              "&scope=https%3A%2F%2Fcontoso.sharepoint.com%2F.default" + 
              "&username=" + username + 
              "&password=" + password + 
              "&grant_type=password"
```

#### 2. `HTTP Request`: Láº¥y token

- Method: `POST`
- URL: `https://login.microsoftonline.com/contoso.onmicrosoft.com/oauth2/v2.0/token`
- Headers: `Content-Type = application/x-www-form-urlencoded`
- Body: `requestBody`
- Output: `tokenResponse`

#### 3. `Deserialize JSON`: Láº¥y `access_token` tá»« `tokenResponse`

```vb
accessToken = jsonObj("access_token").ToString
```

#### 4. `HTTP Request`: Gá»i SharePoint API

- Method: `GET`
- URL: `https://contoso.sharepoint.com/sites/TestSite/_api/web/GetFolderByServerRelativeUrl('/sites/TestSite/Shared Documents/Reports')/Folders?$expand=Folders,Files`
- Headers:
  - `Authorization = Bearer ` + accessToken
  - `Accept = application/json;odata=verbose`
- Output: `folderListJson`

#### 5. `Deserialize JSON` + `Loop` Ä‘á»ƒ Ä‘á»c danh sÃ¡ch file

---

## ğŸ Báº¡n cáº§n gÃ¬ tiáº¿p theo?

- ğŸ“‚ File `.xaml` máº«u láº¥y token vÃ  gá»i SharePoint
- ğŸ“„ Gá»£i Ã½ máº«u cáº¥u trÃºc response JSON Ä‘á»ƒ Ä‘á»c file
- ğŸ“¥ Máº«u flow Power Automate thay tháº¿ náº¿u khÃ´ng cÃ³ quyá»n cáº¥p API

Chá»‰ cáº§n nÃ³i: **â€œGá»­i máº«u .xamlâ€** lÃ  mÃ¬nh gá»­i liá»n nhÃ©!
