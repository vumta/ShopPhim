DÆ°á»›i Ä‘Ã¢y lÃ  phiÃªn báº£n Ä‘Æ°á»£c cáº­p nháº­t hoÃ n chá»‰nh cá»§a Ä‘oáº¡n code VBA Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh hoáº¡t Ä‘á»™ng. Äá»“ng thá»i, tÃ´i sáº½ hÆ°á»›ng dáº«n tá»«ng bÆ°á»›c chi tiáº¿t cÃ¡ch triá»ƒn khai nÃ³:

---

### **Cáº­p nháº­t code VBA**

```vba
Public Function ConsolidateMultipleFiles(ByVal sourceFilePaths As String, ByVal targetFilePath As String, ByVal targetSheetName As String, ByVal columnsToCopy As String) As String
    Dim sourceFiles() As String
    Dim sourceWorkbook As Workbook
    Dim targetWorkbook As Workbook
    Dim sourceSheet As Worksheet
    Dim targetSheet As Worksheet
    Dim sourceColumns() As String
    Dim targetCol As Integer
    Dim lastRowSource As Long
    Dim lastRowTarget As Long
    Dim sourceData As Variant
    Dim i As Integer, j As Integer

    On Error GoTo ErrorHandler

    ' PhÃ¢n tÃ¡ch danh sÃ¡ch cÃ¡c file nguá»“n tá»« chuá»—i, cÃ¡ch nhau bá»Ÿi dáº¥u pháº©y
    sourceFiles = Split(sourceFilePaths, ",")

    ' Má»Ÿ file Ä‘Ã­ch
    Set targetWorkbook = Workbooks.Open(targetFilePath)
    Set targetSheet = targetWorkbook.Sheets(targetSheetName) ' XÃ¡c Ä‘á»‹nh sheet má»¥c tiÃªu trong file Ä‘Ã­ch

    ' Chuyá»ƒn cÃ¡c tÃªn cá»™t tá»« chuá»—i thÃ nh máº£ng
    sourceColumns = Split(columnsToCopy, ",")

    ' XÃ³a dá»¯ liá»‡u cÅ© trong file Ä‘Ã­ch nhÆ°ng giá»¯ láº¡i tiÃªu Ä‘á»
    If Application.CountA(targetSheet.Rows(2)) > 0 Then
        targetSheet.Rows("2:" & targetSheet.Rows.Count).ClearContents
    End If

    ' Duyá»‡t qua tá»«ng file nguá»“n
    For i = LBound(sourceFiles) To UBound(sourceFiles)
        ' Má»Ÿ file nguá»“n
        Set sourceWorkbook = Workbooks.Open(Trim(sourceFiles(i)))
        Set sourceSheet = sourceWorkbook.Sheets(1) ' Láº¥y sheet Ä‘áº§u tiÃªn trong file nguá»“n

        ' XÃ¡c Ä‘á»‹nh dÃ²ng cuá»‘i cÃ¹ng trong dá»¯ liá»‡u file nguá»“n
        lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, 1).End(xlUp).Row

        ' XÃ¡c Ä‘á»‹nh dÃ²ng cuá»‘i cÃ¹ng trong dá»¯ liá»‡u file Ä‘Ã­ch
        lastRowTarget = targetSheet.Cells(targetSheet.Rows.Count, 1).End(xlUp).Row + 1

        ' Duyá»‡t qua cÃ¡c cá»™t Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh
        For j = LBound(sourceColumns) To UBound(sourceColumns)
            ' TÃ¬m cá»™t nguá»“n dá»±a trÃªn tÃªn cá»™t
            Dim sourceCol As Integer
            On Error Resume Next
            sourceCol = Application.Match(sourceColumns(j), sourceSheet.Rows(1), 0)
            On Error GoTo 0

            If sourceCol > 0 Then
                ' XÃ¡c Ä‘á»‹nh dÃ²ng cuá»‘i cÃ¹ng cá»§a dá»¯ liá»‡u trong cá»™t nguá»“n
                lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, sourceCol).End(xlUp).Row

                ' Sao chÃ©p dá»¯ liá»‡u tá»« cá»™t nguá»“n
                sourceData = sourceSheet.Range(sourceSheet.Cells(2, sourceCol), sourceSheet.Cells(lastRowSource, sourceCol)).Value

                ' TÃ¬m cá»™t Ä‘Ã­ch dá»±a trÃªn tÃªn cá»™t
                targetCol = Application.Match(sourceColumns(j), targetSheet.Rows(1), 0)

                If targetCol > 0 Then
                    ' DÃ¡n dá»¯ liá»‡u vÃ o cá»™t Ä‘Ã­ch táº¡i file Ä‘Ã­ch
                    targetSheet.Range(targetSheet.Cells(lastRowTarget, targetCol), _
                                      targetSheet.Cells(lastRowTarget + UBound(sourceData, 1) - 1, targetCol)).Value = sourceData
                Else
                    ConsolidateMultipleFiles = "Lá»—i: KhÃ´ng tÃ¬m tháº¥y cá»™t Ä‘Ã­ch cho " & sourceColumns(j) & " trong file Ä‘Ã­ch."
                    GoTo CleanUp
                End If
            Else
                ConsolidateMultipleFiles = "Lá»—i: KhÃ´ng tÃ¬m tháº¥y cá»™t nguá»“n cho " & sourceColumns(j) & " trong file nguá»“n."
                GoTo CleanUp
            End If
        Next j

        ' ÄÃ³ng file nguá»“n
        sourceWorkbook.Close False
    Next i

    ' LÆ°u vÃ  Ä‘Ã³ng file Ä‘Ã­ch
    targetWorkbook.Save
    targetWorkbook.Close True

    ConsolidateMultipleFiles = "ThÃ nh cÃ´ng: Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c sao chÃ©p tá»« nhiá»u file nguá»“n vÃ o file Ä‘Ã­ch."
    Exit Function

ErrorHandler:
    ConsolidateMultipleFiles = "Lá»—i: ÄÃ£ xáº£y ra lá»—i trong quÃ¡ trÃ¬nh thá»±c thi: " & Err.Description

CleanUp:
    ' ÄÃ³ng file náº¿u cáº§n thiáº¿t
    If Not sourceWorkbook Is Nothing Then sourceWorkbook.Close False
    If Not targetWorkbook Is Nothing Then targetWorkbook.Close True
End Function
```

---

### **HÆ°á»›ng dáº«n Step-by-Step**

#### **1. Chuáº©n bá»‹ file VBA**
- LÆ°u Ä‘oáº¡n mÃ£ trÃªn vÃ o file `.bas`:
  - Má»Ÿ VBA Editor trong Excel (Alt + F11).
  - Chá»n `File > Import File` Ä‘á»ƒ import file `.bas`.

#### **2. Thiáº¿t láº­p dá»¯ liá»‡u**
- **CÃ¡c file nguá»“n** (`sourceFilePaths`):
  - Chuáº©n bá»‹ danh sÃ¡ch Ä‘Æ°á»ng dáº«n Ä‘áº§y Ä‘á»§ Ä‘áº¿n cÃ¡c file nguá»“n, phÃ¢n cÃ¡ch báº±ng dáº¥u pháº©y:
    ```
    "C:\DuongDan\FileNguon1.xlsx,C:\DuongDan\FileNguon2.xlsx"
    ```

- **File Ä‘Ã­ch** (`targetFilePath`):
  - Äáº£m báº£o file Ä‘Ã­ch Ä‘Ã£ tá»“n táº¡i. Náº¿u chÆ°a cÃ³, táº¡o má»™t file Excel má»›i.

- **TÃªn sheet Ä‘Ã­ch** (`targetSheetName`):
  - XÃ¡c Ä‘á»‹nh tÃªn cá»§a sheet trong file Ä‘Ã­ch nÆ¡i báº¡n muá»‘n há»£p nháº¥t dá»¯ liá»‡u.

- **TÃªn cÃ¡c cá»™t** (`columnsToCopy`):
  - Danh sÃ¡ch cÃ¡c tÃªn cá»™t cáº§n sao chÃ©p, phÃ¢n cÃ¡ch báº±ng dáº¥u pháº©y:
    ```
    "Column1,Column2,Column3"
    ```

#### **3. Triá»ƒn khai UiPath**
1. **Sá»­ dá»¥ng Excel Application Scope**:
   - DÃ¹ng hoáº¡t Ä‘á»™ng `Excel Application Scope` Ä‘á»ƒ má»Ÿ file Excel Ä‘Ã­ch chá»©a macro VBA.

2. **Invoke VBA**:
   - ThÃªm activity `Invoke VBA` vÃ o workflow.
   - CÃ i Ä‘áº·t:
     - **Macro Name**: Äiá»n tÃªn macro lÃ  `ConsolidateMultipleFiles`.
     - **Parameters**: Truyá»n giÃ¡ trá»‹:
       - `sourceFilePaths`: Danh sÃ¡ch cÃ¡c file nguá»“n.
       - `targetFilePath`: ÄÆ°á»ng dáº«n file Ä‘Ã­ch.
       - `targetSheetName`: TÃªn sheet trong file Ä‘Ã­ch.
       - `columnsToCopy`: Danh sÃ¡ch cÃ¡c cá»™t.

#### **4. Cháº¡y vÃ  kiá»ƒm tra**
- Cháº¡y workflow trong UiPath.
- Kiá»ƒm tra file Ä‘Ã­ch Ä‘á»ƒ xÃ¡c nháº­n dá»¯ liá»‡u tá»« táº¥t cáº£ file nguá»“n Ä‘Ã£ Ä‘Æ°á»£c há»£p nháº¥t.

Náº¿u cÃ³ báº¥t ká»³ váº¥n Ä‘á» gÃ¬ hoáº·c cáº§n hÆ°á»›ng dáº«n chi tiáº¿t hÆ¡n, hÃ£y cho tÃ´i biáº¿t nhÃ©! ğŸ˜Š
