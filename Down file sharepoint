Tuyá»‡t vá»i, Ä‘á»ƒ táº£i toÃ n bá»™ folder tá»« **SharePoint** vá» mÃ¡y tÃ­nh **local** báº±ng **UiPath**, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n theo 2 cÃ¡ch chÃ­nh:

---

### ğŸ…°ï¸ CÃ¡ch 1: Sá»­ dá»¥ng **UiPath Microsoft365 Activities (Graph API)**
ÄÃ¢y lÃ  cÃ¡ch chuáº©n, sá»­ dá»¥ng **Microsoft 365 Scope** Ä‘á»ƒ truy cáº­p SharePoint.

---

#### âœ… YÃªu cáº§u chuáº©n bá»‹:

1. **TÃ i khoáº£n Office 365** cÃ³ quyá»n truy cáº­p thÆ° má»¥c SharePoint.
2. **ÄÄƒng kÃ½ á»©ng dá»¥ng Azure AD (App Registration)** (náº¿u báº¡n khÃ´ng dÃ¹ng account cá»§a UiPath Apps).
3. CÃ i package:
   - `UiPath.MicrosoftOffice365.Activities`

---

### ğŸ§­ Step-by-step:

#### ğŸ”¹ BÆ°á»›c 1: CÃ i Package
- Má»Ÿ **Manage Packages** trong UiPath Studio.
- CÃ i: `UiPath.MicrosoftOffice365.Activities`

---

#### ğŸ”¹ BÆ°á»›c 2: Thiáº¿t láº­p Microsoft 365 Scope

- KÃ©o **Microsoft365 Scope** vÃ o flow.
- Äiá»n cÃ¡c thÃ´ng tin:
  - **Application ID**, **Tenant ID**, **Client Secret** (tá»« Azure AD).
  - **Services**: chá»n `SharePoint`, `Files`, `Sites`.

---

#### ğŸ”¹ BÆ°á»›c 3: DÃ¹ng â€œFind Files and Foldersâ€ Ä‘á»ƒ láº¥y danh sÃ¡ch file trong folder

- KÃ©o activity **Find Files and Folders**.
- Set `Parent Folder`: `"Shared Documents/TenFolderCuaBan"`  
  (Ä‘Æ°á»ng dáº«n tÃ­nh tá»« gá»‘c Document Library)
- Output: `sharepointFiles` (List of DriveItem)

---

#### ğŸ”¹ BÆ°á»›c 4: DÃ¹ng â€œDownload Fileâ€ Ä‘á»ƒ táº£i tá»«ng file

- DÃ¹ng For Each: `For Each file In sharepointFiles`
- BÃªn trong:
  - **Download File**
    - DriveItem: `file`
    - LocalPath: `"C:\DuongDanLocal\" + file.Name`

---

### ğŸ…±ï¸ CÃ¡ch 2: Sá»­ dá»¥ng giao diá»‡n web SharePoint + UiPath UI Automation (Ã­t khuyáº¿n khÃ­ch)

Náº¿u khÃ´ng dÃ¹ng Ä‘Æ°á»£c API thÃ¬ cÃ³ thá»ƒ:

---

#### ğŸ§­ Step-by-step:

1. Má»Ÿ Chrome/Edge vÃ  Ä‘Äƒng nháº­p vÃ o SharePoint Ä‘áº¿n Ä‘Ãºng folder báº¡n cáº§n táº£i.
2. DÃ¹ng UiPath:
   - **Open Browser**: má»Ÿ Ä‘Æ°á»ng dáº«n SharePoint folder.
   - **Click** vÃ o nÃºt `Download` hoáº·c chá»n `Sync` (náº¿u cÃ³).
   - Hoáº·c: Select all â†’ Click Download â†’ Táº£i `.zip`
3. DÃ¹ng `Wait for Download` + `Move File` Ä‘á»ƒ chuyá»ƒn file zip vá» folder Ä‘Ã­ch.
4. DÃ¹ng activity `Unzip Files` Ä‘á»ƒ giáº£i nÃ©n vá» thÆ° má»¥c local.

---

### ğŸ§  Máº¹o:

- Náº¿u folder SharePoint lá»›n vÃ  báº¡n cÃ³ quyá»n truy cáº­p tá»‘t, Æ°u tiÃªn dÃ¹ng **Graph API** (CÃ¡ch 1) â†’ cháº¡y nhanh, á»•n Ä‘á»‹nh, dá»… xá»­ lÃ½ lá»—i.
- Náº¿u dÃ¹ng cÃ¡ch UI Automation (CÃ¡ch 2), hÃ£y Ä‘áº£m báº£o Ä‘á»™ á»•n Ä‘á»‹nh cá»§a UI (sá»­ dá»¥ng `Retry Scope`, `Element Exists`).

---

Báº¡n Ä‘ang cÃ³ app Azure AD sáºµn chÆ°a? Náº¿u chÆ°a mÃ¬nh cÃ³ thá»ƒ hÆ°á»›ng dáº«n táº¡o 1 cÃ¡i ráº¥t nhanh.
===========================================================================================================================
Tuyá»‡t, mÃ¬nh sáº½ hÆ°á»›ng dáº«n **chi tiáº¿t tá»«ng bÆ°á»›c Ä‘á»ƒ thá»±c hiá»‡n CÃ¡ch 1** â€“ dÃ¹ng **UiPath + Microsoft365 Scope + Graph API** Ä‘á»ƒ táº£i folder tá»« SharePoint vá» local.

---

## ğŸŸ¢ Má»¤C TIÃŠU
Táº£i toÃ n bá»™ file trong má»™t folder SharePoint (vÃ­ dá»¥: `https://yourcompany.sharepoint.com/sites/yourSite/Shared Documents/FolderA`) vá» thÆ° má»¥c local (`C:\Downloaded\FolderA`) báº±ng UiPath.

---

## ğŸ”§ BÆ¯á»šC 1: Táº¡o app trong Azure Ä‘á»ƒ láº¥y thÃ´ng tin Ä‘Äƒng nháº­p

> Náº¿u báº¡n Ä‘Ã£ cÃ³ `Client ID`, `Tenant ID`, `Client Secret` thÃ¬ cÃ³ thá»ƒ **bá» qua bÆ°á»›c nÃ y**.

### ğŸ”¹ 1.1. Truy cáº­p Azure Portal:
- VÃ o: https://portal.azure.com
- TÃ¬m **App registrations** > Click **New registration**

### ğŸ”¹ 1.2. Táº¡o app:
- Name: `UiPathGraphApp`
- Supported account types: **Accounts in this organizational directory only**
- Redirect URI: Ä‘á»ƒ trá»‘ng (hoáº·c thÃªm `https://login.microsoftonline.com/common/oauth2/nativeclient` náº¿u dÃ¹ng dáº¡ng Desktop login)

Click **Register**

---

### ğŸ”¹ 1.3. Láº¥y thÃ´ng tin:
- **Application (client) ID** â†’ Copy
- **Directory (tenant) ID** â†’ Copy

---

### ğŸ”¹ 1.4. Táº¡o Client Secret:
- Trong tab **Certificates & Secrets** > Click **New Client Secret**
- Nháº­p mÃ´ táº£ vÃ  chá»n thá»i háº¡n â†’ Click **Add**
- Copy giÃ¡ trá»‹ **Client Secret** (chá»‰ hiá»‡n 1 láº§n)

---

### ğŸ”¹ 1.5. Cáº¥p quyá»n API:
- VÃ o tab **API Permissions** > Click **Add a permission**
- Chá»n:
  - Microsoft Graph
  - Delegated permissions (náº¿u dÃ¹ng login ngÆ°á»i dÃ¹ng) hoáº·c Application permissions (náº¿u cháº¡y ná»n)
  - ThÃªm quyá»n:
    - `Sites.Read.All`
    - `Files.Read.All`

> Sau Ä‘Ã³ **click Grant admin consent**

---

## ğŸ”µ BÆ¯á»šC 2: CÃ i package vÃ  thiáº¿t láº­p UiPath

### ğŸ”¹ 2.1. CÃ i Package
- VÃ o **Manage Packages**
- CÃ i: `UiPath.MicrosoftOffice365.Activities`

---

### ğŸ”¹ 2.2. Microsoft 365 Scope

KÃ©o activity **Microsoft 365 Scope**, cáº¥u hÃ¬nh nhÆ° sau:

| Field | Value |
|-------|-------|
| **AuthenticationType** | `Application` |
| **ApplicationID** | dÃ¡n `Client ID` |
| **Tenant** | dÃ¡n `Tenant ID` |
| **ClientSecret** | dÃ¡n `Client Secret` |
| **Services** | chá»n: `Files`, `Sites`, `SharePoint` |

---

## ğŸŸ£ BÆ¯á»šC 3: Láº¥y danh sÃ¡ch file trong folder SharePoint

### ğŸ”¹ DÃ¹ng activity `Find Files and Folders`

- **Folder Path**:  
  ÄÆ°á»ng dáº«n kiá»ƒu: `"Shared Documents/FolderA"`  
  (TÃ­nh tá»« gá»‘c thÆ° viá»‡n document SharePoint)
- Output: táº¡o biáº¿n `filesList` kiá»ƒu `List<DriveItem>`

---

## ğŸŸ¡ BÆ¯á»šC 4: Duyá»‡t qua danh sÃ¡ch file vÃ  táº£i vá» local

### ğŸ”¹ DÃ¹ng For Each:

- For Each `fileItem In filesList`
- TypeArgument: `Microsoft.Graph.DriveItem`

### ğŸ”¹ BÃªn trong For Each:

DÃ¹ng `Download File` activity:
- **DriveItem**: `fileItem`
- **Local Path**: `"C:\Downloaded\FolderA\" + fileItem.Name`

> Äáº£m báº£o thÆ° má»¥c `C:\Downloaded\FolderA\` tá»“n táº¡i (dÃ¹ng `Create Directory` náº¿u cáº§n)

---

## âœ… Káº¿t quáº£
ToÃ n bá»™ file trong SharePoint folder `FolderA` sáº½ Ä‘Æ°á»£c táº£i vá» local folder `C:\Downloaded\FolderA`.

---

Báº¡n muá»‘n mÃ¬nh **táº¡o sample project file `.xaml`** sáºµn hoáº·c giÃºp báº¡n config Ä‘oáº¡n **Scope cá»¥ thá»ƒ** khÃ´ng? MÃ¬nh cÃ³ thá»ƒ viáº¿t nhanh cho báº¡n.
==========================================================================================================================================
Ráº¥t tá»‘t! MÃ¬nh sáº½ hÆ°á»›ng dáº«n báº¡n táº¡o **App Ä‘Äƒng kÃ½ trong Azure AD** tá»« Ä‘áº§u, Ä‘á»ƒ báº¡n cÃ³ thá»ƒ dÃ¹ng trong **UiPath** Ä‘á»ƒ truy cáº­p SharePoint qua **Microsoft Graph API**.

---

## ğŸ”§ HÆ°á»›ng dáº«n táº¡o App Azure AD Ä‘á»ƒ dÃ¹ng vá»›i UiPath (tá»«ng bÆ°á»›c cá»±c chi tiáº¿t)

---

### âœ… BÆ¯á»šC 1: Truy cáº­p Azure Portal

1. VÃ o trÃ¬nh duyá»‡t â†’ Truy cáº­p: [https://portal.azure.com](https://portal.azure.com)
2. ÄÄƒng nháº­p báº±ng tÃ i khoáº£n admin (hoáº·c tÃ i khoáº£n Ä‘Æ°á»£c cáº¥p quyá»n táº¡o app trong Azure AD).

---

### âœ… BÆ¯á»šC 2: Táº¡o App Registration

1. á» thanh tÃ¬m kiáº¿m, gÃµ **â€œApp registrationsâ€** â†’ Chá»n káº¿t quáº£ Ä‘áº§u tiÃªn.
2. Click **+ New registration**

**Äiá»n thÃ´ng tin:**

| TrÆ°á»ng | GiÃ¡ trá»‹ |
|--------|--------|
| **Name** | `UiPathGraphApp` (hoáº·c tÃªn tÃ¹y báº¡n) |
| **Supported account types** | Chá»n `Accounts in this organizational directory only (Single tenant)` |
| **Redirect URI** | **Bá» trá»‘ng** (hoáº·c chá»n â€œPublic client/native (mobile & desktop)â€ vÃ  nháº­p: `https://login.microsoftonline.com/common/oauth2/nativeclient` náº¿u muá»‘n test Ä‘Äƒng nháº­p tÆ°Æ¡ng tÃ¡c) |

3. Nháº¥n **Register**

---

### âœ… BÆ¯á»šC 3: Láº¥y thÃ´ng tin Ä‘Äƒng nháº­p

Sau khi táº¡o xong, báº¡n sáº½ tháº¥y cÃ¡c thÃ´ng tin:

| TrÆ°á»ng | MÃ´ táº£ |
|--------|-------|
| **Application (client) ID** | DÃ¹ng Ä‘á»ƒ cáº¥u hÃ¬nh trong UiPath |
| **Directory (tenant) ID** | CÅ©ng cáº§n trong UiPath |

â†’ **Copy cáº£ 2 ID nÃ y ra lÆ°u táº¡m.**

---

### âœ… BÆ¯á»šC 4: Táº¡o Client Secret

1. Trong menu bÃªn trÃ¡i, chá»n **Certificates & secrets**
2. Báº¥m **+ New client secret**
3. Nháº­p mÃ´ táº£: `UiPathSecret`, chá»n thá»i háº¡n â†’ Nháº¥n **Add**
4. **Copy giÃ¡ trá»‹ Client Secret** ngay sau khi táº¡o â€“ **chá»‰ tháº¥y 1 láº§n**.

---

### âœ… BÆ¯á»šC 5: Cáº¥p quyá»n API cho Microsoft Graph

1. Chá»n **API permissions** á»Ÿ menu bÃªn trÃ¡i
2. Click **+ Add a permission**
3. Chá»n:
   - Microsoft Graph
   - **Application permissions**
4. TÃ¬m vÃ  **thÃªm cÃ¡c quyá»n sau**:
   - `Sites.Read.All`
   - `Files.Read.All`
   *(cÃ³ thá»ƒ thÃªm `Sites.ReadWrite.All` náº¿u cáº§n quyá»n ghi/Ä‘á»“ng bá»™ sau nÃ y)*

5. Sau khi thÃªm â†’ Báº¥m **Grant admin consent** Ä‘á»ƒ cáº¥p quyá»n (cáº§n tÃ i khoáº£n admin)

---

### âœ… TÃ“M Táº®T Báº N ÄÃƒ CÃ“:

| ThÃ´ng tin cáº§n trong UiPath | Ghi chÃº |
|----------------------------|--------|
| **Tenant ID**              | tá»« bÆ°á»›c 3 |
| **Client ID**              | tá»« bÆ°á»›c 3 |
| **Client Secret**          | tá»« bÆ°á»›c 4 |
| CÃ¡c quyá»n Graph API        | tá»« bÆ°á»›c 5 |

---

Náº¿u báº¡n lÃ m Ä‘áº¿n Ä‘Ã¢y xong, mÃ¬nh cÃ³ thá»ƒ hÆ°á»›ng dáº«n bÆ°á»›c tiáº¿p theo lÃ  cáº¥u hÃ¬nh trong **UiPath Studio** nhÃ© â€“ báº¡n chá»‰ cáº§n paste cÃ¡c giÃ¡ trá»‹ Ä‘Ã³ vÃ o `Microsoft365 Scope` vÃ  lÃ m bÆ°á»›c táº£i file thÃ´i.

---

Báº¡n muá»‘n mÃ¬nh lÃ m giÃºp file `.xaml` máº«u Ä‘á»ƒ báº¡n import luÃ´n khÃ´ng? Hoáº·c mÃ¬nh cÃ³ thá»ƒ há»— trá»£ táº¡o Ä‘oáº¡n cáº¥u hÃ¬nh Scope sáºµn náº¿u báº¡n gá»­i cÃ¡c thÃ´ng tin `Client ID`, `Tenant ID` (báº¡n cÃ³ thá»ƒ thay tháº¿ giÃ¡ trá»‹ tháº­t trÆ°á»›c khi cháº¡y).
===================================
Tuyá»‡t! Sau khi báº¡n Ä‘Ã£ táº¡o xong App trong Azure vÃ  cÃ³ 3 thÃ´ng tin:

- âœ… **Tenant ID**  
- âœ… **Client ID (Application ID)**  
- âœ… **Client Secret**  

Giá» mÃ¬nh sáº½ hÆ°á»›ng dáº«n **tá»«ng bÆ°á»›c Ä‘á»ƒ cáº¥u hÃ¬nh activity `Microsoft365 Scope` trong UiPath** Ä‘á»ƒ káº¿t ná»‘i vá»›i SharePoint.

---

## ğŸŸ¢ Cáº¤U HÃŒNH `Microsoft365 Scope` (Step-by-Step)

### ğŸ§© BÆ°á»›c 1: KÃ©o activity

1. Má»Ÿ UiPath Studio
2. TÃ¬m activity: `Microsoft365 Scope` (náº¿u chÆ°a cÃ³, báº¡n cáº§n cÃ i package `UiPath.MicrosoftOffice365.Activities`)
3. KÃ©o vÃ o trong Sequence hoáº·c Flow cá»§a báº¡n.

---

### âš™ï¸ BÆ°á»›c 2: Cáº¥u hÃ¬nh cÃ¡c trÆ°á»ng nhÆ° sau:

| TrÆ°á»ng | GiÃ¡ trá»‹ báº¡n Ä‘iá»n | Ghi chÃº |
|--------|------------------|--------|
| **DisplayName** | `Graph API Scope` | (Ä‘áº·t tÃ¹y báº¡n) |
| **AuthenticationType** | `Application` | (chá»n tá»« dropdown) |
| **Application ID** | `dÃ¡n Client ID` | (tá»« Azure AD) |
| **Tenant** | `dÃ¡n Tenant ID` | (tá»« Azure AD) |
| **ClientSecret** | `dÃ¡n Client Secret` | (tá»« Azure AD) |
| **Services** | Tick chá»n: `Files`, `SharePoint`, `Sites` | (tÃ¹y nhu cáº§u) |

ğŸ“Œ **LÆ°u Ã½**:
- Chá»n Ä‘Ãºng `AuthenticationType = Application`
- Náº¿u chá»n sai, báº¡n sáº½ bá»‹ lá»—i `unauthorized` hoáº·c `invalid_grant`

---

### ğŸ“¦ VÃ­ dá»¥ thá»±c táº¿ (giáº£ láº­p)

```text
Application ID:      11112222-3333-4444-aaaa-bbbbccccdddd
Tenant ID:           abcd1234-ef56-7890-ghij-klmnopqrstuv
Client Secret:       xyz@ABCD!1234567890
```

ThÃ¬ báº¡n sáº½ Ä‘iá»n nhÆ° sau:

- **Application ID** â†’ `11112222-3333-4444-aaaa-bbbbccccdddd`
- **Tenant** â†’ `abcd1234-ef56-7890-ghij-klmnopqrstuv`
- **ClientSecret** â†’ `"xyz@ABCD!1234567890"` (cÃ³ thá»ƒ Ä‘áº·t vÃ o biáº¿n SecureString náº¿u muá»‘n báº£o máº­t)

---

### âœ… Káº¿t thÃºc:

Sau khi báº¡n cáº¥u hÃ¬nh xong `Microsoft365 Scope`, **cÃ¡c activity con bÃªn trong nÃ³ (nhÆ°: `Find Files and Folders`, `Download File`, `Upload File`, ...) sáº½ tá»± Ä‘á»™ng dÃ¹ng context káº¿t ná»‘i nÃ y**.

---

## ğŸ“Œ Kiá»ƒm tra káº¿t ná»‘i

- Báº¡n cÃ³ thá»ƒ test Ä‘Æ¡n giáº£n:
  - KÃ©o activity `Find Files and Folders` vÃ o trong Scope
  - Chá»n `Folder Path`: `"Shared Documents/TenFolder"`
  - In ra tÃªn file báº±ng `Write Line`: `fileItem.Name`

---

Báº¡n cÃ³ muá»‘n mÃ¬nh **táº¡o Ä‘oáº¡n máº«u sáºµn** Ä‘á»ƒ báº¡n chá»‰ cáº§n copy vÃ o UiPath vÃ  paste 3 thÃ´ng tin ID vÃ o thÃ´i khÃ´ng? MÃ¬nh cÃ³ thá»ƒ viáº¿t nhanh `.xaml` hoáº·c Ä‘oáº¡n demo ngáº¯n giÃºp báº¡n.
