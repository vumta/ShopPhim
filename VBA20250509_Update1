D∆∞·ªõi ƒë√¢y l√† phi√™n b·∫£n c·∫≠p nh·∫≠t c·ªßa m√£ VBA, trong ƒë√≥ s·∫Ω **g·ªôp t·∫•t c·∫£ c√°c c·ªôt b·ªã thi·∫øu trong m·ªôt file ngu·ªìn** v√†o m·ªôt th√¥ng b√°o l·ªói duy nh·∫•t thay v√¨ hi·ªÉn th·ªã t·ª´ng l·ªói ri√™ng l·∫ª.

---

### **M√£ VBA ƒê√£ C·∫≠p Nh·∫≠t**
```vba
Public Function ConsolidateMultipleFiles(ByVal sourceFilePaths As String, ByVal targetFilePath As String, ByVal columnsToCopy As String) As String
    Dim sourceFiles() As String
    Dim sourceWorkbook As Workbook
    Dim targetWorkbook As Workbook
    Dim sourceSheet As Worksheet
    Dim targetSheet As Worksheet
    Dim sourceColumns() As String
    Dim targetCol As Integer
    Dim lastRowSource As Long
    Dim lastRowTarget As Long
    Dim sourceData As Variant
    Dim i As Integer, j As Integer
    Dim errorMessages As String
    Dim missingColumns As String

    On Error GoTo ErrorHandler

    ' Ph√¢n t√°ch danh s√°ch file ngu·ªìn t·ª´ chu·ªói
    sourceFiles = Split(sourceFilePaths, ",")

    ' M·ªü file ƒë√≠ch
    Set targetWorkbook = Workbooks.Open(targetFilePath)
    Set targetSheet = targetWorkbook.Sheets(2) ' X√°c ƒë·ªãnh sheet c·∫ßn ghi d·ªØ li·ªáu

    ' Chuy·ªÉn c√°c c·ªôt c·∫ßn sao ch√©p t·ª´ chu·ªói th√†nh m·∫£ng
    sourceColumns = Split(columnsToCopy, ",")

    ' X√≥a d·ªØ li·ªáu c≈© nh∆∞ng gi·ªØ l·∫°i ti√™u ƒë·ªÅ
    If Application.CountA(targetSheet.Rows(2)) > 0 Then
        targetSheet.Rows("2:" & targetSheet.Rows.Count).ClearContents
    End If

    ' X√≥a d·ªØ li·ªáu t·ª´ h√†ng 4 tr·ªü ƒëi trong c·ªôt A, B
    Dim lastRowToClear As Long
    lastRowToClear = targetSheet.Cells(targetSheet.Rows.Count, 1).End(xlUp).Row
    If lastRowToClear >= 4 Then
        targetSheet.Range("A4:B" & lastRowToClear).ClearContents
    End If

    ' Duy·ªát qua t·ª´ng file ngu·ªìn
    For i = LBound(sourceFiles) To UBound(sourceFiles)
        On Error Resume Next
        Set sourceWorkbook = Workbooks.Open(Trim(sourceFiles(i)))
        If Err.Number <> 0 Then
            errorMessages = errorMessages & "Failed to open file: " & sourceFiles(i) & " - " & Err.Description & vbNewLine
            Err.Clear
            GoTo NextFile
        End If
        On Error GoTo 0

        Set sourceSheet = sourceWorkbook.Sheets(1) ' L·∫•y sheet ƒë·∫ßu ti√™n c·ªßa file ngu·ªìn

        ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong file ngu·ªìn
        lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, 1).End(xlUp).Row

        ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong file ƒë√≠ch
        lastRowTarget = targetSheet.Cells(targetSheet.Rows.Count, 1).End(xlUp).Row + 1

        ' ƒê·∫∑t l·∫°i danh s√°ch c·ªôt b·ªã thi·∫øu cho file hi·ªán t·∫°i
        missingColumns = ""

        ' Duy·ªát qua t·ª´ng c·ªôt c·∫ßn sao ch√©p
        For j = LBound(sourceColumns) To UBound(sourceColumns)
            ' T√¨m c·ªôt ngu·ªìn d·ª±a v√†o t√™n c·ªôt
            Dim sourceCol As Integer
            On Error Resume Next
            sourceCol = Application.Match(sourceColumns(j), sourceSheet.Rows(1), 0)
            On Error GoTo 0

            If sourceCol = 0 Then
                ' N·∫øu c·ªôt kh√¥ng t√¨m th·∫•y, th√™m v√†o danh s√°ch c·ªôt b·ªã thi·∫øu
                If missingColumns = "" Then
                    missingColumns = sourceColumns(j)
                Else
                    missingColumns = missingColumns & ", " & sourceColumns(j)
                End If
            Else
                ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong c·ªôt ngu·ªìn
                lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, sourceCol).End(xlUp).Row

                ' Sao ch√©p d·ªØ li·ªáu t·ª´ c·ªôt ngu·ªìn
                sourceData = sourceSheet.Range(sourceSheet.Cells(2, sourceCol), sourceSheet.Cells(lastRowSource, sourceCol)).Value

                ' T√¨m c·ªôt ƒë√≠ch d·ª±a tr√™n t√™n c·ªôt
                targetCol = Application.Match(sourceColumns(j), targetSheet.Rows(1), 0)

                If targetCol > 0 Then
                    ' D√°n d·ªØ li·ªáu v√†o c·ªôt ƒë√≠ch
                    targetSheet.Range(targetSheet.Cells(lastRowTarget, targetCol), _
                                      targetSheet.Cells(lastRowTarget + UBound(sourceData, 1) - 1, targetCol)).Value = sourceData
                Else
                    errorMessages = errorMessages & "Error: Target column '" & sourceColumns(j) & "' not found in target file." & vbNewLine
                End If
            End If
        Next j

        ' N·∫øu c√≥ c·ªôt b·ªã thi·∫øu, th√™m m·ªôt d√≤ng l·ªói duy nh·∫•t cho file ngu·ªìn
        If missingColumns <> "" Then
            errorMessages = errorMessages & "Missing columns in file " & sourceFiles(i) & ": " & missingColumns & vbNewLine
        End If

        ' ƒê√≥ng file ngu·ªìn
        sourceWorkbook.Close False
NextFile:
    Next i

    ' L∆∞u v√† ƒë√≥ng file ƒë√≠ch
    targetWorkbook.Save
    targetWorkbook.Close True

    ' Ki·ªÉm tra n·∫øu c√≥ l·ªói x·∫£y ra
    If errorMessages <> "" Then
        ConsolidateMultipleFiles = "Completed with errors:" & vbNewLine & errorMessages
    Else
        ConsolidateMultipleFiles = "Success: Data has been copied from multiple source files to the target file."
    End If

    Exit Function

ErrorHandler:
    ConsolidateMultipleFiles = "Error: An error occurred during execution: " & Err.Description

CleanUp:
    ' ƒê√≥ng file n·∫øu c·∫ßn thi·∫øt
    If Not sourceWorkbook Is Nothing Then sourceWorkbook.Close False
    If Not targetWorkbook Is Nothing Then targetWorkbook.Close True
End Function
```

---

### **C√°c c·∫≠p nh·∫≠t quan tr·ªçng**
1. **G·ªôp t·∫•t c·∫£ c√°c c·ªôt b·ªã thi·∫øu c·ªßa m·ªôt file ngu·ªìn th√†nh m·ªôt th√¥ng b√°o l·ªói duy nh·∫•t**:
   - S·ª≠ d·ª•ng bi·∫øn `missingColumns` ƒë·ªÉ l∆∞u danh s√°ch c·ªôt b·ªã thi·∫øu.
   - N·∫øu c√≥ nhi·ªÅu c·ªôt b·ªã thi·∫øu, ch·ªâ hi·ªÉn th·ªã **m·ªôt d√≤ng l·ªói duy nh·∫•t** v·ªõi t·∫•t c·∫£ c·ªôt ƒë√≥.

2. **Kh√¥ng d·ª´ng khi g·∫∑p l·ªói**:
   - N·∫øu m·ªôt file kh√¥ng th·ªÉ m·ªü ho·∫∑c b·ªã thi·∫øu c·ªôt, ch∆∞∆°ng tr√¨nh v·∫´n ti·∫øp t·ª•c v·ªõi c√°c file kh√°c.

3. **Tr·∫£ v·ªÅ danh s√°ch l·ªói t·ªïng h·ª£p**:
   - N·∫øu c√≥ l·ªói, ch∆∞∆°ng tr√¨nh s·∫Ω tr·∫£ v·ªÅ m·ªôt danh s√°ch chi ti·∫øt bao g·ªìm:
     - C√°c file kh√¥ng th·ªÉ m·ªü.
     - C√°c file b·ªã thi·∫øu c·ªôt v·ªõi t·∫•t c·∫£ c√°c c·ªôt b·ªã thi·∫øu.

---

### **H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng**
1. **T·∫°o file `.bas`**:
   - L∆∞u ƒëo·∫°n m√£ v√†o **VBA Editor**, ch·ªçn module, nh·∫•p chu·ªôt ph·∫£i, ch·ªçn `Export File` v√† l∆∞u v·ªõi t√™n `ConsolidateFiles.bas`.

2. **T√≠ch h·ª£p v·ªõi UiPath**:
   - D√πng ho·∫°t ƒë·ªông **Invoke VBA** trong UiPath.
   - C·∫•u h√¨nh `Properties`:
     - **VBAScriptFilePath**: `C:\Scripts\ConsolidateFiles.bas`.
     - **EntryMethodName**: `"ConsolidateMultipleFiles"`.
     - **EntryMethodParameters**: `sourceFilePaths, targetFilePath, columnsToCopy`.

3. **Ki·ªÉm tra k·∫øt qu·∫£**:
   - N·∫øu c√≥ l·ªói, UiPath s·∫Ω nh·∫≠n danh s√°ch l·ªói t·ªïng h·ª£p.
   - N·∫øu kh√¥ng c√≥ l·ªói, d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c h·ª£p nh·∫•t th√†nh c√¥ng.

---

### **V√≠ d·ª• k·∫øt qu·∫£ tr·∫£ v·ªÅ**
N·∫øu m·ªôt file kh√¥ng m·ªü ƒë∆∞·ª£c v√† m·ªôt file b·ªã thi·∫øu nhi·ªÅu c·ªôt:
```
Completed with errors:
Failed to open file: C:\Data\File1.xlsx - File not found
Missing columns in file C:\Data\File2.xlsx: Sales, Revenue, Quantity
```

N·∫øu ch·∫°y t·ªët:
```
Success: Data has been copied from multiple source files to the target file.
```

---

H√£y th·ª≠ nghi·ªám v√† cho t√¥i bi·∫øt n·∫øu b·∫°n c·∫ßn th√™m ƒëi·ªÅu ch·ªânh! üòä
