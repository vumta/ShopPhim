OK! MÃ¬nh sáº½ giÃºp báº¡n chuyá»ƒn toÃ n bá»™ quy trÃ¬nh láº¥y táº¥t cáº£ file trong SharePoint (bao gá»“m subfolder cÃ¡c cáº¥p) tá»« Power Automate sang VBA.

### ğŸ¯ Má»¥c tiÃªu:
- Duyá»‡t táº¥t cáº£ thÆ° má»¥c vÃ  file trong SharePoint (bao gá»“m subfolder).
- Ghi tÃªn file vÃ  Ä‘Æ°á»ng dáº«n vÃ o Excel tá»« dÃ²ng sá»‘ 5.
- Sá»­ dá»¥ng VBA (khÃ´ng cáº§n Power Automate hay UiPath).

---

## âœ… YÃªu cáº§u ban Ä‘áº§u:
Äá»ƒ sá»­ dá»¥ng VBA truy cáº­p SharePoint, báº¡n cáº§n:
1. **URL SharePoint site** (vÃ­ dá»¥: `https://contoso.sharepoint.com/sites/YourSite`)
2. **ÄÆ°á»ng dáº«n thÆ° má»¥c gá»‘c cáº§n duyá»‡t** (vÃ­ dá»¥: `Shared Documents`)
3. Excel Ä‘Ã£ báº­t **Microsoft Scripting Runtime** vÃ  **Microsoft XML, v6.0**

---

## ğŸ”§ Step-by-step hÆ°á»›ng dáº«n VBA

### ğŸ“Œ BÆ°á»›c 1: Má»Ÿ Excel > nháº¥n `Alt + F11` Ä‘á»ƒ má»Ÿ VBA Editor

### ğŸ“Œ BÆ°á»›c 2: VÃ o `Tools > References`
- Tick chá»n:
  - âœ… Microsoft Scripting Runtime
  - âœ… Microsoft XML, v6.0

---

### ğŸ“Œ BÆ°á»›c 3: DÃ¡n Ä‘oáº¡n code sau vÃ o Module

```vba
Option Explicit

Const BASE_URL As String = "https://contoso.sharepoint.com/sites/YourSite"
Const ROOT_FOLDER As String = "Shared Documents"
Const START_ROW As Long = 5

Dim rowIndex As Long

Sub GetAllFilesFromSharePoint()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1)
    rowIndex = START_ROW

    ' XÃ³a dá»¯ liá»‡u cÅ© náº¿u cáº§n
    ws.Range("A" & rowIndex & ":B" & ws.Rows.Count).ClearContents

    ' Gá»i hÃ m Ä‘á»‡ quy
    ProcessFolder "/" & ROOT_FOLDER, ws

    MsgBox "Done!"
End Sub

Sub ProcessFolder(folderPath As String, ws As Worksheet)
    Dim xhr As Object
    Set xhr = CreateObject("MSXML2.XMLHTTP")
    
    Dim url As String
    url = BASE_URL & "/_api/web/GetFolderByServerRelativeUrl('" & EncodeURL(folderPath) & "')?$expand=Folders,Files"

    xhr.Open "GET", url, False
    xhr.setRequestHeader "Accept", "application/json;odata=verbose"
    xhr.Send

    If xhr.Status = 200 Then
        Dim response As Object
        Set response = JsonConverter.ParseJson(xhr.responseText)

        Dim files As Object, file As Object
        Set files = response("d")("Files")("results")
        For Each file In files
            ws.Cells(rowIndex, 1).Value = file("Name")
            ws.Cells(rowIndex, 2).Value = file("ServerRelativeUrl")
            rowIndex = rowIndex + 1
        Next

        Dim folders As Object, folder As Object
        Set folders = response("d")("Folders")("results")
        For Each folder In folders
            ' Bá» qua thÆ° má»¥c Forms máº·c Ä‘á»‹nh
            If folder("Name") <> "Forms" Then
                ProcessFolder folder("ServerRelativeUrl"), ws
            End If
        Next
    Else
        Debug.Print "Error: " & xhr.Status & " - " & xhr.statusText
    End If
End Sub

Function EncodeURL(url As String) As String
    url = Replace(url, " ", "%20")
    url = Replace(url, "'", "%27")
    EncodeURL = url
End Function
```

---

### ğŸ“Œ BÆ°á»›c 4: ThÃªm **JSON parser** cho VBA

1. Táº£i thÆ° viá»‡n [VBA-JSON](https://github.com/VBA-tools/VBA-JSON) táº¡i Ä‘Ã¢y: [https://github.com/VBA-tools/VBA-JSON](https://github.com/VBA-tools/VBA-JSON)
2. ThÃªm vÃ o VBA Editor báº±ng cÃ¡ch `File > Import File...` â†’ chá»n file `JsonConverter.bas`

---

### ğŸ“Œ BÆ°á»›c 5: Cháº¡y macro

1. Quay láº¡i Excel
2. Nháº¥n `Alt + F8`, chá»n `GetAllFilesFromSharePoint`, rá»“i nháº¥n **Run**

---

## ğŸ“ Káº¿t quáº£:
- File vÃ  Ä‘Æ°á»ng dáº«n sáº½ Ä‘Æ°á»£c ghi tá»« dÃ²ng sá»‘ 5 trá»Ÿ Ä‘i.
- Cá»™t 1: Name (tÃªn file)
- Cá»™t 2: Path (Ä‘Æ°á»ng dáº«n SharePoint)

---

Báº¡n cáº§n mÃ¬nh xuáº¥t sáºµn file Excel máº«u cÃ³ sáºµn macro khÃ´ng? Hoáº·c báº¡n cÃ³ muá»‘n há»— trá»£ thÃªm pháº§n xÃ¡c thá»±c náº¿u site báº¡n yÃªu cáº§u Ä‘Äƒng nháº­p?
