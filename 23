Tuyá»‡t vá»i! Äá»ƒ Power Automate chia batch data (chia nhá» dá»¯ liá»‡u thÃ nh nhiá»u pháº§n nhá» hÆ¡n â€“ **batch**) trÆ°á»›c khi gá»i `Office Script`, báº¡n cÃ³ thá»ƒ lÃ m theo **hÆ°á»›ng dáº«n tá»«ng bÆ°á»›c dÆ°á»›i Ä‘Ã¢y**.

---

## âœ… Má»¤C TIÃŠU

**Báº¡n cÃ³:**
```json
{
  "columnName": "PhÃ²ng ban",
  "values": [["IT"], ["HR"], ["Finance"], ["Sales"], ["Admin"], ...]
}
```

**Báº¡n muá»‘n:**
- TÃ¡ch thÃ nh cÃ¡c batch nhá» (vÃ­ dá»¥: má»—i batch 500 dÃ²ng)
- Gá»i `Run Script` **nhiá»u láº§n** vá»›i má»—i batch
- Má»—i láº§n chá»‰ dÃ¡n 1 pháº§n vÃ o file Ä‘Ã­ch (Ä‘á»ƒ trÃ¡nh `setValues()` timeout)

---

## âœ… BÆ¯á»šC THá»°C HIá»†N TRONG POWER AUTOMATE

### ğŸ”¹ **1. Parse dá»¯ liá»‡u Ä‘áº§u vÃ o**
Sá»­ dá»¥ng **Parse JSON** Ä‘á»ƒ láº¥y ra dá»¯ liá»‡u:

```json
{
  "columnName": "PhÃ²ng ban",
  "values": [
    ["IT"], ["HR"], ["Finance"], ["Sales"], ["Admin"], ...
  ]
}
```

---

### ğŸ”¹ **2. Initialize cÃ¡c biáº¿n**
- **Array batches** â†’ dáº¡ng `Array`
- **Integer batchSize** â†’ gÃ¡n = `500` (hoáº·c giÃ¡ trá»‹ khÃ¡c báº¡n muá»‘n)
- **Array currentBatch** â†’ dÃ¹ng Ä‘á»ƒ gom tá»«ng batch

---

### ğŸ”¹ **3. DÃ¹ng Loop Ä‘á»ƒ chia batch**
**Apply to each** qua `values`:

**Input**: `body('Parse_JSON')?['values']`

**BÃªn trong loop:**

1. **Append item vÃ o currentBatch**

   ```plaintext
   Append to array variable â†’ currentBatch
   Value: items('Apply_to_each')
   ```

2. **Kiá»ƒm tra náº¿u currentBatch Ä‘á»§ batchSize â†’ thÃ¬ push vÃ o batches**
   - Äiá»u kiá»‡n:  
     ```plaintext
     length(variables('currentBatch')) is equal to variables('batchSize')
     ```

   - Náº¿u Ä‘Ãºng:
     - Append currentBatch vÃ o batches
     - Set currentBatch = `[]` (reset láº¡i)

---

### ğŸ”¹ **4. Sau Loop: Ä‘áº©y batch cÃ²n láº¡i vÃ o batches**
DÃ¹ng Ä‘iá»u kiá»‡n ngoÃ i vÃ²ng láº·p:

```plaintext
length(variables('currentBatch')) > 0
```

â†’ Náº¿u Ä‘Ãºng, `Append currentBatch to batches`

---

### ğŸ”¹ **5. Apply to each BATCH vÃ  Gá»i Office Script**

**Input**: `variables('batches')`

**BÃªn trong má»—i batch:**
- Gá»i `Run Script`
- Input:

```json
{
  "columnName": "PhÃ²ng ban",
  "values": @{items('Apply_to_each')}
}
```

---

## âœ… Káº¾T QUáº¢

Báº¡n sáº½ gá»i `Office Script` **tá»«ng batch má»™t**, vÃ­ dá»¥:

- Batch 1: [["IT"], ["HR"], ["Finance"], ...]
- Batch 2: [["Admin"], ["Sales"], ...]
- ...

â†’ Má»—i láº§n dÃ¡n chá»‰ 500 dÃ²ng, trÃ¡nh timeout, mÃ  váº«n Ä‘áº£m báº£o Ä‘Ãºng vá»‹ trÃ­ dÃ²ng.

---

## ğŸ“¦ BONUS: Máº«u Flow `.zip` hoáº·c visual builder

Báº¡n muá»‘n mÃ¬nh táº¡o sáºµn máº«u `.zip` import vÃ o Power Automate? Hay cáº§n mÃ¬nh chá»¥p láº¡i tá»«ng bÆ°á»›c báº±ng áº£nh?

ğŸ‘‰ Chá»‰ cáº§n nÃ³i **"Gá»­i zip"** hoáº·c **"Gá»­i áº£nh tá»«ng bÆ°á»›c"**, mÃ¬nh sáº½ gá»­i ngay!
