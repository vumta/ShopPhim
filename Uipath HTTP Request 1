HoÃ n háº£o! ğŸ¯  
Báº¡n muá»‘n dÃ¹ng **Child Flow** nhÆ°ng **khÃ´ng Ä‘á»ƒ Flow con tá»± gá»i láº¡i chÃ­nh nÃ³** (vÃ¬ Power Automate khÃ´ng cho phÃ©p Ä‘iá»u Ä‘Ã³), nÃªn chÃºng ta sáº½:

âœ… Váº«n sá»­ dá»¥ng **Flow con** Ä‘á»ƒ xá»­ lÃ½ **má»™t folder Ä‘Æ¡n láº»** (tráº£ vá» file + subfolder).

âœ… Trong **Flow cha**, dÃ¹ng **`Do Until` + Queue tá»± quáº£n lÃ½** Ä‘á»ƒ thá»±c hiá»‡n **duyá»‡t thÆ° má»¥c sÃ¢u nhiá»u cáº¥p**, mÃ´ phá»ng Ä‘á»‡ quy.

---

## ğŸ§­ Má»¥c tiÃªu:
- **Flow cha**: nháº­n thÆ° má»¥c gá»‘c tá»« UiPath, duyá»‡t qua táº¥t cáº£ subfolder má»i cáº¥p báº±ng `Do Until`, gá»i **Flow con** Ä‘á»ƒ xá»­ lÃ½ tá»«ng folder.
- **Flow con**: nháº­n 1 folder path, tráº£ vá» file & subfolder trong Ä‘Ã³.

---

## âœ… Step-by-step

---

### ğŸ’¡ Tá»•ng quan Flow:
| ThÃ nh pháº§n     | Vai trÃ²                                   |
|----------------|--------------------------------------------|
| `Main_GetAllFiles` (Flow cha) | Duyá»‡t folder báº±ng queue + gá»i Child Flow |
| `Child_ProcessFolder` (Flow con) | Nháº­n 1 folder â†’ tráº£ `Files` + `Subfolders` |

---

## ğŸ”§ 1. Táº¡o Child Flow â€“ `Child_ProcessFolder`

---

### **Inputs**:
- `FolderPath` (string)

### **Outputs**:
- `Files` (array)
- `Subfolders` (array)

---

### **BÃªn trong Flow con**:

#### ğŸ§© Step 1: Gá»i SharePoint API
Action: `Send an HTTP request to SharePoint`

- Method: `GET`  
- Uri:
```plaintext
_api/web/GetFolderByServerRelativeUrl('@{triggerOutputs()?['headers']['x-sharepointsite']}/@{triggerBody()['FolderPath']}')?$expand=Files,Folders
```

> LÆ°u Ã½: Báº¡n cáº§n encode `FolderPath` Ä‘Ãºng náº¿u cÃ³ kÃ½ tá»± Ä‘áº·c biá»‡t (dÃ¹ng `uriComponent()` trong Flow cha).

#### ğŸ§© Step 2: Parse JSON Ä‘á»ƒ láº¥y:

- `Files`:  
```plaintext
body('Send_an_HTTP_request_to_SharePoint')?['d']?['Files']?['results']
```

- `Folders`:  
```plaintext
body('Send_an_HTTP_request_to_SharePoint')?['d']?['Folders']?['results']
```

#### ğŸ§© Step 3: Tráº£ káº¿t quáº£

- Output: `Files` â†’ array cÃ¡c file  
- Output: `Subfolders` â†’ map sang array cÃ¡c `ServerRelativeUrl` cá»§a folder con.

---

## ğŸ—ï¸ 2. Táº¡o Flow cha â€“ `Main_GetAllFiles`

---

### **Trigger**: HTTP Request (UiPath gá»i vÃ o)

Schema:
```json
{
  "type": "object",
  "properties": {
    "FolderPath": {
      "type": "string"
    }
  }
}
```

---

### **Step-by-step Flow Cha**

#### ğŸ”¹ Initialize:

- `PendingFolders` = `createArray(triggerBody()?['FolderPath'])`
- `AllFiles` = `createArray()`

---

### ğŸ” `Do Until` â€“ `length(PendingFolders) == 0`

**BÃªn trong `Do Until`:**

#### 1. Láº¥y thÆ° má»¥c Ä‘áº§u tiÃªn:
```plaintext
first(variables('PendingFolders'))
```

#### 2. Gá»i Child Flow: `Child_ProcessFolder`
- Input: thÆ° má»¥c Ä‘ang xá»­ lÃ½

#### 3. Append `Files` vÃ o `AllFiles`

```plaintext
append to array variable('AllFiles', outputs('Child_ProcessFolder')?['Files'])
```

#### 4. Append `Subfolders` vÃ o `PendingFolders`:
```plaintext
union(variables('PendingFolders'), outputs('Child_ProcessFolder')?['Subfolders'])
```

#### 5. XoÃ¡ folder Ä‘Ã£ xá»­ lÃ½:
```plaintext
set variable 'PendingFolders' = skip(variables('PendingFolders'), 1)
```

---

### âœ… Sau vÃ²ng láº·p `Do Until`

- Action: `Response`
- Body:
```json
{
  "files": "@variables('AllFiles')"
}
```

---

## ğŸ TÃ³m táº¯t

- **KhÃ´ng Ä‘á»‡ quy** tháº­t sá»±, nhÆ°ng hoáº¡t Ä‘á»™ng y há»‡t.
- Dá»… má»Ÿ rá»™ng: Child Flow cÃ³ thá»ƒ xá»­ lÃ½ logic phá»©c táº¡p tá»«ng folder.
- UiPath chá»‰ cáº§n gá»i 1 láº§n, nháº­n Ä‘áº§y Ä‘á»§ káº¿t quáº£.

---

Báº¡n muá»‘n mÃ¬nh cung cáº¥p máº«u JSON Ä‘á»ƒ dÃ¡n vÃ o `Send HTTP request`, hay cáº§n giÃºp xuáº¥t file `.zip` máº«u cho Flow con + Flow cha?
