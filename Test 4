Cáº£m Æ¡n báº¡n Ä‘Ã£ pháº£n há»“i! ğŸ› ï¸  
ÄÃºng rá»“i, pháº§n khai bÃ¡o kiá»ƒu `[string, string[][]][]` sáº½ gÃ¢y lá»—i trong **Office Script**, vÃ¬ TypeScript trong mÃ´i trÆ°á»ng Office Script **khÃ´ng há»— trá»£ tuple array khai bÃ¡o kiá»ƒu phá»©c táº¡p nhÆ° váº­y**.

---

## âœ… CÃ¡ch sá»­a phÃ¹ há»£p vá»›i Office Script

Báº¡n nÃªn thay tháº¿ báº±ng khai bÃ¡o **object** Ä‘Æ¡n giáº£n hÆ¡n, vÃ­ dá»¥:

```ts
type ColumnData = {
  columnName: string;
  values: string[][];
};
```

Sau Ä‘Ã³, kiá»ƒu dá»¯ liá»‡u sáº½ lÃ :

```ts
ColumnData[]
```

---

## âœ… Cáº­p nháº­t láº¡i hÃ m Office Script tÆ°Æ¡ng thÃ­ch

### ğŸ” **HÃ m trÃ­ch xuáº¥t tá»« file nguá»“n (Ä‘á»c dá»¯ liá»‡u)**

```ts
function main(workbook: ExcelScript.Workbook, columnNames: string[]): ColumnData[] {
  const sheet = workbook.getActiveWorksheet();
  const values = sheet.getUsedRange().getValues();

  const headers = values[0] as string[];
  let result: ColumnData[] = [];

  for (let name of columnNames) {
    const colIndex = headers.indexOf(name);
    if (colIndex === -1) continue;

    const columnValues = values.slice(1).map(row => [String(row[colIndex])]);
    result.push({
      columnName: name,
      values: columnValues
    });
  }

  return result;
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

### ğŸ” **HÃ m ghi vÃ o file Ä‘Ã­ch theo tÃªn cá»™t dÃ²ng 2**

```ts
function main(workbook: ExcelScript.Workbook, inputData: ColumnData[]) {
  const sheet = workbook.getActiveWorksheet();
  const headerRow = 2;
  const startRow = 3;

  const headers = sheet.getRange(`A${headerRow}:Z${headerRow}`).getValues()[0] as string[];
  const colMap: Record<string, number> = {};

  headers.forEach((name, i) => {
    if (name) colMap[String(name).trim()] = i;
  });

  const rowCount = inputData[0].values.length;

  for (let i = 0; i < rowCount; i++) {
    for (let column of inputData) {
      const colIndex = colMap[column.columnName];
      if (colIndex !== undefined) {
        sheet.getCell(startRow - 1 + i, colIndex).setValue(column.values[i][0]);
      }
    }
  }
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

### âœ… Æ¯u Ä‘iá»ƒm cÃ¡ch dÃ¹ng `object`:

- Dá»… Ä‘á»c, dá»… má»Ÿ rá»™ng (cÃ³ thá»ƒ thÃªm `dataType`, `format`, v.v. sau nÃ y).
- Dá»… thao tÃ¡c trong Power Automate.
- TÆ°Æ¡ng thÃ­ch hoÃ n toÃ n vá»›i Office Script.

---

Báº¡n muá»‘n mÃ¬nh giÃºp thÃªm pháº§n **Parse JSON máº«u cho kiá»ƒu `ColumnData[]` nÃ y** Ä‘á»ƒ dÃ¹ng trong Power Automate khÃ´ng?


Ráº¥t thá»±c táº¿ luÃ´n! Viá»‡c kiá»ƒm tra `getUsedRange()` cÃ³ tráº£ vá» `null` hay khÃ´ng lÃ  **ráº¥t quan trá»ng** trong Office Script, vÃ¬ náº¿u báº¡n cá»‘ gá»i `.getValues()` trÃªn `null` thÃ¬ script sáº½ lá»—i ngay.

---

## âœ… CÃ¡ch kiá»ƒm tra `getUsedRange()` cÃ³ tráº£ vá» `null` hay khÃ´ng

### ğŸ”¸ CÃ¡ch viáº¿t an toÃ n:

```ts
const usedRange = sheet.getUsedRange();

if (!usedRange) {
  console.log("Sheet khÃ´ng cÃ³ dá»¯ liá»‡u!");
  return; // hoáº·c return [] náº¿u Ä‘ang trong hÃ m tráº£ dá»¯ liá»‡u
}
```

- `getUsedRange()` sáº½ **tráº£ vá» `undefined`** hoáº·c **`null`** náº¿u **khÃ´ng cÃ³ Ã´ nÃ o trong sheet chá»©a dá»¯ liá»‡u hoáº·c Ä‘á»‹nh dáº¡ng.**
- DÃ¹ hiáº¿m gáº·p, váº«n nÃªn kiá»ƒm tra Ä‘á»ƒ trÃ¡nh lá»—i runtime.

---

### ğŸ”¸ CÃ¡ch Ä‘áº§y Ä‘á»§ khi muá»‘n láº¥y `values`:

```ts
const usedRange = sheet.getUsedRange();

if (!usedRange) {
  console.log("KhÃ´ng cÃ³ vÃ¹ng dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng!");
  return [];
}

const values = usedRange.getValues();
```

---

## âœ… Hoáº·c viáº¿t gá»n báº±ng toÃ¡n tá»­ `?`:

Náº¿u báº¡n khÃ´ng cháº¯c `getUsedRange()` tá»“n táº¡i vÃ  muá»‘n viáº¿t gá»n, báº¡n cÃ³ thá»ƒ dÃ¹ng toÃ¡n tá»­ an toÃ n (`?.`):

```ts
const values = sheet.getUsedRange()?.getValues() ?? [];
```

- `?.` sáº½ kiá»ƒm tra `getUsedRange()` cÃ³ null khÃ´ng trÆ°á»›c khi gá»i `getValues()`.
- `?? []` Ä‘áº£m báº£o náº¿u káº¿t quáº£ lÃ  `undefined` thÃ¬ báº¡n váº«n cÃ³ giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  máº£ng rá»—ng.

---

## âœ… Má»™t gá»£i Ã½ khÃ¡c â€“ Dá»± phÃ²ng náº¿u `getUsedRange()` khÃ´ng Ä‘á»§ tin cáº­y

Náº¿u file báº¡n xá»­ lÃ½ Ä‘Ã´i khi cÃ³ "vÃ¹ng tráº¯ng" hoáº·c dá»¯ liá»‡u náº±m ngoÃ i vÃ¹ng Excel coi lÃ  "used", báº¡n cÃ³ thá»ƒ xá»­ lÃ½ thá»§ cÃ´ng:

```ts
const values = sheet.getRange("A1:Z1000").getValues(); // giáº£ Ä‘á»‹nh vÃ¹ng lá»›n
```

Tuy nhiÃªn, cÃ¡ch nÃ y cÃ³ thá»ƒ láº¥y cáº£ nhiá»u Ã´ trá»‘ng khÃ´ng cáº§n thiáº¿t â€“ phÃ¹ há»£p náº¿u báº¡n biáº¿t cháº¯c vÃ¹ng dá»¯ liá»‡u náº±m trong Ä‘Ã³.

---

Báº¡n muá»‘n mÃ¬nh viáº¿t cho báº¡n má»™t **utility function `getSafeValues(sheet)`** Ä‘á»ƒ dÃ¹ng láº¡i nhiá»u láº§n khÃ´ng?


Báº¡n Ä‘ang nÃ³i Ä‘áº¿n Ä‘oáº¡n:

```ts
const usedRange = sheet.getUsedRange();
```

vÃ  tháº¯c máº¯c vá» giá»›i háº¡n (limit) cá»§a `getUsedRange()` â€“ cÃ³ láº½ báº¡n Ä‘ang gáº·p pháº£i tÃ¬nh huá»‘ng:

- `getUsedRange()` khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i.
- Hoáº·c báº¡n nghi ngá» cÃ³ giá»›i háº¡n sá»‘ Ã´ hoáº·c sá»‘ dÃ²ng Ä‘Æ°á»£c tráº£ vá».

---

## âœ… Giáº£i thÃ­ch vá» `getUsedRange()` vÃ  cÃ¡c giá»›i háº¡n

### ğŸ”¹ `getUsedRange()` lÃ m gÃ¬?
- Tráº£ vá» vÃ¹ng bao gá»“m **táº¥t cáº£ cÃ¡c Ã´ cÃ³ dá»¯ liá»‡u hoáº·c Ä‘á»‹nh dáº¡ng**.
- Tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh tá»« Ã´ Ä‘áº§u tiÃªn chá»©a dá»¯ liá»‡u Ä‘áº¿n Ã´ cuá»‘i cÃ¹ng.
- **KhÃ´ng cáº§n chá»‰ Ä‘á»‹nh vÃ¹ng cá»¥ thá»ƒ**, nÃ³ quÃ©t toÃ n sheet.

---

### ğŸ”¹ CÃ³ giá»›i háº¡n khÃ´ng?

| Thuá»™c tÃ­nh               | Giá»›i háº¡n ká»¹ thuáº­t |
|--------------------------|------------------|
| Tá»•ng sá»‘ dÃ²ng trong Excel | 1,048,576        |
| Tá»•ng sá»‘ cá»™t              | 16,384 (cá»™t XFD) |

> Tuy nhiÃªn, `getUsedRange()` **chá»‰ tráº£ vá» Ä‘Ãºng pháº¡m vi Ä‘ang cÃ³ dá»¯ liá»‡u/thay Ä‘á»•i**, nÃªn **hiáº¿m khi Ä‘á»¥ng giá»›i háº¡n** trá»« khi báº¡n xá»­ lÃ½ file cá»±c lá»›n.

---

## â— CÃ¡c tÃ¬nh huá»‘ng thá»±c táº¿ báº¡n cÃ³ thá»ƒ gáº·p:

### 1. `getUsedRange()` tráº£ vá» `null` hoáº·c lá»—i
- Sheet hoÃ n toÃ n trá»‘ng, hoáº·c báº¡n vá»«a xÃ³a háº¿t dá»¯ liá»‡u nhÆ°ng chÆ°a lÆ°u file.
- Cáº§n gá»i `getUsedRange()` sau khi cháº¯c cháº¯n sheet cÃ³ dá»¯ liá»‡u.

### 2. Báº¡n chá»‰ láº¥y Ä‘Æ°á»£c má»™t pháº§n dá»¯ liá»‡u (thiáº¿u dÃ²ng/cá»™t)
- CÃ³ thá»ƒ cÃ³ Ä‘á»‹nh dáº¡ng rÃ¡c trong sheet khiáº¿n `UsedRange` bao gá»“m nhiá»u Ã´ trá»‘ng khÃ´ng ngá» tá»›i.
- Hoáº·c dá»¯ liá»‡u náº±m ngoÃ i vÃ¹ng báº¡n nghÄ© (vÃ­ dá»¥: á»Ÿ cá»™t AZ hay dÃ²ng 2000).

---

## âœ… CÃ¡ch kiá»ƒm tra pháº¡m vi `UsedRange` Ä‘ang bao gá»“m gÃ¬

Báº¡n cÃ³ thá»ƒ log vá»‹ trÃ­ hÃ ng vÃ  cá»™t:

```ts
const usedRange = sheet.getUsedRange();

if (!usedRange) {
  console.log("KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng.");
  return;
}

const rowCount = usedRange.getRowCount();
const columnCount = usedRange.getColumnCount();
const startRow = usedRange.getRowIndex();
const startColumn = usedRange.getColumnIndex();

console.log(`Used range báº¯t Ä‘áº§u tá»« dÃ²ng ${startRow + 1}, cá»™t ${startColumn + 1}, kÃ­ch thÆ°á»›c ${rowCount} x ${columnCount}`);
```

> Excel sá»­ dá»¥ng **chá»‰ sá»‘ báº¯t Ä‘áº§u tá»« 0**, nÃªn cáº§n `+1` Ä‘á»ƒ ra Ä‘Ãºng sá»‘ dÃ²ng/cá»™t theo máº¯t ngÆ°á»i.

---

## âœ… Náº¿u báº¡n muá»‘n "giá»›i háº¡n vÃ¹ng dá»¯ liá»‡u" thá»§ cÃ´ng

VÃ­ dá»¥: báº¡n chá»‰ muá»‘n xá»­ lÃ½ tá»« A1 Ä‘áº¿n H1000:

```ts
const range = sheet.getRange("A1:H1000");
const values = range.getValues();
```

---

## Báº¡n muá»‘n gÃ¬ tiáº¿p theo?

- MÃ¬nh cÃ³ thá»ƒ giÃºp báº¡n viáº¿t má»™t **hÃ m `getActualDataRange()`** Ä‘á»ƒ tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh vÃ¹ng cÃ³ dá»¯ liá»‡u thá»±c (khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi Ä‘á»‹nh dáº¡ng rÃ¡c).
- Hoáº·c báº¡n cÃ³ thá»ƒ gá»­i cá»¥ thá»ƒ **báº¡n gáº·p lá»—i gÃ¬ khi dÃ¹ng `getUsedRange()`**, Ä‘á»ƒ mÃ¬nh há»— trá»£ Ä‘Ãºng Ä‘iá»ƒm báº¡n cáº§n.

Cáº§n mÃ¬nh há»— trá»£ pháº§n nÃ o tiáº¿p theo?
