Cáº£m Æ¡n báº¡n Ä‘Ã£ pháº£n há»“i! ğŸ› ï¸  
ÄÃºng rá»“i, pháº§n khai bÃ¡o kiá»ƒu `[string, string[][]][]` sáº½ gÃ¢y lá»—i trong **Office Script**, vÃ¬ TypeScript trong mÃ´i trÆ°á»ng Office Script **khÃ´ng há»— trá»£ tuple array khai bÃ¡o kiá»ƒu phá»©c táº¡p nhÆ° váº­y**.

---

## âœ… CÃ¡ch sá»­a phÃ¹ há»£p vá»›i Office Script

Báº¡n nÃªn thay tháº¿ báº±ng khai bÃ¡o **object** Ä‘Æ¡n giáº£n hÆ¡n, vÃ­ dá»¥:

```ts
type ColumnData = {
  columnName: string;
  values: string[][];
};
```

Sau Ä‘Ã³, kiá»ƒu dá»¯ liá»‡u sáº½ lÃ :

```ts
ColumnData[]
```

---

## âœ… Cáº­p nháº­t láº¡i hÃ m Office Script tÆ°Æ¡ng thÃ­ch

### ğŸ” **HÃ m trÃ­ch xuáº¥t tá»« file nguá»“n (Ä‘á»c dá»¯ liá»‡u)**

```ts
function main(workbook: ExcelScript.Workbook, columnNames: string[]): ColumnData[] {
  const sheet = workbook.getActiveWorksheet();
  const values = sheet.getUsedRange().getValues();

  const headers = values[0] as string[];
  let result: ColumnData[] = [];

  for (let name of columnNames) {
    const colIndex = headers.indexOf(name);
    if (colIndex === -1) continue;

    const columnValues = values.slice(1).map(row => [String(row[colIndex])]);
    result.push({
      columnName: name,
      values: columnValues
    });
  }

  return result;
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

### ğŸ” **HÃ m ghi vÃ o file Ä‘Ã­ch theo tÃªn cá»™t dÃ²ng 2**

```ts
function main(workbook: ExcelScript.Workbook, inputData: ColumnData[]) {
  const sheet = workbook.getActiveWorksheet();
  const headerRow = 2;
  const startRow = 3;

  const headers = sheet.getRange(`A${headerRow}:Z${headerRow}`).getValues()[0] as string[];
  const colMap: Record<string, number> = {};

  headers.forEach((name, i) => {
    if (name) colMap[String(name).trim()] = i;
  });

  const rowCount = inputData[0].values.length;

  for (let i = 0; i < rowCount; i++) {
    for (let column of inputData) {
      const colIndex = colMap[column.columnName];
      if (colIndex !== undefined) {
        sheet.getCell(startRow - 1 + i, colIndex).setValue(column.values[i][0]);
      }
    }
  }
}

type ColumnData = {
  columnName: string;
  values: string[][];
};
```

---

### âœ… Æ¯u Ä‘iá»ƒm cÃ¡ch dÃ¹ng `object`:

- Dá»… Ä‘á»c, dá»… má»Ÿ rá»™ng (cÃ³ thá»ƒ thÃªm `dataType`, `format`, v.v. sau nÃ y).
- Dá»… thao tÃ¡c trong Power Automate.
- TÆ°Æ¡ng thÃ­ch hoÃ n toÃ n vá»›i Office Script.

---

Báº¡n muá»‘n mÃ¬nh giÃºp thÃªm pháº§n **Parse JSON máº«u cho kiá»ƒu `ColumnData[]` nÃ y** Ä‘á»ƒ dÃ¹ng trong Power Automate khÃ´ng?


Ráº¥t thá»±c táº¿ luÃ´n! Viá»‡c kiá»ƒm tra `getUsedRange()` cÃ³ tráº£ vá» `null` hay khÃ´ng lÃ  **ráº¥t quan trá»ng** trong Office Script, vÃ¬ náº¿u báº¡n cá»‘ gá»i `.getValues()` trÃªn `null` thÃ¬ script sáº½ lá»—i ngay.

---

## âœ… CÃ¡ch kiá»ƒm tra `getUsedRange()` cÃ³ tráº£ vá» `null` hay khÃ´ng

### ğŸ”¸ CÃ¡ch viáº¿t an toÃ n:

```ts
const usedRange = sheet.getUsedRange();

if (!usedRange) {
  console.log("Sheet khÃ´ng cÃ³ dá»¯ liá»‡u!");
  return; // hoáº·c return [] náº¿u Ä‘ang trong hÃ m tráº£ dá»¯ liá»‡u
}
```

- `getUsedRange()` sáº½ **tráº£ vá» `undefined`** hoáº·c **`null`** náº¿u **khÃ´ng cÃ³ Ã´ nÃ o trong sheet chá»©a dá»¯ liá»‡u hoáº·c Ä‘á»‹nh dáº¡ng.**
- DÃ¹ hiáº¿m gáº·p, váº«n nÃªn kiá»ƒm tra Ä‘á»ƒ trÃ¡nh lá»—i runtime.

---

### ğŸ”¸ CÃ¡ch Ä‘áº§y Ä‘á»§ khi muá»‘n láº¥y `values`:

```ts
const usedRange = sheet.getUsedRange();

if (!usedRange) {
  console.log("KhÃ´ng cÃ³ vÃ¹ng dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng!");
  return [];
}

const values = usedRange.getValues();
```

---

## âœ… Hoáº·c viáº¿t gá»n báº±ng toÃ¡n tá»­ `?`:

Náº¿u báº¡n khÃ´ng cháº¯c `getUsedRange()` tá»“n táº¡i vÃ  muá»‘n viáº¿t gá»n, báº¡n cÃ³ thá»ƒ dÃ¹ng toÃ¡n tá»­ an toÃ n (`?.`):

```ts
const values = sheet.getUsedRange()?.getValues() ?? [];
```

- `?.` sáº½ kiá»ƒm tra `getUsedRange()` cÃ³ null khÃ´ng trÆ°á»›c khi gá»i `getValues()`.
- `?? []` Ä‘áº£m báº£o náº¿u káº¿t quáº£ lÃ  `undefined` thÃ¬ báº¡n váº«n cÃ³ giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  máº£ng rá»—ng.

---

## âœ… Má»™t gá»£i Ã½ khÃ¡c â€“ Dá»± phÃ²ng náº¿u `getUsedRange()` khÃ´ng Ä‘á»§ tin cáº­y

Náº¿u file báº¡n xá»­ lÃ½ Ä‘Ã´i khi cÃ³ "vÃ¹ng tráº¯ng" hoáº·c dá»¯ liá»‡u náº±m ngoÃ i vÃ¹ng Excel coi lÃ  "used", báº¡n cÃ³ thá»ƒ xá»­ lÃ½ thá»§ cÃ´ng:

```ts
const values = sheet.getRange("A1:Z1000").getValues(); // giáº£ Ä‘á»‹nh vÃ¹ng lá»›n
```

Tuy nhiÃªn, cÃ¡ch nÃ y cÃ³ thá»ƒ láº¥y cáº£ nhiá»u Ã´ trá»‘ng khÃ´ng cáº§n thiáº¿t â€“ phÃ¹ há»£p náº¿u báº¡n biáº¿t cháº¯c vÃ¹ng dá»¯ liá»‡u náº±m trong Ä‘Ã³.

---

Báº¡n muá»‘n mÃ¬nh viáº¿t cho báº¡n má»™t **utility function `getSafeValues(sheet)`** Ä‘á»ƒ dÃ¹ng láº¡i nhiá»u láº§n khÃ´ng?
