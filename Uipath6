DÆ°á»›i Ä‘Ã¢y lÃ  hÆ°á»›ng dáº«n **toÃ n bá»™ flow tá»‘i Æ°u hÃ³a trong UiPath**, dÃ nh riÃªng cho trÆ°á»ng há»£p:

> **File nguá»“n cÃ³ Ä‘áº¿n 90.000 dÃ²ng, chá»‰ copy má»™t vÃ i cá»™t theo tÃªn cá»™t cÃ³ trong file Ä‘Ã­ch (row 2), vÃ  thá»© tá»± cá»™t Ä‘Ã­ch khÃ¡c vá»›i nguá»“n.**

---

## ğŸ¯ Má»¥c tiÃªu:
- Äá»c dá»¯ liá»‡u tá»« file Excel nguá»“n (`source.xlsx`)
- DÃ²ng 1 lÃ  tiÃªu Ä‘á» (header)
- Chá»‰ copy má»™t vÃ i cá»™t (khá»›p vá»›i header cá»§a file Ä‘Ã­ch á»Ÿ dÃ²ng 2)
- DÃ¡n dá»¯ liá»‡u vÃ o file Ä‘Ã­ch (`destination.xlsx`) tá»« dÃ²ng sá»‘ 4 trá»Ÿ Ä‘i
- **Tá»‘i Æ°u tá»‘c Ä‘á»™ xá»­ lÃ½ cho data lá»›n**

---

## ğŸ§± Cáº¥u trÃºc file Excel

### ğŸ“„ `source.xlsx`
| A       | B       | C       | D       | ... |
|---------|---------|---------|---------|-----|
| MÃ£ SP   | TÃªn SP  | GiÃ¡     | NgÃ y    | ... |
| SP001   | Sáº£n pháº©m A | 1000 | 2024-01-01 | ... |
| SP002   | Sáº£n pháº©m B | 1500 | 2024-01-02 | ... |
| ...     | ...     | ...     | ...     | ... |

### ğŸ“„ `destination.xlsx`
| (Row 1: bá» trá»‘ng) |
|------------------|
| **TÃªn SP** | **GiÃ¡** |
|            |         | â† DÃ¡n data vÃ o tá»« dÃ²ng 4

---

## ğŸ”§ CÃ¡c bÆ°á»›c thá»±c hiá»‡n trong **UiPath Studio**

---

### 1ï¸âƒ£ **Táº¡o project má»›i**
- Má»Ÿ UiPath Studio â†’ Chá»n **New Project** > **Process**
- Äáº·t tÃªn vÃ­ dá»¥: `ExcelColumnMapper_Optimized`

---

### 2ï¸âƒ£ **Khai bÃ¡o biáº¿n**
| TÃªn biáº¿n      | Loáº¡i dá»¯ liá»‡u              | Scope |
|---------------|---------------------------|--------|
| `dtSource`    | `System.Data.DataTable`   | Sequence |
| `dtDestHeader`| `System.Data.DataTable`   | Sequence |
| `dtFinal`     | `System.Data.DataTable`   | Sequence |

---

### 3ï¸âƒ£ **Read dá»¯ liá»‡u tá»« file nguá»“n**

**Activity:** `Read Range Workbook`  
- **WorkbookPath:** `"source.xlsx"`
- **Sheet:** `"Sheet1"`
- **AddHeaders:** `False` âœ…
- **Output:** `dtSource`

ğŸ“Œ *LÃ½ do khÃ´ng dÃ¹ng headers: Ä‘á»ƒ láº¥y luÃ´n dÃ²ng 1 lÃ m dá»¯ liá»‡u Ä‘á»ƒ xá»­ lÃ½ custom header*

---

### 4ï¸âƒ£ **Read header tá»« file Ä‘Ã­ch (dÃ²ng 2)**

**Activity:** `Read Range Workbook`  
- **WorkbookPath:** `"destination.xlsx"`
- **Range:** `"2:2"`
- **AddHeaders:** `True` âœ…
- **Output:** `dtDestHeader`

---

### 5ï¸âƒ£ **Xá»­ lÃ½ dá»¯ liá»‡u vá»›i `Invoke Code` â€“ Mapping Ä‘Ãºng cá»™t**

**Activity:** `Invoke Code`  
- **Language:** VB  
- **Code:**
```vbnet
' Táº¡o tá»« Ä‘iá»ƒn map tÃªn cá»™t vÃ  vá»‹ trÃ­ index trong dtSource
Dim columnIndexMap As New Dictionary(Of String, Integer)
For i As Integer = 0 To dtSource.Columns.Count - 1
    Dim colName As String = dtSource.Rows(0)(i).ToString().Trim()
    If Not columnIndexMap.ContainsKey(colName) Then
        columnIndexMap(colName) = i
    End If
Next

' Táº¡o dtFinal theo cá»™t Ä‘Ã­ch
dtFinal = New DataTable()
Dim destColumnIndexes As New List(Of Integer)

For Each destCol As DataColumn In dtDestHeader.Columns
    Dim colName As String = destCol.ColumnName.Trim()
    dtFinal.Columns.Add(colName)
    If columnIndexMap.ContainsKey(colName) Then
        destColumnIndexes.Add(columnIndexMap(colName))
    Else
        destColumnIndexes.Add(-1) ' KhÃ´ng cÃ³ thÃ¬ Ä‘á»ƒ rá»—ng
    End If
Next

' ThÃªm dá»¯ liá»‡u tá»« dÃ²ng thá»© 2 trá»Ÿ Ä‘i trong dtSource
For i As Integer = 1 To dtSource.Rows.Count - 1
    Dim srcRow = dtSource.Rows(i)
    Dim newRow = dtFinal.NewRow()

    For j As Integer = 0 To destColumnIndexes.Count - 1
        Dim srcIndex = destColumnIndexes(j)
        If srcIndex >= 0 Then
            newRow(j) = srcRow(srcIndex)
        End If
    Next

    dtFinal.Rows.Add(newRow)
Next
```

**Arguments:**
- `dtSource` â†’ `In` (DataTable)
- `dtDestHeader` â†’ `In` (DataTable)
- `dtFinal` â†’ `Out` (DataTable)

---

### 6ï¸âƒ£ **DÃ¡n káº¿t quáº£ vÃ o file Ä‘Ã­ch tá»« dÃ²ng sá»‘ 4**

**Activity:** `Write Range Workbook`  
- **WorkbookPath:** `"destination.xlsx"`
- **SheetName:** `"Sheet1"`
- **StartingCell:** `"A4"`
- **AddHeaders:** `False`
- **DataTable:** `dtFinal`

---

## âœ… Káº¿t quáº£:
- Dá»¯ liá»‡u Ä‘Æ°á»£c copy nhanh chÃ³ng dÃ¹ cÃ³ 90.000 dÃ²ng
- Cá»™t Ä‘Ãºng tÃªn vÃ  Ä‘Ãºng thá»© tá»± vá»›i file Ä‘Ã­ch
- KhÃ´ng lá»—i lá»‡ch cá»™t, sai Ä‘á»‹nh dáº¡ng

---

## ğŸ’¡ Gá»£i Ã½ nÃ¢ng cao náº¿u cáº§n:
| Má»¥c tiÃªu | HÆ°á»›ng xá»­ lÃ½ |
|---------|-------------|
| Xá»­ lÃ½ nhiá»u file source | DÃ¹ng `For Each File in Folder` |
| Cáº¥u hÃ¬nh cá»™t cáº§n láº¥y | Äá»c tá»« 1 file `Excel cáº¥u hÃ¬nh` |
| TÄƒng tá»‘c hÆ¡n ná»¯a | Chia batch 10,000 rows vÃ  xá»­ lÃ½ song song (Parallel For Each) |
| Log tiáº¿n trÃ¬nh | DÃ¹ng `Log Message`, hoáº·c `Append Line` vÃ o file txt |

---

Báº¡n muá»‘n mÃ¬nh **gá»­i láº¡i toÃ n bá»™ file `.xaml` Ä‘Ã£ cÃ³ code má»›i** vÃ  file máº«u Ä‘á»ƒ test?

ğŸ‘‰ Chá»‰ cáº§n gáº­t Ä‘áº§u, mÃ¬nh gá»­i liá»n!
