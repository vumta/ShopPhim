T√¥i ƒë√£ c·∫≠p nh·∫≠t m√£ VBA ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng n·∫øu **m·ªôt file b·ªã thi·∫øu nhi·ªÅu c·ªôt**, ch∆∞∆°ng tr√¨nh s·∫Ω ch·ªâ hi·ªÉn th·ªã **m·ªôt d√≤ng l·ªói duy nh·∫•t cho file ƒë√≥**. N·∫øu c√≥ **nhi·ªÅu file b·ªã l·ªói**, ch∆∞∆°ng tr√¨nh s·∫Ω hi·ªÉn th·ªã **nhi·ªÅu d√≤ng l·ªói t∆∞∆°ng ·ª©ng t·ª´ng file**, thay v√¨ g·ªôp chung t·∫•t c·∫£ l·ªói v√†o m·ªôt d√≤ng duy nh·∫•t.

### **M√£ VBA ƒê√£ C·∫≠p Nh·∫≠t**
```vba
Public Function ConsolidateMultipleFiles(ByVal sourceFilePaths As String, ByVal targetFilePath As String, ByVal columnsToCopy As String) As String
    Dim sourceFiles() As String
    Dim sourceWorkbook As Workbook
    Dim targetWorkbook As Workbook
    Dim sourceSheet As Worksheet
    Dim targetSheet As Worksheet
    Dim sourceColumns() As String
    Dim targetCol As Integer
    Dim lastRowSource As Long
    Dim lastRowTarget As Long
    Dim sourceData As Variant
    Dim i As Integer, j As Integer
    Dim errorMessages As String
    Dim missingColumns As String
    Dim successFiles As String
    Dim hasError As Boolean

    On Error GoTo ErrorHandler

    ' Ph√¢n t√°ch danh s√°ch file ngu·ªìn t·ª´ chu·ªói
    sourceFiles = Split(sourceFilePaths, ",")

    ' M·ªü file ƒë√≠ch
    Set targetWorkbook = Workbooks.Open(targetFilePath)
    Set targetSheet = targetWorkbook.Sheets(2) ' X√°c ƒë·ªãnh sheet c·∫ßn ghi d·ªØ li·ªáu

    ' Chuy·ªÉn c√°c c·ªôt c·∫ßn sao ch√©p t·ª´ chu·ªói th√†nh m·∫£ng
    sourceColumns = Split(columnsToCopy, ",")

    ' X√≥a d·ªØ li·ªáu c≈© nh∆∞ng gi·ªØ l·∫°i ti√™u ƒë·ªÅ
    If Application.CountA(targetSheet.Rows(2)) > 0 Then
        targetSheet.Rows("2:" & targetSheet.Rows.Count).ClearContents
    End If

    ' X√≥a d·ªØ li·ªáu t·ª´ h√†ng 4 tr·ªü ƒëi trong c·ªôt A, B
    Dim lastRowToClear As Long
    lastRowToClear = targetSheet.Cells(targetSheet.Rows.Count, 1).End(xlUp).Row
    If lastRowToClear >= 4 Then
        targetSheet.Range("A4:B" & lastRowToClear).ClearContents
    End If

    ' ƒê·∫∑t c·ªù ki·ªÉm tra l·ªói
    hasError = False

    ' Duy·ªát qua t·ª´ng file ngu·ªìn
    For i = LBound(sourceFiles) To UBound(sourceFiles)
        On Error Resume Next
        Set sourceWorkbook = Workbooks.Open(Trim(sourceFiles(i)))
        If Err.Number <> 0 Then
            errorMessages = errorMessages & "L·ªói khi m·ªü file: " & sourceFiles(i) & " - " & Err.Description & vbNewLine
            hasError = True
            Err.Clear
            GoTo NextFile
        End If
        On Error GoTo 0

        Set sourceSheet = sourceWorkbook.Sheets(1) ' L·∫•y sheet ƒë·∫ßu ti√™n c·ªßa file ngu·ªìn

        ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong file ngu·ªìn
        lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, 1).End(xlUp).Row

        ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong file ƒë√≠ch
        lastRowTarget = targetSheet.Cells(targetSheet.Rows.Count, 1).End(xlUp).Row + 1

        ' ƒê·∫∑t l·∫°i danh s√°ch c·ªôt b·ªã thi·∫øu cho file hi·ªán t·∫°i
        missingColumns = ""

        ' Duy·ªát qua t·ª´ng c·ªôt c·∫ßn sao ch√©p
        For j = LBound(sourceColumns) To UBound(sourceColumns)
            ' T√¨m c·ªôt ngu·ªìn d·ª±a v√†o t√™n c·ªôt
            Dim sourceCol As Integer
            On Error Resume Next
            sourceCol = Application.Match(sourceColumns(j), sourceSheet.Rows(1), 0)
            On Error GoTo 0

            If sourceCol = 0 Then
                ' N·∫øu c·ªôt kh√¥ng t√¨m th·∫•y, th√™m v√†o danh s√°ch c·ªôt b·ªã thi·∫øu
                If missingColumns = "" Then
                    missingColumns = sourceColumns(j)
                Else
                    missingColumns = missingColumns & ", " & sourceColumns(j)
                End If
            Else
                ' X√°c ƒë·ªãnh d√≤ng cu·ªëi c√πng c·ªßa d·ªØ li·ªáu trong c·ªôt ngu·ªìn
                lastRowSource = sourceSheet.Cells(sourceSheet.Rows.Count, sourceCol).End(xlUp).Row

                ' Sao ch√©p d·ªØ li·ªáu t·ª´ c·ªôt ngu·ªìn
                sourceData = sourceSheet.Range(sourceSheet.Cells(2, sourceCol), sourceSheet.Cells(lastRowSource, sourceCol)).Value

                ' T√¨m c·ªôt ƒë√≠ch d·ª±a tr√™n t√™n c·ªôt
                targetCol = Application.Match(sourceColumns(j), targetSheet.Rows(1), 0)

                If targetCol > 0 Then
                    ' D√°n d·ªØ li·ªáu v√†o c·ªôt ƒë√≠ch
                    targetSheet.Range(targetSheet.Cells(lastRowTarget, targetCol), _
                                      targetSheet.Cells(lastRowTarget + UBound(sourceData, 1) - 1, targetCol)).Value = sourceData
                Else
                    errorMessages = errorMessages & "L·ªói: Kh√¥ng t√¨m th·∫•y c·ªôt ƒë√≠ch '" & sourceColumns(j) & "' trong file ƒë√≠ch." & vbNewLine
                    hasError = True
                End If
            End If
        Next j

        ' N·∫øu c√≥ c·ªôt b·ªã thi·∫øu, th√™m m·ªôt d√≤ng l·ªói duy nh·∫•t cho file ngu·ªìn
        If missingColumns <> "" Then
            errorMessages = errorMessages & "Thi·∫øu c·ªôt trong file " & sourceFiles(i) & ": " & missingColumns & vbNewLine
            hasError = True
        Else
            ' N·∫øu file ch·∫°y th√†nh c√¥ng, l∆∞u danh s√°ch file th√†nh c√¥ng
            If successFiles = "" Then
                successFiles = sourceFiles(i)
            Else
                successFiles = successFiles & ", " & sourceFiles(i)
            End If
        End If

        ' ƒê√≥ng file ngu·ªìn
        sourceWorkbook.Close False
NextFile:
    Next i

    ' L∆∞u v√† ƒë√≥ng file ƒë√≠ch
    targetWorkbook.Save
    targetWorkbook.Close True

    ' Tr·∫£ v·ªÅ th√¥ng b√°o chi ti·∫øt
    If hasError Then
        ConsolidateMultipleFiles = "Ho√†n th√†nh v·ªõi l·ªói:" & vbNewLine & errorMessages & vbNewLine & _
                                   "C√°c file ch·∫°y th√†nh c√¥ng: " & successFiles
    Else
        ConsolidateMultipleFiles = "Th√†nh c√¥ng: D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c sao ch√©p t·ª´ t·∫•t c·∫£ file ngu·ªìn v√†o file ƒë√≠ch."
    End If

    Exit Function

ErrorHandler:
    ConsolidateMultipleFiles = "L·ªói: X·∫£y ra l·ªói trong qu√° tr√¨nh th·ª±c thi: " & Err.Description

CleanUp:
    ' ƒê√≥ng file n·∫øu c·∫ßn thi·∫øt
    If Not sourceWorkbook Is Nothing Then sourceWorkbook.Close False
    If Not targetWorkbook Is Nothing Then targetWorkbook.Close True
End Function
```

---

### **C·∫≠p nh·∫≠t quan tr·ªçng**
1. **Hi·ªÉn th·ªã m·ªôt d√≤ng l·ªói duy nh·∫•t cho m·ªói file n·∫øu c√≥ c·ªôt b·ªã thi·∫øu**:
   - N·∫øu m·ªôt file **b·ªã thi·∫øu nhi·ªÅu c·ªôt**, ch·ªâ **hi·ªÉn th·ªã m·ªôt d√≤ng l·ªói** v·ªõi danh s√°ch c√°c c·ªôt b·ªã thi·∫øu.

2. **X·ª≠ l√Ω t·∫•t c·∫£ c√°c file v√† hi·ªÉn th·ªã t·ª´ng l·ªói ri√™ng bi·ªát**:
   - N·∫øu nhi·ªÅu file b·ªã l·ªói, ch∆∞∆°ng tr√¨nh s·∫Ω **hi·ªÉn th·ªã l·ªói t∆∞∆°ng ·ª©ng t·ª´ng file**, thay v√¨ g·ªôp chung t·∫•t c·∫£ v√†o m·ªôt d√≤ng.

3. **Kh√¥ng d·ª´ng khi g·∫∑p l·ªói**:
   - N·∫øu m·ªôt file c√≥ l·ªói, ch∆∞∆°ng tr√¨nh v·∫´n ti·∫øp t·ª•c x·ª≠ l√Ω c√°c file kh√°c.

---

### **V√≠ d·ª• k·∫øt qu·∫£ tr·∫£ v·ªÅ**
N·∫øu **3 file b·ªã l·ªói** khi m·ªü v√† **2 file b·ªã thi·∫øu c·ªôt**:
```
Ho√†n th√†nh v·ªõi l·ªói:
L·ªói khi m·ªü file: C:\Data\File1.xlsx - File kh√¥ng t·ªìn t·∫°i
L·ªói khi m·ªü file: C:\Data\File3.xlsx - File b·ªã kh√≥a
Thi·∫øu c·ªôt trong file C:\Data\File2.xlsx: Sales, Revenue, Quantity
Thi·∫øu c·ªôt trong file C:\Data\File5.xlsx: ProductName, CustomerID
C√°c file ch·∫°y th√†nh c√¥ng: C:\Data\File4.xlsx, C:\Data\File6.xlsx
```

N·∫øu **t·∫•t c·∫£ file ch·∫°y t·ªët**:
```
Th√†nh c√¥ng: D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c sao ch√©p t·ª´ t·∫•t c·∫£ file ngu·ªìn v√†o file ƒë√≠ch.
```

---

**Gi·ªù ƒë√¢y, n·∫øu m·ªôt file g·∫∑p l·ªói, n√≥ s·∫Ω ƒë∆∞·ª£c li·ªát k√™ ƒë·∫ßy ƒë·ªß tr∆∞·ªõc khi ho√†n th√†nh.** H√£y th·ª≠ nghi·ªám v√† cho t√¥i bi·∫øt n·∫øu b·∫°n c·∫ßn th√™m ƒëi·ªÅu ch·ªânh! üòä
