Tốt — dưới đây mình giải thích rất chi tiết cho Ngày 6 — Dự án thực tế (phần 2) (6.5h). Mình sẽ nêu: phân bổ thời gian, từng bước hành động (action-by-action ở mức mô tả đủ chi tiết để bạn triển khai trong PAD), chiến lược logging & xử lý lỗi nâng cao, cách gửi email báo cáo, cách tích hợp auto-run bằng Cloud Flow (khi có file mới), quản lý concurrency/duplicate, so sánh ngắn Orchestrator vs Power Automate Cloud, checklist kiểm thử và best practices.

Ngày 6 — Dự án thực tế (phần 2)

⏱ Thời lượng: 6.5h

Logging & Error Handling nâng cao — 1.0h

Gửi báo cáo qua Outlook (PAD / Cloud) — 1.0h

Tích hợp Cloud Flow: auto-run khi có file mới + concurrency control — 2.0h

So sánh UiPath Orchestrator vs Power Automate Cloud (quản lý robot/queue) — 0.5h

Ôn tập, checklist kiểm thử, tidy-up project & deliverables — 2.0h



---

1) Logging & Error Handling — nâng cao (1h)

Mục tiêu

Có hệ thống log đủ thông tin để debug (time-stamp, level, message, file/filepath, stack/message lỗi).

Flow an toàn: không dừng toàn bộ vì 1 file bad; retry với backoff; lưu thông tin lỗi để xử lý thủ công.


Thiết kế log (file-based)

Tạo 1 file log chung: C:\PAD\Output\PAD_full_log.txt (append).

Dòng log format đề xuất (CSV-like):
2025-09-18T10:32:15Z | INFO | MergeStart | files=12
2025-09-18T10:35:01Z | WARN | FileRead | file=C:\PAD\Input\bad.xlsx | reason=SheetMissing
2025-09-18T10:36:12Z | ERROR | ConvertNumber | file=... | row=5 | message=InvalidNumber "abc"


Action-by-action (mẫu)

Trước flow: Set variable logPath = "C:\PAD\Output\PAD_full_log.txt"

Tạo helper action (subflow) LogMessage(level, tag, message):

Set variable ts = FormatDateTime(Now(), 'yyyy-MM-ddTHH:mm:ssZ')

Set variable line = ts & " | " & level & " | " & tag & " | " & message

Write text to file → File: %logPath%, Text: %line% + newline, Append = True



> Ghi chú: làm 1 subflow cho LogMessage để gọi ở mọi nơi (INFO/WARN/ERROR).



Retry pattern (mẫu)

Dùng loop + counter:

Set variable attempt = 0

Do Until attempt >= 3 OR success = True

Set variable attempt = attempt + 1

Thực hiện hành động (ví dụ: Launch Excel / Read file) trong Begin Error Handling

Nếu success: set success = True ; LogMessage(INFO, "ReadFile", "ok...")

Nếu Catch: LogMessage(WARN/ERROR, "ReadFile", Error.Message & " attempt=" & attempt) ; Delay 2000 ms



Nếu sau loop success = False → LogMessage(ERROR, "ReadFile", "skipped after 3 attempts")



Catch block actions

Take screenshot (lưu %logFolder%\err_%timestamp%.png)

Write text to file append (error details)

Ensure Excel instance closed (Attach/Close Excel safe)

Set variable to mark this file as failed and continue loop


Lưu lỗi chi tiết (để xử lý sau)

Ghi danh sách files lỗi vào C:\PAD\Output\FailedFiles.csv (file, reason, timestamp).

Có thể tạo ErrorRows.xlsx chứa các hàng lỗi để xử lý thủ công.



---

2) Gửi báo cáo qua Outlook (PAD hoặc Cloud) (1h)

Kịch bản: sau khi tạo Sales_Master.xlsx, gửi email với file đính kèm.

Cách 1 — Gửi trong PAD (native Outlook action)

Action chính: Send email (Outlook) hoặc Send email using SMTP nếu không dùng Outlook client.

Steps (PAD):

1. Set variable to = "boss@company.com" ; subject = "Daily Sales Report - " & FormatDateTime(Now(),'yyyy-MM-dd')


2. Launch Outlook (nếu muốn đảm bảo account ready) — optional.


3. Send email action:

Account: (your Outlook profile)

To: %to%

CC/BCC: (optional)

Subject: %subject%

Body: "Hi team,\nPlease find attached today's sales report.\nRegards,\nPAD Bot"

Attachments: %masterExcelPath% (hoặc list of files)

Save copy to Sent Items: True (tùy ý)



4. LogMessage(INFO, "SendEmail", "Sent to " & to & " file=" & masterExcelPath)



Error handling: bọc Send email trong Try/Catch; nếu fail, log error + option gửi fallback (ví dụ: save file vào shared folder and notify via Teams/Slack).

Cách 2 — Gửi trong Cloud Flow (recommended khi tích hợp Cloud)

Nếu Cloud Flow gọi PAD, bạn có PAD trả về ReportFilePath → Cloud Flow có thể dùng action Send an email (V2) (Outlook) và attach file content (Cloud Flow sẽ read file from SharePoint/OneDrive or use "Get file content" and attach).

Ưu điểm: Cloud Flow quản lý gửi email (reliability, connectors, rich formatting, templates).


Lưu ý: khi gửi attachment từ PAD => nếu PAD chạy trên máy có Outlook, attach file path works. Nếu PAD chạy headless/remote, better to let Cloud Flow handle sending.


---

3) Tích hợp Cloud Flow: auto-run khi có file mới (2h)

Mục tiêu

Khi có file mới (ví dụ: file upload lên SharePoint / OneDrive), tự động kích hoạt pipeline: Cloud Flow → gọi Desktop Flow → PAD xử lý file → báo cáo.


3 cách triển khai & lựa chọn khuyến nghị

A. (Khuyến nghị nếu bạn dùng SharePoint/OneDrive) — Cloud Flow trigger (SharePoint) → call PAD

Cloud Flow: Trigger When a file is created in a folder (SharePoint) hoặc When a file is created (OneDrive).

Action: Run a flow built with Power Automate for desktop → chọn Desktop Flow đã publish.

Map inputs: FileIdentifier (ID), FileName, SiteUrl, hoặc DownloadLink.

Option 1: Cloud Flow Get file content → Create file into a OneDrive-synced folder on the PAD machine (if that machine syncs that OneDrive account). Then call PAD with local file path.

Option 2: Cloud Flow pass file content as base64 to Desktop Flow input (watch for input size limits); PAD can convert base64 → write to disk. (Input size limit applies — avoid large files.)


B. (Nếu only local folder) — Use OneDrive sync or a scheduled Polling Cloud Flow

If upload occurs directly to a local folder (not SharePoint), Cloud Flow cannot directly watch local file. Two options:

Install OneDrive/SharePoint sync and have users save to synced location; Cloud Flow watches cloud location.

Or create a scheduled PAD flow (Recurrence schedule in Cloud Flow) that runs every X minutes and calls Desktop Flow to scan local input folder. (This is simple polling.)



C. (Robust queueing) — Cloud Flow enqueue metadata → PAD scheduled worker

Cloud Flow trigger on file created → add an item (metadata) to a SharePoint list / Dataverse table / Azure Queue.

A scheduled Cloud Flow or PAD worker polls the queue and processes one item at a time (good for concurrency control & retry).

Benefit: can implement re-try, failure count, manual retry, auditing.


Example: Cloud Flow minimal (SharePoint → PAD)

1. Trigger: When a file is created in a folder (SiteAddress, LibraryName, Folder)


2. Action: Get file content (SharePoint) → output FileContent


3. Action: Create file in OneDrive for Business folder that is synced on PAD machine (Path: C:\Users\<user>\OneDrive\PAD\Input) — use FileContent.


4. Action: Run a flow built with Power Automate for desktop → Input: LocalFilePath = C:\Users\<user>\OneDrive\PAD\Input\<fileName>


5. Optionally: Wait for PAD returned outputs (Status, ReportPath) and then continue (send notifications etc.)



Concurrency control

In Cloud Flow action settings, turn off parallelism for loops (if using Apply to each).

Use queue design (SharePoint/Dataverse) to process items sequentially.

Implement lock/check in PAD: before processing a file, PAD checks ProcessedFiles.csv/SharePoint list to ensure file not already processed (atomicity via Cloud Flow help).


Timeouts & retries

Cloud Flow has built-in retry policy for actions — configure as needed.

PAD should implement per-file retry (as earlier pattern) and report back status.


Testing

Upload test file to SharePoint → observe Cloud Flow run history → PAD runs on machine → check logs, report file, and email.



---

4) So sánh ngắn: UiPath Orchestrator vs Power Automate Cloud (0.5h)

> Đây là so sánh chi tiết giúp bạn quyết định triển khai enterprise.



UiPath Orchestrator (mạnh ở RPA chuyên sâu)

Quản lý robot (unattended/attended), scheduling, job queues, transactions (Queue + Transaction Item), retry & SLA tích hợp.

Asset management (credentials, assets), high-scale robot farm, robust logging/telemetry, role-based access control.

Tích hợp enterprise RPA features (long-running, human-in-the-loop với Forms/Tasks).

Thường là chọn tốt cho các môi trường RPA lớn, cần queuing/transaction.


Power Automate Cloud (mạnh ở Microsoft stack & tích hợp)

Tích hợp chặt với SharePoint, Teams, Outlook, Dataverse, Power Apps.

Desktop flows (PAD) chạy qua gateway/agent; Cloud Flow có action native để chạy Desktop Flow.

Monitoring basic runs, run history, environment/solution management.

Queues/transaction patterns có thể xài Dataverse / SharePoint lists / Azure Queues nhưng không có built-in RPA Queue feature giống Orchestrator (tùy tiến bộ của MS Over time).

Phù hợp nếu tổ chức heavy Microsoft (Office 365) want low-friction integration.


Kết luận nhanh: Nếu bạn đã có UiPath Orchestrator license & cần advanced queueing & robot scale — Orchestrator vẫn mạnh. Nếu tổ chức dùng Microsoft 365 & muốn tight integration & lower TCO for MS shops — Power Automate Cloud + PAD là lựa chọn hợp lý.


---

5) Ôn tập, checklist kiểm thử & deliverables (2h)

Acceptance checklist (phải pass)

[ ] Khi upload file test → Cloud Flow kích hoạt và gọi PAD.

[ ] PAD nhận file, gộp dữ liệu, ghi Sales_Master.xlsx đúng expected rows.

[ ] PAD lưu log chi tiết (PAD_full_log.txt) với ít nhất: start/end, per-file WARN/ERROR.

[ ] Nếu 1 file lỗi: PAD skip file, ghi FailedFiles.csv, tiếp tục với file khác.

[ ] Email báo cáo được gửi (Outlook) kèm file đính kèm (nếu dùng PAD), hoặc Cloud Flow gửi email với attachment (nếu Cloud gửi).

[ ] Concurrency control: không có 2 run cùng xử lý cùng file (checked by processed-file tracking).

[ ] Documented runbook: how to run locally, how to reprocess failed files.


Test cases

1. Normal: 5 valid files → expect merged 5×N rows.


2. File missing sheet → expect logged + skipped.


3. Locked file → retry then skip after retries.


4. Duplicate upload (same filename twice) → second run should detect already processed and skip or handle per policy.


5. Large batch (100 files) → measure time, check memory; if issues, implement batch write-to-disk strategy.



Deliverables cuối ngày

PAD Flow hoàn chỉnh (master flow + subflows: LogMessage, ProcessFile, ErrorHandler).

Cloud Flow (trigger + call PAD + optional postprocessing).

PAD_full_log.txt, FailedFiles.csv, Sales_Master.xlsx sample.

Runbook ngắn (README) mô tả cách deploy, config biến (paths, credentials), steps xử lý lỗi.



---

6) Best practices (tổng kết nhanh)

Modularize: chia flow thành subflows (ProcessFile, LogMessage, SendEmail).

Không hard-code secrets: dùng Cloud Flow input sensitive flags, hoặc store credentials in secure store (Key Vault / environment vars).

Batch writes: build DataTable, write once.

Keep UI automation to minimum; prefer connector-based operations (SharePoint/Graph/Excel actions).

Instrumentation: logs + screenshots on error.

Version control: lưu tên version & change log cho flow (use naming convention).

Monitoring: enable Cloud Flow run history alerts for failures.



---

Nếu bạn muốn tiếp theo mình có thể (mình sẽ làm ngay / không cần bạn chờ):

(A) Viết bản “action-by-action” hoàn chỉnh cho cả phần Logging/Error + Send Email + Cloud Flow trigger (mỗi action với parameter cụ thể) — dạng ready-to-copy vào PAD.

(B) Cập nhật file TrainingPlan_PAD.xlsx của bạn: thêm nội dung chi tiết ngày 6 vào cột Note và thêm checklist kiểm thử.


Bạn muốn mình thực hiện (A) hay (B)? (Mình sẽ làm tiếp ngay khi bạn chọn.)

