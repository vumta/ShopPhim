Äá»ƒ xá»­ lÃ½ lá»—i **`setValues()` bá»‹ timeout** (thÆ°á»ng xáº£y ra vá»›i **dá»¯ liá»‡u lá»›n**, vÃ­ dá»¥ 10.000+ dÃ²ng), báº¡n nÃªn **chia nhá» (batch) dá»¯ liá»‡u vÃ  dÃ¡n tá»«ng pháº§n nhá» má»™t** thay vÃ¬ dÃ¡n toÃ n bá»™ cÃ¹ng lÃºc.

DÆ°á»›i Ä‘Ã¢y lÃ  **Office Script Ä‘Æ°á»£c cáº­p nháº­t** Ä‘á»ƒ:

- Váº«n dÃ¡n Ä‘Ãºng tá»«ng dÃ²ng, tá»«ng cá»™t.
- Tá»± Ä‘á»™ng **chia nhá» thÃ nh batchSize** (máº·c Ä‘á»‹nh lÃ  500 dÃ²ng má»—i láº§n).
- DÃ¡n **nhiá»u láº§n liÃªn tiáº¿p** thay vÃ¬ má»™t láº§n lá»›n â†’ trÃ¡nh timeout.

---

## âœ… **Office Script: DÃ¡n 1 cá»™t, chia batch**

```ts
function main(workbook: ExcelScript.Workbook, input: { columnName: string, values: string[][] }): void {
  const sheet = workbook.getActiveWorksheet();

  const maxCols = 100;
  const headerRow = sheet.getRangeByIndexes(1, 0, 1, maxCols).getValues()[0];

  let colMap: Record<string, number> = {};
  for (let i = 0; i < headerRow.length; i++) {
    const name = headerRow[i]?.toString().trim();
    if (name) colMap[name] = i;
  }

  const colIndex = colMap[input.columnName];
  if (colIndex === undefined) return;

  // TÃ¬m dÃ²ng cuá»‘i trong cá»™t cáº§n dÃ¡n
  const checkRange = sheet.getRangeByIndexes(2, colIndex, 100000, 1).getValues();
  let lastRow = 2;
  for (let i = checkRange.length - 1; i >= 0; i--) {
    if (checkRange[i][0] !== null && checkRange[i][0] !== "") {
      lastRow = i + 3;
      break;
    }
  }

  const values = input.values;
  const totalRows = values.length;
  const batchSize = 500;

  for (let i = 0; i < totalRows; i += batchSize) {
    const batch = values.slice(i, i + batchSize);
    const batchRowCount = batch.length;
    const range = sheet.getRangeByIndexes(lastRow, colIndex, batchRowCount, 1);
    range.setValues(batch);
    lastRow += batchRowCount;
  }
}
```

---

## âœ… Æ¯u Ä‘iá»ƒm:

| Váº¥n Ä‘á» | ÄÃ£ xá»­ lÃ½ |
|--------|-----------|
| `setValues()` timeout | âœ… DÃ¡n theo tá»«ng batch nhá» |
| Dá»¯ liá»‡u lá»›n (10.000+ dÃ²ng) | âœ… An toÃ n hÆ¡n |
| KhÃ´ng bá»‹ máº¥t thá»© tá»± dÃ²ng | âœ… Chuáº©n |

---

## ğŸ”§ TÃ¹y chá»‰nh:
- Náº¿u Power Automate cá»§a báº¡n Ä‘Ã£ chia batch rá»“i â†’ **giá»¯ nguyÃªn** `values` Ä‘áº§u vÃ o.
- Náº¿u báº¡n muá»‘n dÃ¡n nhiá»u cá»™t â†’ mÃ¬nh cÃ³ thá»ƒ má»Ÿ rá»™ng version Ä‘a cá»™t, chia batch song song.

---

ğŸ“¦ **Báº¡n cáº§n mÃ¬nh Ä‘Ã³ng gÃ³i láº¡i toÃ n bá»™ flow `.zip` máº«u dÃ¹ng script nÃ y khÃ´ng?**  
Hoáº·c báº¡n muá»‘n cÃ³ demo dÃ¹ng batching cho nhiá»u file? Cá»© nÃ³i nha!
