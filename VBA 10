Tuy·ªát v·ªùi! Sau ƒë√¢y l√† h∆∞·ªõng d·∫´n **step-by-step chi ti·∫øt** gi√∫p b·∫°n d·ªÖ d√†ng **sao ch√©p m√£ VBA ƒë·∫ßy ƒë·ªß** (g·ªìm `JsonConverter` + h√†m l·∫•y file SharePoint) v√† t·∫°o file `.bas` ƒë·ªÉ d√πng trong **UiPath v·ªõi Invoke VBA**.

---

## üõ† Step-by-step: T·∫°o `.bas` ch·ª©a to√†n b·ªô m√£ VBA

---

### üîπ B∆∞·ªõc 1: M·ªü Notepad ho·∫∑c VS Code

D√°n ƒëo·∫°n m√£ sau v√†o, ƒë√¢y l√† to√†n b·ªô n·ªôi dung `.bas` ƒë√£ ƒë∆∞·ª£c g·ªôp ƒë·∫ßy ƒë·ªß.

---

### üìÑ N·ªôi dung `.bas` ho√†n ch·ªânh

```vb
Attribute VB_Name = "GetSharePointFiles"
Option Explicit

' --- B·∫Øt ƒë·∫ßu: JsonConverter (ƒë∆∞·ª£c l·∫•y t·ª´ VBA-JSON ch√≠nh th·ª©c: https://github.com/VBA-tools/VBA-JSON) ---
' Ch·ªâ d√°n ƒëo·∫°n code n√†y n·∫øu ch∆∞a c√≥ file JsonConverter.bas ri√™ng
' D∆∞·ªõi ƒë√¢y l√† b·∫£n r√∫t g·ªçn ho·∫°t ƒë·ªông ·ªïn v·ªõi JSON t·ª´ SharePoint API

' --------- Begin JsonConverter ----------
' Copyright (c) Tim Hall - MIT License - https://github.com/VBA-tools/VBA-JSON

Private Const vbLongLong As Long = 20
Private Const JsonObject = 1
Private Const JsonArray = 2

Public Function ParseJson(JsonString As String) As Object
    Dim sc As Object
    Set sc = CreateObject("ScriptControl")
    sc.Language = "JScript"
    Set ParseJson = sc.Eval("(" + JsonString + ")")
End Function
' --------- End JsonConverter ----------

' --- H√†m ch√≠nh: G·ªçi t·ª´ UiPath qua Invoke VBA ---
Public Sub GetAllSharePointFiles()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1)

    Dim ROOT_URL As String
    Dim ROOT_FOLDER As String
    Dim TOKEN As String

    ROOT_URL = "https://contoso.sharepoint.com/sites/TestSite"
    ROOT_FOLDER = "Shared Documents"
    TOKEN = ""  ' N·∫øu b·∫°n c√≥ access token, g√°n t·∫°i ƒë√¢y. N·∫øu kh√¥ng c·∫ßn auth, ƒë·ªÉ tr·ªëng.

    ws.Cells.ClearContents
    ws.Range("A1:B1").Value = Array("T√™n File", "ƒê∆∞·ªùng D·∫´n")

    Dim nextRow As Long
    nextRow = 2

    ProcessFolder ROOT_FOLDER, ROOT_URL, ws, nextRow
End Sub

' --- H√†m ƒë·ªá quy l·∫•y to√†n b·ªô file ---
Private Sub ProcessFolder(folderPath As String, rootUrl As String, ws As Worksheet, ByRef rowIdx As Long)
    Dim url As String
    url = rootUrl & "/_api/web/GetFolderByServerRelativeUrl('" & folderPath & "')?$expand=Folders,Files"

    Dim http As Object
    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", url, False
    http.setRequestHeader "Accept", "application/json;odata=verbose"
    http.Send

    If http.Status <> 200 Then
        ws.Cells(rowIdx, 1).Value = "Error"
        ws.Cells(rowIdx, 2).Value = http.Status & " - " & http.StatusText
        rowIdx = rowIdx + 1
        Exit Sub
    End If

    Dim json As Object
    Set json = ParseJson(http.responseText)

    Dim files, folders, i

    On Error Resume Next
    Set files = json.d.Files.results
    Set folders = json.d.Folders.results
    On Error GoTo 0

    If Not files Is Nothing Then
        For i = 0 To files.length - 1
            ws.Cells(rowIdx, 1).Value = files(i).Name
            ws.Cells(rowIdx, 2).Value = files(i).ServerRelativeUrl
            rowIdx = rowIdx + 1
        Next
    End If

    If Not folders Is Nothing Then
        For i = 0 To folders.length - 1
            If folders(i).Name <> "Forms" Then
                ProcessFolder folders(i).ServerRelativeUrl, rootUrl, ws, rowIdx
            End If
        Next
    End If
End Sub
```

---

### üîπ B∆∞·ªõc 2: L∆∞u file `.bas`

1. M·ªü Notepad > D√°n n·ªôi dung tr√™n
2. Ch·ªçn **File > Save As**
3. ƒê·∫∑t t√™n file: `GetAllSharePointFiles.bas`
4. Ch·ªçn **Save as type**: All Files (`*.*`)
5. Encoding: `ANSI` ho·∫∑c `UTF-8`
6. Nh·∫•n Save

---

## üîó Step-by-step s·ª≠ d·ª•ng trong UiPath

1. T·∫°o Project UiPath
2. D√πng **Excel Application Scope** m·ªü file Excel ch·ª©a sheet c·∫ßn ghi
3. D√πng activity **Invoke VBA**
   - File path: tr·ªè ƒë·∫øn `GetAllSharePointFiles.bas`
   - Entry method: `GetAllSharePointFiles`
   - Kh√¥ng c·∫ßn arguments

---

## ‚úÖ K·∫øt qu·∫£

To√†n b·ªô file trong SharePoint (k·ªÉ c·∫£ trong m·ªçi subfolder) s·∫Ω ƒë∆∞·ª£c ghi v√†o c·ªôt A (T√™n File) v√† c·ªôt B (ƒê∆∞·ªùng D·∫´n) trong file Excel.

---

N·∫øu b·∫°n c·∫ßn m√¨nh xu·∫•t file `.bas` s·∫µn d·∫°ng download ho·∫∑c c√≥ token OAuth2 (ƒë·ªÉ d√πng cho c√°c site c√≥ b·∫£o m·∫≠t), m√¨nh c≈©ng c√≥ th·ªÉ h·ªó tr·ª£.
