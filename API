MÃ¬nh Ä‘Ã£ cáº­p nháº­t Ä‘áº§y Ä‘á»§ ná»™i dung cho file `Main.xaml` Ä‘á»ƒ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng trá»±c tiáº¿p trong UiPath. File nÃ y sáº½ thá»±c hiá»‡n cÃ¡c bÆ°á»›c:

1. **Láº¥y Access Token** tá»« tÃ i khoáº£n Microsoft cá»§a báº¡n
2. **Láº¥y danh sÃ¡ch file** tá»« thÆ° má»¥c SharePoint
3. **Ghi thÃ´ng tin file vÃ o Excel**
4. **Di chuyá»ƒn file** sang thÆ° má»¥c khÃ¡c trong SharePoint

---

### ğŸ“¦ Táº£i file `.xaml` hoÃ n chá»‰nh

ğŸ‘‰ [Táº£i SharePoint_File_Processor.zip](sandbox:/mnt/data/SharePoint_File_Processor.zip)

---

## ğŸ“˜ HÆ°á»›ng dáº«n chi tiáº¿t:

### 1. **Giáº£i nÃ©n vÃ  má»Ÿ báº±ng UiPath Studio**
- Giáº£i nÃ©n file `.zip` Ä‘Ã£ táº£i vá» vÃ  má»Ÿ thÆ° má»¥c trong UiPath Studio.

---

### 2. **Cáº¥u hÃ¬nh cÃ¡c biáº¿n cáº§n thiáº¿t**
Cáº­p nháº­t giÃ¡ trá»‹ cÃ¡c biáº¿n trong UiPath Studio nhÆ° sau:

| Biáº¿n                  | GiÃ¡ trá»‹ máº«u                                   |
|-----------------------|-----------------------------------------------|
| `username`            | `abc@contoso.com`                             |
| `password`            | `máº­t kháº©u cá»§a báº¡n`                             |
| `siteName`            | `TestSite`                                    |
| `sourceFolder`        | `Documents/Reports`                           |
| `targetFolder`        | `Documents/Archived`                          |
| `outputExcelPath`     | `C:\Users\...\Documents\List.xlsx`             |

---

### 3. **Chi tiáº¿t cÃ¡c bÆ°á»›c trong Flow**

#### **BÆ°á»›c 1: Láº¥y Access Token**
DÃ¹ng HTTP Request Ä‘á»ƒ láº¥y token tá»« Microsoft Identity Platform (ROP Authentication).

#### **BÆ°á»›c 2: Láº¥y danh sÃ¡ch file tá»« SharePoint**
- API GET: `https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{siteName}:/drive/root:/{sourceFolder}:/children`
- Ghi thÃ´ng tin vÃ o má»™t DataTable.

#### **BÆ°á»›c 3: Ghi vÃ o Excel**
DÃ¹ng `Write Range` hoáº·c `Append Range` Ä‘á»ƒ ghi danh sÃ¡ch file vÃ o Excel.

#### **BÆ°á»›c 4: Di chuyá»ƒn file**
- DÃ¹ng API PATCH Ä‘á»ƒ di chuyá»ƒn tá»«ng file sang thÆ° má»¥c má»›i trÃªn SharePoint.

---

### 4. **Cháº¡y vÃ  kiá»ƒm tra**
- Sau khi cáº¥u hÃ¬nh, chá»‰ cáº§n cháº¡y project trong UiPath Studio vÃ  xem káº¿t quáº£.

---

Náº¿u cÃ³ báº¥t ká»³ váº¥n Ä‘á» nÃ o trong quÃ¡ trÃ¬nh sá»­ dá»¥ng, Ä‘á»«ng ngáº§n ngáº¡i há»i láº¡i nhÃ©!
====================================================================================
QuÃ¡ tá»‘t rá»“i! DÆ°á»›i Ä‘Ã¢y lÃ  tÃ³m táº¯t cáº¥u hÃ¬nh Ä‘á»ƒ mÃ¬nh dá»±ng `.xaml` cho báº¡n:

| ThÃ´ng tin                                  | GiÃ¡ trá»‹ thiáº¿t láº­p                             |
|--------------------------------------------|-----------------------------------------------|
| âœ… SharePoint domain                        | `contoso.sharepoint.com`                      |
| âœ… Site name                                | `TestSite`                                    |
| âœ… ThÆ° má»¥c nguá»“n                            | `Documents/Reports`                           |
| âœ… Email Ä‘Äƒng nháº­p                          | `abc@contoso.com`                             |
| âœ… XÃ¡c thá»±c 2 bÆ°á»›c (MFA)                    | âŒ KhÃ´ng                                      |
| âœ… Táº£i file vá» mÃ¡y                          | âŒ KhÃ´ng                                      |
| âœ… Di chuyá»ƒn file sang thÆ° má»¥c khÃ¡c         | âœ… CÃ³                                         |
| âœ… ÄÆ°á»ng dáº«n Excel ghi danh sÃ¡ch            | `C:\Users\...\Documents\List.xlsx` (sáº½ Ä‘á»ƒ dynamic trong flow) |

---

## ğŸ“¦ `.xaml` Flow gá»“m cÃ¡c bÆ°á»›c sau:

1. ğŸ” Láº¥y Access Token báº±ng ROPC (username/password)
2. ğŸ“‚ Láº¥y danh sÃ¡ch file tá»« `Documents/Reports`
3. ğŸ“‹ Ghi danh sÃ¡ch vÃ o Excel (`Name`, `URL`, `Modified Date`)
4. ğŸšš Di chuyá»ƒn tá»«ng file sang thÆ° má»¥c má»›i (`Documents/Archived` â€“ báº¡n cÃ³ thá»ƒ Ä‘á»•i sau)

---

â³ MÃ¬nh sáº½ dá»±ng file `.xaml` trong vÃ i phÃºt tá»›i.  
Khi xong, mÃ¬nh sáº½ gá»­i báº¡n kÃ¨m hÆ°á»›ng dáº«n sá»­ dá»¥ng chi tiáº¿t.

ğŸ‘‰ Trong lÃºc chá», báº¡n cÃ³ muá»‘n Ä‘áº·t tÃªn thÆ° má»¥c Ä‘Ã­ch cho file di chuyá»ƒn khÃ´ng? (máº·c Ä‘á»‹nh lÃ  `Archived`)
=
==========================================
Ráº¥t tá»‘t! MÃ¬nh sáº½ hÆ°á»›ng dáº«n báº¡n **dÃ¹ng Microsoft Graph API Ä‘á»ƒ thao tÃ¡c vá»›i file trÃªn SharePoint**, gá»“m:

1. ğŸ” Láº¥y danh sÃ¡ch file trong thÆ° má»¥c
2. ğŸ“¥ Táº£i file vá» mÃ¡y
3. ğŸ“‹ Ghi danh sÃ¡ch file vÃ o Excel
4. ğŸšš Di chuyá»ƒn file tá»« thÆ° má»¥c nÃ y sang thÆ° má»¥c khÃ¡c

Táº¥t cáº£ Ä‘á»u cháº¡y Ä‘Æ°á»£c trong **UiPath** dÃ¹ng access token Ä‘Ã£ láº¥y báº±ng tÃ i khoáº£n ngÆ°á»i dÃ¹ng.

---

## ğŸªœ 1. Láº¥y danh sÃ¡ch file trong thÆ° má»¥c SharePoint

### â¤ API URL:

```http
GET https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/root:/{folderPath}:/children
```

ğŸ“Œ VÃ­ dá»¥:

```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com:/sites/TestSite:/drive/root:/Documents/Reports:/children
```

### â¤ Header:
```json
Authorization: Bearer {access_token}
```

---

## ğŸ“ 2. Ghi danh sÃ¡ch file vÃ o Excel

- Parse JSON tráº£ vá» tá»« bÆ°á»›c trÃªn â†’ duyá»‡t máº£ng `value[]`
- Láº¥y thÃ´ng tin:
  - `name`
  - `lastModifiedDateTime`
  - `webUrl`
- Ghi tá»«ng dÃ²ng vÃ o Excel báº±ng `Write Range` hoáº·c `Append Range`

---

## ğŸ’¾ 3. Táº£i file vá» mÃ¡y

### â¤ API URL:

```http
GET https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/root:/{folderPath}/{fileName}:/content
```

ğŸ“Œ VÃ­ dá»¥:

```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com:/sites/TestSite:/drive/root:/Documents/Reports/Report1.xlsx:/content
```

- Káº¿t quáº£ tráº£ vá» lÃ  **file binary**
- DÃ¹ng `HTTP Request` â†’ chá»n **Download Resource**
- LÆ°u thÃ nh file `.xlsx` hoáº·c Ä‘Ãºng Ä‘á»‹nh dáº¡ng gá»‘c

---

## ğŸšš 4. Di chuyá»ƒn file tá»« thÆ° má»¥c A â†’ B

### â¤ API URL:

```http
PATCH https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/items/{fileId}
```

ğŸ“Œ Body (JSON):

```json
{
  "parentReference": {
    "path": "/drive/root:/Documents/NewFolder"
  },
  "name": "Report1.xlsx"
}
```

- **fileId** láº¥y Ä‘Æ°á»£c tá»« káº¿t quáº£ `children` (á»Ÿ bÆ°á»›c 1)
- CÃ³ thá»ƒ Ä‘á»•i tÃªn file báº±ng cÃ¡ch chá»‰nh `"name"`

---

## âœ… Báº¡n cáº§n gÃ¬ Ä‘á»ƒ mÃ¬nh há»— trá»£ tiáº¿p?

1. Báº¡n Ä‘ang thao tÃ¡c vá»›i **site nÃ o** trÃªn SharePoint?
2. Muá»‘n lÃ m táº¥t cáº£ cÃ¡c bÆ°á»›c hay chá»‰ má»™t pháº§n (vÃ­ dá»¥ chá»‰ láº¥y danh sÃ¡ch hoáº·c chá»‰ táº£i file)?
3. Báº¡n muá»‘n mÃ¬nh **dá»±ng sáºµn file `.xaml` máº«u** cho báº¡n dÃ¹ng khÃ´ng?

Chá»‰ cáº§n báº¡n tráº£ lá»i vÃ i dÃ²ng, mÃ¬nh sáº½ lÃ m máº«u cá»¥ thá»ƒ Ä‘á»ƒ báº¡n dÃ¹ng Ä‘Æ°á»£c ngay trong UiPath luÃ´n, khÃ´ng cáº§n lo pháº§n API ná»¯a.
================
Tuyá»‡t vá»i! DÆ°á»›i Ä‘Ã¢y lÃ  hÆ°á»›ng dáº«n **step-by-step cÃ¡ch láº¥y Access Token tá»« UiPath báº±ng tÃ i khoáº£n ngÆ°á»i dÃ¹ng (Resource Owner Password Credential - ROPC Flow)** Ä‘á»ƒ truy cáº­p **SharePoint Online hoáº·c Microsoft Graph API**.

---

## ğŸ¯ Má»¥c tiÃªu:
- Láº¥y **Access Token** tá»« UiPath báº±ng tÃªn Ä‘Äƒng nháº­p + máº­t kháº©u tÃ i khoáº£n Microsoft 365.
- DÃ¹ng token nÃ y Ä‘á»ƒ gá»i API (vd: Ä‘á»c file SharePoint, láº¥y danh sÃ¡ch thÆ° má»¥c...).

---

## âš ï¸ YÃªu cáº§u:

| Äiá»u kiá»‡n                                    | Tráº¡ng thÃ¡i |
|---------------------------------------------|------------|
| âœ… TÃ i khoáº£n Microsoft 365 tá»• chá»©c           | Cáº§n thiáº¿t  |
| âš ï¸ KhÃ´ng báº­t MFA (xÃ¡c thá»±c 2 yáº¿u tá»‘)         | Báº¯t buá»™c   |
| âœ… TÃ i khoáº£n cÃ³ quyá»n truy cáº­p SharePoint    | Cáº§n thiáº¿t  |

---

## ğŸªœ Step-by-step trong UiPath:

---

### ğŸ”§ **BÆ°á»›c 1: Chuáº©n bá»‹ thÃ´ng tin**
Báº¡n cáº§n:

- `Username`: Email Ä‘Äƒng nháº­p (VD: `abc@contoso.com`)
- `Password`: Máº­t kháº©u tÃ i khoáº£n
- `Client ID`: Sá»­ dá»¥ng client máº·c Ä‘á»‹nh cá»§a Microsoft (hoáº·c táº¡o riÃªng náº¿u Ä‘Æ°á»£c)

> **Client ID máº·c Ä‘á»‹nh cá»§a Microsoft Graph (Azure PowerShell):**
```
1b730954-1685-4b74-9bfd-dac224a7b894
```

---

### ğŸ”„ **BÆ°á»›c 2: Gá»­i HTTP Request Ä‘á»ƒ láº¥y Access Token**

#### â¤ ThÃªm activity: `HTTP Request` trong UiPath

**Properties cáº§n cáº¥u hÃ¬nh:**

| Thuá»™c tÃ­nh           | GiÃ¡ trá»‹                                                                 |
|-----------------------|-------------------------------------------------------------------------|
| **Endpoint**          | `https://login.microsoftonline.com/common/oauth2/v2.0/token`           |
| **Method**            | `POST`                                                                 |
| **Body Format**       | `application/x-www-form-urlencoded`                                    |
| **Body**              | Xem phÃ­a dÆ°á»›i                                                          |
| **Headers**           | `{ "Content-Type": "application/x-www-form-urlencoded" }`             |
| **Output**            | LÆ°u káº¿t quáº£ JSON vÃ o `tokenResponse` (hoáº·c tÃªn biáº¿n báº¡n Ä‘áº·t)          |

#### ğŸ”½ **Body máº«u**:

```plaintext
grant_type=password&
client_id=1b730954-1685-4b74-9bfd-dac224a7b894&
username=your_email@yourdomain.com&
password=your_password&
scope=https://graph.microsoft.com/.default
```

ğŸ‘‰ LÆ°u Ã½:
- Náº¿u báº¡n muá»‘n dÃ¹ng SharePoint API trá»±c tiáº¿p thay vÃ¬ Graph API, Ä‘á»•i `scope` thÃ nh:
  ```
  scope=https://yourtenant.sharepoint.com/.default
  ```

---

### ğŸ” **BÆ°á»›c 3: Parse access token**

DÃ¹ng activity `Deserialize JSON` Ä‘á»ƒ Ä‘á»c ná»™i dung tá»« `tokenResponse.Content`.

Táº¡o biáº¿n `tokenJson` vÃ  trÃ­ch xuáº¥t:

```vb
accessToken = tokenJson("access_token").ToString
```

---

### ğŸ“¡ **BÆ°á»›c 4: Gá»i API SharePoint hoáº·c Graph**

Táº¡o `HTTP Request` má»›i Ä‘á»ƒ gá»i API báº¡n muá»‘n, vÃ­ dá»¥:

- **Láº¥y danh sÃ¡ch file trong thÆ° má»¥c SharePoint:**
```http
GET https://graph.microsoft.com/v1.0/sites/yourtenant.sharepoint.com:/sites/yoursite:/drive/root/children
```

- **Headers:**
```json
{
  "Authorization": "Bearer " + accessToken,
  "Accept": "application/json"
}
```

---

## ğŸ§  VÃ­ dá»¥ káº¿t quáº£ JSON tá»« token request:

```json
{
  "token_type": "Bearer",
  "expires_in": 3600,
  "access_token": "eyJ0eXAiOiJKV1QiL..."
}
```

---

## ğŸ“‚ BÆ°á»›c tiáº¿p theo báº¡n cÃ³ thá»ƒ lÃ m:

- DÃ¹ng API Ä‘á»ƒ **táº£i file**, **ghi danh sÃ¡ch file vÃ o Excel**, hoáº·c **di chuyá»ƒn file SharePoint**
- MÃ¬nh cÃ³ thá»ƒ giÃºp báº¡n build luá»“ng Ä‘áº§y Ä‘á»§: Láº¥y token â†’ Gá»i API â†’ Ghi Excel â†’ Di chuyá»ƒn file

---

## ğŸ§± MÃ¬nh cÃ³ thá»ƒ dá»±ng máº«u .xaml náº¿u báº¡n cáº§n:

Báº¡n chá»‰ cáº§n cung cáº¥p:
- TÃªn site SharePoint vÃ  thÆ° má»¥c báº¡n muá»‘n xá»­ lÃ½
- Báº¡n muá»‘n thao tÃ¡c gÃ¬ (Ä‘á»c file, di chuyá»ƒn file, lá»c dá»¯ liá»‡uâ€¦)

ğŸ‘‰ MÃ¬nh sáº½ dá»±ng flow máº«u Ä‘áº§y Ä‘á»§ (khÃ´ng cáº§n Azure Portal, khÃ´ng cáº§n quyá»n admin) Ä‘á»ƒ báº¡n cháº¡y ngay.

Báº¡n muá»‘n mÃ¬nh gá»­i máº«u file khÃ´ng?
