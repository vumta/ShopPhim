M√¨nh ƒë√£ c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß n·ªôi dung cho file `Main.xaml` ƒë·ªÉ b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng tr·ª±c ti·∫øp trong UiPath. File n√†y s·∫Ω th·ª±c hi·ªán c√°c b∆∞·ªõc:

1. **L·∫•y Access Token** t·ª´ t√†i kho·∫£n Microsoft c·ªßa b·∫°n
2. **L·∫•y danh s√°ch file** t·ª´ th∆∞ m·ª•c SharePoint
3. **Ghi th√¥ng tin file v√†o Excel**
4. **Di chuy·ªÉn file** sang th∆∞ m·ª•c kh√°c trong SharePoint

---

### üì¶ T·∫£i file `.xaml` ho√†n ch·ªânh

üëâ [T·∫£i SharePoint_File_Processor.zip](sandbox:/mnt/data/SharePoint_File_Processor.zip)

---

## üìò H∆∞·ªõng d·∫´n chi ti·∫øt:

### 1. **Gi·∫£i n√©n v√† m·ªü b·∫±ng UiPath Studio**
- Gi·∫£i n√©n file `.zip` ƒë√£ t·∫£i v·ªÅ v√† m·ªü th∆∞ m·ª•c trong UiPath Studio.

---

### 2. **C·∫•u h√¨nh c√°c bi·∫øn c·∫ßn thi·∫øt**
C·∫≠p nh·∫≠t gi√° tr·ªã c√°c bi·∫øn trong UiPath Studio nh∆∞ sau:

| Bi·∫øn                  | Gi√° tr·ªã m·∫´u                                   |
|-----------------------|-----------------------------------------------|
| `username`            | `abc@contoso.com`                             |
| `password`            | `m·∫≠t kh·∫©u c·ªßa b·∫°n`                             |
| `siteName`            | `TestSite`                                    |
| `sourceFolder`        | `Documents/Reports`                           |
| `targetFolder`        | `Documents/Archived`                          |
| `outputExcelPath`     | `C:\Users\...\Documents\List.xlsx`             |

---

### 3. **Chi ti·∫øt c√°c b∆∞·ªõc trong Flow**

#### **B∆∞·ªõc 1: L·∫•y Access Token**
D√πng HTTP Request ƒë·ªÉ l·∫•y token t·ª´ Microsoft Identity Platform (ROP Authentication).

#### **B∆∞·ªõc 2: L·∫•y danh s√°ch file t·ª´ SharePoint**
- API GET: `https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{siteName}:/drive/root:/{sourceFolder}:/children`
- Ghi th√¥ng tin v√†o m·ªôt DataTable.

#### **B∆∞·ªõc 3: Ghi v√†o Excel**
D√πng `Write Range` ho·∫∑c `Append Range` ƒë·ªÉ ghi danh s√°ch file v√†o Excel.

#### **B∆∞·ªõc 4: Di chuy·ªÉn file**
- D√πng API PATCH ƒë·ªÉ di chuy·ªÉn t·ª´ng file sang th∆∞ m·ª•c m·ªõi tr√™n SharePoint.

---

### 4. **Ch·∫°y v√† ki·ªÉm tra**
- Sau khi c·∫•u h√¨nh, ch·ªâ c·∫ßn ch·∫°y project trong UiPath Studio v√† xem k·∫øt qu·∫£.

---

N·∫øu c√≥ b·∫•t k·ª≥ v·∫•n ƒë·ªÅ n√†o trong qu√° tr√¨nh s·ª≠ d·ª•ng, ƒë·ª´ng ng·∫ßn ng·∫°i h·ªèi l·∫°i nh√©!
====================================================================================
Qu√° t·ªët r·ªìi! D∆∞·ªõi ƒë√¢y l√† t√≥m t·∫Øt c·∫•u h√¨nh ƒë·ªÉ m√¨nh d·ª±ng `.xaml` cho b·∫°n:

| Th√¥ng tin                                  | Gi√° tr·ªã thi·∫øt l·∫≠p                             |
|--------------------------------------------|-----------------------------------------------|
| ‚úÖ SharePoint domain                        | `contoso.sharepoint.com`                      |
| ‚úÖ Site name                                | `TestSite`                                    |
| ‚úÖ Th∆∞ m·ª•c ngu·ªìn                            | `Documents/Reports`                           |
| ‚úÖ Email ƒëƒÉng nh·∫≠p                          | `abc@contoso.com`                             |
| ‚úÖ X√°c th·ª±c 2 b∆∞·ªõc (MFA)                    | ‚ùå Kh√¥ng                                      |
| ‚úÖ T·∫£i file v·ªÅ m√°y                          | ‚ùå Kh√¥ng                                      |
| ‚úÖ Di chuy·ªÉn file sang th∆∞ m·ª•c kh√°c         | ‚úÖ C√≥                                         |
| ‚úÖ ƒê∆∞·ªùng d·∫´n Excel ghi danh s√°ch            | `C:\Users\...\Documents\List.xlsx` (s·∫Ω ƒë·ªÉ dynamic trong flow) |

---

## üì¶ `.xaml` Flow g·ªìm c√°c b∆∞·ªõc sau:

1. üîê L·∫•y Access Token b·∫±ng ROPC (username/password)
2. üìÇ L·∫•y danh s√°ch file t·ª´ `Documents/Reports`
3. üìã Ghi danh s√°ch v√†o Excel (`Name`, `URL`, `Modified Date`)
4. üöö Di chuy·ªÉn t·ª´ng file sang th∆∞ m·ª•c m·ªõi (`Documents/Archived` ‚Äì b·∫°n c√≥ th·ªÉ ƒë·ªïi sau)

---

‚è≥ M√¨nh s·∫Ω d·ª±ng file `.xaml` trong v√†i ph√∫t t·ªõi.  
Khi xong, m√¨nh s·∫Ω g·ª≠i b·∫°n k√®m h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng chi ti·∫øt.

üëâ Trong l√∫c ch·ªù, b·∫°n c√≥ mu·ªën ƒë·∫∑t t√™n th∆∞ m·ª•c ƒë√≠ch cho file di chuy·ªÉn kh√¥ng? (m·∫∑c ƒë·ªãnh l√† `Archived`)
=
==========================================
R·∫•t t·ªët! M√¨nh s·∫Ω h∆∞·ªõng d·∫´n b·∫°n **d√πng Microsoft Graph API ƒë·ªÉ thao t√°c v·ªõi file tr√™n SharePoint**, g·ªìm:

1. üîç L·∫•y danh s√°ch file trong th∆∞ m·ª•c
2. üì• T·∫£i file v·ªÅ m√°y
3. üìã Ghi danh s√°ch file v√†o Excel
4. üöö Di chuy·ªÉn file t·ª´ th∆∞ m·ª•c n√†y sang th∆∞ m·ª•c kh√°c

T·∫•t c·∫£ ƒë·ªÅu ch·∫°y ƒë∆∞·ª£c trong **UiPath** d√πng access token ƒë√£ l·∫•y b·∫±ng t√†i kho·∫£n ng∆∞·ªùi d√πng.

---

## ü™ú 1. L·∫•y danh s√°ch file trong th∆∞ m·ª•c SharePoint

### ‚û§ API URL:

```http
GET https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/root:/{folderPath}:/children
```

üìå V√≠ d·ª•:

```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com:/sites/TestSite:/drive/root:/Documents/Reports:/children
```

### ‚û§ Header:
```json
Authorization: Bearer {access_token}
```

---

## üìù 2. Ghi danh s√°ch file v√†o Excel

- Parse JSON tr·∫£ v·ªÅ t·ª´ b∆∞·ªõc tr√™n ‚Üí duy·ªát m·∫£ng `value[]`
- L·∫•y th√¥ng tin:
  - `name`
  - `lastModifiedDateTime`
  - `webUrl`
- Ghi t·ª´ng d√≤ng v√†o Excel b·∫±ng `Write Range` ho·∫∑c `Append Range`

---

## üíæ 3. T·∫£i file v·ªÅ m√°y

### ‚û§ API URL:

```http
GET https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/root:/{folderPath}/{fileName}:/content
```

üìå V√≠ d·ª•:

```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com:/sites/TestSite:/drive/root:/Documents/Reports/Report1.xlsx:/content
```

- K·∫øt qu·∫£ tr·∫£ v·ªÅ l√† **file binary**
- D√πng `HTTP Request` ‚Üí ch·ªçn **Download Resource**
- L∆∞u th√†nh file `.xlsx` ho·∫∑c ƒë√∫ng ƒë·ªãnh d·∫°ng g·ªëc

---

## üöö 4. Di chuy·ªÉn file t·ª´ th∆∞ m·ª•c A ‚Üí B

### ‚û§ API URL:

```http
PATCH https://graph.microsoft.com/v1.0/sites/{domain}.sharepoint.com:/sites/{SiteName}:/drive/items/{fileId}
```

üìå Body (JSON):

```json
{
  "parentReference": {
    "path": "/drive/root:/Documents/NewFolder"
  },
  "name": "Report1.xlsx"
}
```

- **fileId** l·∫•y ƒë∆∞·ª£c t·ª´ k·∫øt qu·∫£ `children` (·ªü b∆∞·ªõc 1)
- C√≥ th·ªÉ ƒë·ªïi t√™n file b·∫±ng c√°ch ch·ªânh `"name"`

---

## ‚úÖ B·∫°n c·∫ßn g√¨ ƒë·ªÉ m√¨nh h·ªó tr·ª£ ti·∫øp?

1. B·∫°n ƒëang thao t√°c v·ªõi **site n√†o** tr√™n SharePoint?
2. Mu·ªën l√†m t·∫•t c·∫£ c√°c b∆∞·ªõc hay ch·ªâ m·ªôt ph·∫ßn (v√≠ d·ª• ch·ªâ l·∫•y danh s√°ch ho·∫∑c ch·ªâ t·∫£i file)?
3. B·∫°n mu·ªën m√¨nh **d·ª±ng s·∫µn file `.xaml` m·∫´u** cho b·∫°n d√πng kh√¥ng?

Ch·ªâ c·∫ßn b·∫°n tr·∫£ l·ªùi v√†i d√≤ng, m√¨nh s·∫Ω l√†m m·∫´u c·ª• th·ªÉ ƒë·ªÉ b·∫°n d√πng ƒë∆∞·ª£c ngay trong UiPath lu√¥n, kh√¥ng c·∫ßn lo ph·∫ßn API n·ªØa.
================
Tuy·ªát v·ªùi! D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n **step-by-step c√°ch l·∫•y Access Token t·ª´ UiPath b·∫±ng t√†i kho·∫£n ng∆∞·ªùi d√πng (Resource Owner Password Credential - ROPC Flow)** ƒë·ªÉ truy c·∫≠p **SharePoint Online ho·∫∑c Microsoft Graph API**.

---

## üéØ M·ª•c ti√™u:
- L·∫•y **Access Token** t·ª´ UiPath b·∫±ng t√™n ƒëƒÉng nh·∫≠p + m·∫≠t kh·∫©u t√†i kho·∫£n Microsoft 365.
- D√πng token n√†y ƒë·ªÉ g·ªçi API (vd: ƒë·ªçc file SharePoint, l·∫•y danh s√°ch th∆∞ m·ª•c...).

---

## ‚ö†Ô∏è Y√™u c·∫ßu:

| ƒêi·ªÅu ki·ªán                                    | Tr·∫°ng th√°i |
|---------------------------------------------|------------|
| ‚úÖ T√†i kho·∫£n Microsoft 365 t·ªï ch·ª©c           | C·∫ßn thi·∫øt  |
| ‚ö†Ô∏è Kh√¥ng b·∫≠t MFA (x√°c th·ª±c 2 y·∫øu t·ªë)         | B·∫Øt bu·ªôc   |
| ‚úÖ T√†i kho·∫£n c√≥ quy·ªÅn truy c·∫≠p SharePoint    | C·∫ßn thi·∫øt  |

---

## ü™ú Step-by-step trong UiPath:

---

### üîß **B∆∞·ªõc 1: Chu·∫©n b·ªã th√¥ng tin**
B·∫°n c·∫ßn:

- `Username`: Email ƒëƒÉng nh·∫≠p (VD: `abc@contoso.com`)
- `Password`: M·∫≠t kh·∫©u t√†i kho·∫£n
- `Client ID`: S·ª≠ d·ª•ng client m·∫∑c ƒë·ªãnh c·ªßa Microsoft (ho·∫∑c t·∫°o ri√™ng n·∫øu ƒë∆∞·ª£c)

> **Client ID m·∫∑c ƒë·ªãnh c·ªßa Microsoft Graph (Azure PowerShell):**
```
1b730954-1685-4b74-9bfd-dac224a7b894
```

---

### üîÑ **B∆∞·ªõc 2: G·ª≠i HTTP Request ƒë·ªÉ l·∫•y Access Token**

#### ‚û§ Th√™m activity: `HTTP Request` trong UiPath

**Properties c·∫ßn c·∫•u h√¨nh:**

| Thu·ªôc t√≠nh           | Gi√° tr·ªã                                                                 |
|-----------------------|-------------------------------------------------------------------------|
| **Endpoint**          | `https://login.microsoftonline.com/common/oauth2/v2.0/token`           |
| **Method**            | `POST`                                                                 |
| **Body Format**       | `application/x-www-form-urlencoded`                                    |
| **Body**              | Xem ph√≠a d∆∞·ªõi                                                          |
| **Headers**           | `{ "Content-Type": "application/x-www-form-urlencoded" }`             |
| **Output**            | L∆∞u k·∫øt qu·∫£ JSON v√†o `tokenResponse` (ho·∫∑c t√™n bi·∫øn b·∫°n ƒë·∫∑t)          |

#### üîΩ **Body m·∫´u**:

```plaintext
grant_type=password&
client_id=1b730954-1685-4b74-9bfd-dac224a7b894&
username=your_email@yourdomain.com&
password=your_password&
scope=https://graph.microsoft.com/.default
```

üëâ L∆∞u √Ω:
- N·∫øu b·∫°n mu·ªën d√πng SharePoint API tr·ª±c ti·∫øp thay v√¨ Graph API, ƒë·ªïi `scope` th√†nh:
  ```
  scope=https://yourtenant.sharepoint.com/.default
  ```

---

### üîç **B∆∞·ªõc 3: Parse access token**

D√πng activity `Deserialize JSON` ƒë·ªÉ ƒë·ªçc n·ªôi dung t·ª´ `tokenResponse.Content`.

T·∫°o bi·∫øn `tokenJson` v√† tr√≠ch xu·∫•t:

```vb
accessToken = tokenJson("access_token").ToString
```

---

### üì° **B∆∞·ªõc 4: G·ªçi API SharePoint ho·∫∑c Graph**

T·∫°o `HTTP Request` m·ªõi ƒë·ªÉ g·ªçi API b·∫°n mu·ªën, v√≠ d·ª•:

- **L·∫•y danh s√°ch file trong th∆∞ m·ª•c SharePoint:**
```http
GET https://graph.microsoft.com/v1.0/sites/yourtenant.sharepoint.com:/sites/yoursite:/drive/root/children
```

- **Headers:**
```json
{
  "Authorization": "Bearer " + accessToken,
  "Accept": "application/json"
}
```

---

## üß† V√≠ d·ª• k·∫øt qu·∫£ JSON t·ª´ token request:

```json
{
  "token_type": "Bearer",
  "expires_in": 3600,
  "access_token": "eyJ0eXAiOiJKV1QiL..."
}
```

---

## üìÇ B∆∞·ªõc ti·∫øp theo b·∫°n c√≥ th·ªÉ l√†m:

- D√πng API ƒë·ªÉ **t·∫£i file**, **ghi danh s√°ch file v√†o Excel**, ho·∫∑c **di chuy·ªÉn file SharePoint**
- M√¨nh c√≥ th·ªÉ gi√∫p b·∫°n build lu·ªìng ƒë·∫ßy ƒë·ªß: L·∫•y token ‚Üí G·ªçi API ‚Üí Ghi Excel ‚Üí Di chuy·ªÉn file

---

## üß± M√¨nh c√≥ th·ªÉ d·ª±ng m·∫´u .xaml n·∫øu b·∫°n c·∫ßn:

B·∫°n ch·ªâ c·∫ßn cung c·∫•p:
- T√™n site SharePoint v√† th∆∞ m·ª•c b·∫°n mu·ªën x·ª≠ l√Ω
- B·∫°n mu·ªën thao t√°c g√¨ (ƒë·ªçc file, di chuy·ªÉn file, l·ªçc d·ªØ li·ªáu‚Ä¶)

üëâ M√¨nh s·∫Ω d·ª±ng flow m·∫´u ƒë·∫ßy ƒë·ªß (kh√¥ng c·∫ßn Azure Portal, kh√¥ng c·∫ßn quy·ªÅn admin) ƒë·ªÉ b·∫°n ch·∫°y ngay.

B·∫°n mu·ªën m√¨nh g·ª≠i m·∫´u file kh√¥ng?
