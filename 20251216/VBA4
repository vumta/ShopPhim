Ch√†o b·∫°n,
T√¥i ƒë√£ th√™m m·ªôt Function m·ªõi c√≥ t√™n l√† FillDefaultValue v√†o Module VBA. Function n√†y s·∫Ω nh·∫≠n tham s·ªë t∆∞∆°ng t·ª± nh∆∞ ColumnMapping ƒë·ªÉ ƒëi·ªÅn gi√° tr·ªã m·∫∑c ƒë·ªãnh v√†o c√°c c·ªôt ƒë√£ ch·ªâ ƒë·ªãnh trong file ƒë√≠ch.
T√¥i c≈©ng s·∫Ω h∆∞·ªõng d·∫´n c√°ch b·∫°n c√≥ th·ªÉ g·ªçi c·∫£ hai Function n√†y tu·∫ßn t·ª± t·ª´ Power Automate Desktop (PAD).
üíª Code VBA Ho√†n Ch·ªânh
üìÑ 1. Function CopyDataByColumnName (Gi·ªØ nguy√™n)
(S·ª≠ d·ª•ng phi√™n b·∫£n ƒë√£ s·ª≠a l·ªói lCol t·ª´ l·∫ßn tr∆∞·ªõc)
üìÑ 2. Function M·ªõi: FillDefaultValue
Function n√†y s·∫Ω m·ªü file ƒë√≠ch v√† ƒëi·ªÅn gi√° tr·ªã m·∫∑c ƒë·ªãnh cho c√°c c·ªôt ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh, √°p d·ª•ng cho t·∫•t c·∫£ c√°c h√†ng c√≥ d·ªØ li·ªáu (t√≠nh ƒë·∫øn h√†ng cu·ªëi c√πng c√≥ d·ªØ li·ªáu trong file).
' ---------------------------------------------------------------------------------
' NEW FUNCTION: Fill Default Values
' ---------------------------------------------------------------------------------

' Function to fill a specific default value into designated columns 
' in the destination workbook.
' Parameters:
' - DestinationPath: Full path to the destination Excel file.
' - DefaultMapping: String in the format "ColIndex1,DefaultValue1;ColIndex2,DefaultValue2;..."
Public Function FillDefaultValue(ByVal DestinationPath As String, _
                                 ByVal DefaultMapping As String) As String

    Dim wbDest As Workbook
    Dim wsDest As Worksheet
    Dim arrMapping As Variant
    Dim arrPair As Variant
    Dim lDestIndex As Long
    Dim vDefaultValue As Variant
    Dim lLastRow As Long
    Dim lHeaderRow As Long
    Dim i As Long

    FillDefaultValue = "Success" ' Initialize return value

    On Error GoTo ErrorHandler

    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    ' --- 1. Open Destination Workbook ---
    Set wbDest = Workbooks.Open(DestinationPath)
    
    ' Assume data is on Sheet 1 (Modify if needed)
    Set wsDest = wbDest.Sheets(1)
    
    ' Assume Header row is 1
    lHeaderRow = 1 

    ' Determine the overall last row that contains data across all used cells
    lLastRow = wsDest.Cells.Find(What:="*", After:=wsDest.Range("A1"), LookIn:=xlValues, LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlPrevious).Row
    
    ' If there's no data beyond the header, stop
    If lLastRow <= lHeaderRow Then
        FillDefaultValue = "Success (No data rows found to fill)"
        GoTo Finalize
    End If

    ' --- 2. Process Default Mapping ---
    ' Split the mapping string by semicolon (;)
    arrMapping = Split(DefaultMapping, ";")

    ' --- 3. Fill Default Values ---
    For i = LBound(arrMapping) To UBound(arrMapping)
        If Trim(arrMapping(i)) <> "" Then
            ' Split each pair by comma (,)
            arrPair = Split(arrMapping(i), ",")
            
            If UBound(arrPair) = 1 Then
                ' Destination Column Index
                On Error Resume Next
                lDestIndex = CLng(Trim(arrPair(0)))
                On Error GoTo ErrorHandler ' Reset Error Handler
                
                ' Default Value
                vDefaultValue = Trim(arrPair(1))
                
                If lDestIndex > 0 Then
                    ' Define the range to fill (from row below header to last row)
                    ' Fill the entire block with the default value
                    wsDest.Range(wsDest.Cells(lHeaderRow + 1, lDestIndex), wsDest.Cells(lLastRow, lDestIndex)).Value = vDefaultValue
                End If
            End If
        End If
    Next

    ' --- 4. Save and Close ---
    wbDest.Save

Finalize:
    wbDest.Close SaveChanges:=False
    
    ' --- 5. Cleanup ---
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    Exit Function

ErrorHandler:
    ' Handle runtime errors
    Dim sErrorLog As String
    sErrorLog = "Runtime Error: " & Err.Description & " (" & Err.Number & ") on line " & Erl & ". "
    FillDefaultValue = "Fatal Error in FillDefaultValue: " & sErrorLog
    
    ' Ensure settings are reset even on error
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    
    ' Close open workbook (attempt gracefully)
    On Error Resume Next
    If Not wbDest Is Nothing Then wbDest.Close SaveChanges:=False

End Function

üìã Gi·∫£i th√≠ch v·ªÅ Tham s·ªë DefaultMapping
Tham s·ªë n√†y ƒë∆∞·ª£c truy·ªÅn v√†o Function FillDefaultValue.
 * ƒê·ªãnh d·∫°ng: "Index C·ªôt ƒê√≠ch 1,Gi√° Tr·ªã M·∫∑c ƒê·ªãnh 1;Index C·ªôt ƒê√≠ch 2,Gi√° Tr·ªã M·∫∑c ƒê·ªãnh 2;..."
 * V√≠ d·ª•: ƒê·ªÉ ƒëi·ªÅn gi√° tr·ªã "Pending" v√†o C·ªôt 8 v√† gi√° tr·ªã 2025 v√†o C·ªôt 9, b·∫°n s·∫Ω truy·ªÅn chu·ªói: "8,Pending;9,2025"
‚öôÔ∏è G·ªçi Tu·∫ßn t·ª± 2 Function trong Power Automate Desktop (PAD)
Trong PAD, b·∫°n s·∫Ω c·∫ßn 4 b∆∞·ªõc ch√≠nh:
B∆∞·ªõc 1: Khai b√°o Bi·∫øn (Set Variables)
T·∫°o c√°c bi·∫øn ƒë·ªÉ s·ª≠ d·ª•ng cho c·∫£ hai Function:
| Bi·∫øn PAD | Gi√° tr·ªã V√≠ d·ª• | M·ª•c ƒë√≠ch |
|---|---|---|
| %SourcePath% | C:\Data\Source.xlsx | File ngu·ªìn |
| %DestPath% | C:\Data\Destination.xlsx | File ƒë√≠ch |
| %CopyMapping% | "Product Name,1;Price,3" | √Ånh x·∫° cho CopyDataByColumnName |
| %DefaultMapping% | "8,Pending;9,2025" | √Ånh x·∫° cho FillDefaultValue |
B∆∞·ªõc 2: Ch·∫°y Function Copy Data
| Action | C·∫•u h√¨nh |
|---|---|
| Launch Excel | M·ªü %DestPath% (ho·∫∑c file ch·ª©a macro) |
| Run Excel macro | Macro name: CopyDataByColumnName |
|  | Arguments: %SourcePath%, %DestPath%, %CopyMapping% |
|  | Macro result: %CopyResult% |
| Close Excel | Kh√¥ng l∆∞u (v√¨ macro ƒë√£ t·ª± l∆∞u) |
B∆∞·ªõc 3: Ki·ªÉm tra v√† Ch·∫°y Function Fill Default Value
B·∫°n c·∫ßn ki·ªÉm tra k·∫øt qu·∫£ Copy tr∆∞·ªõc khi ch·∫°y Fill.
IF %CopyResult% CONTAINS 'Success'
    ' --- T√ÅI KH·ªûI CH·∫†Y EXCEL ƒê·ªÇ CH·∫†Y FUNCTION TH·ª® HAI ---
    
    ' 1. Launch Excel
    '    Document path: %DestPath%
    '    Variables produced: %ExcelInstance2% 

    ' 2. Run Excel macro
    '    Excel instance: %ExcelInstance2%
    '    Macro name: FillDefaultValue
    '    Arguments: %DestPath%, %DefaultMapping%
    '    Macro result: %FillResult%
    
    ' 3. Close Excel
    '    Excel instance: %ExcelInstance2%

    ' 4. Ki·ªÉm tra k·∫øt qu·∫£ Fill
    IF %FillResult% CONTAINS 'Success'
        LOG MESSAGE "Ho√†n th√†nh c·∫£ Copy v√† Fill Default."
    ELSE
        LOG MESSAGE "L·ªói khi ƒëi·ªÅn gi√° tr·ªã m·∫∑c ƒë·ªãnh: %FillResult%"
    END
ELSE
    LOG MESSAGE "L·ªñI: Copy Data th·∫•t b·∫°i: %CopyResult%"
END

L∆∞u √Ω quan tr·ªçng: M·ªói l·∫ßn b·∫°n g·ªçi m·ªôt Macro m√† thao t√°c v·ªõi File Excel (nh∆∞ CopyDataByColumnName v√† FillDefaultValue c·ªßa ch√∫ng ta), b·∫°n n√™n m·ªü v√† ƒë√≥ng file Excel trong PAD cho m·ªói l·∫ßn g·ªçi ƒë·ªÉ ƒë·∫£m b·∫£o Excel ƒë∆∞·ª£c gi·∫£i ph√≥ng t√†i nguy√™n gi·ªØa c√°c l·∫ßn th·ª±c thi, ƒë·∫∑c bi·ªát khi c√°c Function n√†y t·ª± m·ªü/ƒë√≥ng/l∆∞u file.
B·∫°n c√≥ mu·ªën t√¥i gi√∫p b·∫°n x√°c nh·∫≠n chu·ªói √°nh x·∫° cho tr∆∞·ªùng h·ª£p c·ª• th·ªÉ c·ªßa b·∫°n kh√¥ng?
