ChÃ o báº¡n,
ÄÃ¢y lÃ  pháº§n code VBA vÃ  hÆ°á»›ng dáº«n cÃ¡ch báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n yÃªu cáº§u cá»§a mÃ¬nh, cÃ¹ng vá»›i hÆ°á»›ng dáº«n Ä‘á»ƒ cháº¡y macro nÃ y tá»« Power Automate Desktop (PAD).
ğŸ’» Code VBA: Copy Data Giá»¯a CÃ¡c File Excel
Macro nÃ y nháº­n 3 Ä‘á»‘i sá»‘:
 * SourcePath: ÄÆ°á»ng dáº«n Ä‘áº§y Ä‘á»§ Ä‘áº¿n file Excel nguá»“n.
 * DestinationPath: ÄÆ°á»ng dáº«n Ä‘áº§y Ä‘á»§ Ä‘áº¿n file Excel Ä‘Ã­ch.
 * ColumnMapping: Má»™t chuá»—i chá»©a Ã¡nh xáº¡ cá»™t, Ä‘á»‹nh dáº¡ng lÃ  "TÃªn Cá»™t Nguá»“n 1,Index Cá»™t ÄÃ­ch 1;TÃªn Cá»™t Nguá»“n 2,Index Cá»™t ÄÃ­ch 2;...".
ğŸ“„ Code VBA (Sá»­ dá»¥ng trong file Macro hoáº·c file Ä‘Ã­ch)
Option Explicit

' Macro Ä‘á»ƒ copy dá»¯ liá»‡u tá»« cá»™t cÃ³ tÃªn cá»¥ thá»ƒ trong file nguá»“n
' sang cá»™t cÃ³ chá»‰ sá»‘ (index) cá»¥ thá»ƒ trong file Ä‘Ã­ch.
' Macro nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cháº¡y tá»« Power Automate Desktop (PAD)
' hoáº·c báº±ng tay, truyá»n cÃ¡c tham sá»‘ dÆ°á»›i dáº¡ng chuá»—i.

Sub CopyDataByColumnName(ByVal SourcePath As String, _
                         ByVal DestinationPath As String, _
                         ByVal ColumnMapping As String)

    Dim wbSource As Workbook
    Dim wbDest As Workbook
    Dim wsSource As Worksheet
    Dim wsDest As Worksheet
    Dim arrMapping As Variant
    Dim arrPair As Variant
    Dim sSourceName As String
    Dim lDestIndex As Long
    Dim lSourceCol As Long
    Dim lLastRow As Long
    Dim lRow As Long
    Dim lHeaderRow As Long
    Dim i As Long

    On Error GoTo ErrorHandler

    ' --- 1. Má»Ÿ cÃ¡c Workbook ---
    ' Táº¯t thÃ´ng bÃ¡o lá»—i vÃ  cáº­p nháº­t mÃ n hÃ¬nh Ä‘á»ƒ tá»‘i Æ°u tá»‘c Ä‘á»™
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    Set wbSource = Workbooks.Open(SourcePath)
    Set wbDest = Workbooks.Open(DestinationPath)

    ' Giáº£ sá»­ dá»¯ liá»‡u náº±m á»Ÿ Sheet 1 (thay Ä‘á»•i náº¿u cáº§n)
    Set wsSource = wbSource.Sheets(1)
    Set wsDest = wbDest.Sheets(1)
    
    ' Giáº£ sá»­ hÃ ng tiÃªu Ä‘á» (Header) lÃ  hÃ ng Ä‘áº§u tiÃªn (thay Ä‘á»•i náº¿u cáº§n)
    lHeaderRow = 1 

    ' --- 2. Xá»­ lÃ½ Column Mapping ---
    arrMapping = Split(ColumnMapping, ";")

    ' --- 3. Báº¯t Ä‘áº§u Copy/Paste ---
    For i = LBound(arrMapping) To UBound(arrMapping)
        If Trim(arrMapping(i)) <> "" Then
            arrPair = Split(arrMapping(i), ",")
            
            ' Äáº£m báº£o cÃ³ Ä‘á»§ 2 pháº§n tá»­ (TÃªn cá»™t nguá»“n vÃ  Index cá»™t Ä‘Ã­ch)
            If UBound(arrPair) = 1 Then
                sSourceName = Trim(arrPair(0))
                
                ' Chuyá»ƒn Index Cá»™t ÄÃ­ch thÃ nh sá»‘ nguyÃªn
                On Error Resume Next
                lDestIndex = CLng(Trim(arrPair(1)))
                On Error GoTo ErrorHandler ' Reset Error Handler

                ' --- TÃ¬m cá»™t nguá»“n theo TÃªn ---
                lSourceCol = 0 ' Reset cá»™t nguá»“n
                For lCol = 1 To wsSource.Cells(lHeaderRow, Columns.Count).End(xlToLeft).Column
                    If StrComp(Trim(wsSource.Cells(lHeaderRow, lCol).Value), sSourceName, vbTextCompare) = 0 Then
                        lSourceCol = lCol
                        Exit For
                    End If
                Next lCol

                If lSourceCol > 0 And lDestIndex > 0 Then
                    ' --- XÃ¡c Ä‘á»‹nh hÃ ng cuá»‘i cÃ¹ng cÃ³ dá»¯ liá»‡u trong cá»™t nguá»“n ---
                    ' Báº¯t Ä‘áº§u tÃ¬m tá»« hÃ ng dÆ°á»›i Header
                    lLastRow = wsSource.Cells(Rows.Count, lSourceCol).End(xlUp).Row
                    If lLastRow < lHeaderRow + 1 Then
                        ' KhÃ´ng cÃ³ dá»¯ liá»‡u, chuyá»ƒn sang cáº·p cá»™t tiáº¿p theo
                        GoTo NextMapping
                    End If
                    
                    ' --- Copy dá»¯ liá»‡u (loáº¡i bá» hÃ ng tiÃªu Ä‘á») ---
                    ' Pháº¡m vi nguá»“n: Tá»« Ã´ Ä‘áº§u tiÃªn dÆ°á»›i Header Ä‘áº¿n hÃ ng cuá»‘i cÃ¹ng
                    ' Pháº¡m vi Ä‘Ã­ch: Báº¯t Ä‘áº§u tá»« Ã´ Ä‘áº§u tiÃªn dÆ°á»›i Header
                    
                    ' Copy GiÃ¡ trá»‹
                    wsDest.Range(wsDest.Cells(lHeaderRow + 1, lDestIndex), wsDest.Cells(lLastRow, lDestIndex)).Value = _
                    wsSource.Range(wsSource.Cells(lHeaderRow + 1, lSourceCol), wsSource.Cells(lLastRow, lSourceCol)).Value

                ElseIf lSourceCol = 0 Then
                    ' CÃ³ thá»ƒ thÃªm cÆ¡ cháº¿ ghi log náº¿u khÃ´ng tÃ¬m tháº¥y cá»™t nguá»“n
                    Debug.Print "Lá»—i: KhÃ´ng tÃ¬m tháº¥y cá»™t nguá»“n: " & sSourceName
                ElseIf lDestIndex = 0 Then
                     ' CÃ³ thá»ƒ thÃªm cÆ¡ cháº¿ ghi log náº¿u index cá»™t Ä‘Ã­ch khÃ´ng há»£p lá»‡
                    Debug.Print "Lá»—i: Index cá»™t Ä‘Ã­ch khÃ´ng há»£p lá»‡ cho: " & sSourceName
                End If
            End If
NextMapping:
        End If
    Next i

    ' --- 4. LÆ°u vÃ  ÄÃ³ng ---
    wbDest.Save
    wbSource.Close SaveChanges:=False
    wbDest.Close SaveChanges:=False

    ' --- 5. Dá»n dáº¹p ---
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    Exit Sub

ErrorHandler:
    ' Xá»­ lÃ½ lá»—i
    MsgBox "ÄÃ£ xáº£y ra lá»—i: " & Err.Description, vbCritical
    
    ' Äáº£m báº£o cÃ¡c thiáº¿t láº­p Ä‘Æ°á»£c reset ngay cáº£ khi lá»—i
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    
    ' ÄÃ³ng workbook Ä‘ang má»Ÿ Ä‘á»ƒ trÃ¡nh treo file (chá»‰ Ä‘Ã³ng náº¿u Ä‘Ã£ má»Ÿ)
    On Error Resume Next
    If Not wbSource Is Nothing Then wbSource.Close SaveChanges:=False
    If Not wbDest Is Nothing Then wbDest.Close SaveChanges:=False

End Sub

' VÃ­ dá»¥ vá» cÃ¡ch gá»i macro:
' Sub TestCopy()
'     CopyDataByColumnName "C:\Data\SourceFile.xlsx", _
'                          "C:\Data\DestinationFile.xlsx", _
'                          "TÃªn Sáº£n Pháº©m,1;GiÃ¡ BÃ¡n,3;MÃ£ Sá»‘,5"
' End Sub

ğŸ“‹ Giáº£i thÃ­ch vá» Tham sá»‘ ColumnMapping
Tham sá»‘ nÃ y lÃ  chÃ¬a khÃ³a Ä‘á»ƒ macro hoáº¡t Ä‘á»™ng linh hoáº¡t.
 * NÃ³ lÃ  má»™t chuá»—i duy nháº¥t.
 * CÃ¡c cáº·p Ã¡nh xáº¡ Ä‘Æ°á»£c phÃ¢n tÃ¡ch báº±ng dáº¥u cháº¥m pháº©y (;).
 * Trong má»—i cáº·p, TÃªn Cá»™t Nguá»“n vÃ  Index Cá»™t ÄÃ­ch Ä‘Æ°á»£c phÃ¢n tÃ¡ch báº±ng dáº¥u pháº©y (,).
| Pháº§n Tá»­ | MÃ´ Táº£ | VÃ­ dá»¥ |
|---|---|---|
| TÃªn Cá»™t Nguá»“n | TÃªn chÃ­nh xÃ¡c cá»§a tiÃªu Ä‘á» cá»™t trong file nguá»“n. | TÃªn Sáº£n Pháº©m |
| Index Cá»™t ÄÃ­ch | Sá»‘ thá»© tá»± cá»™t (1 cho A, 2 cho B,...) trong file Ä‘Ã­ch. | 1 |
| VÃ­ dá»¥ Chuá»—i HoÃ n Chá»‰nh |  | "TÃªn Sáº£n Pháº©m,1;GiÃ¡ BÃ¡n,3;MÃ£ Sá»‘,5" |
âš™ï¸ Cháº¡y VBA Macro tá»« Power Automate Desktop (PAD)
Báº¡n sáº½ sá»­ dá»¥ng hÃ nh Ä‘á»™ng "Run Excel macro" trong Power Automate Desktop.
1. Chuáº©n bá»‹ File Macro
 * LÆ°u Ä‘oáº¡n code VBA trÃªn vÃ o má»™t Module trong má»™t file Excel (vÃ­ dá»¥: MacroRunner.xlsm).
 * Hoáº·c Tá»‘t nháº¥t lÃ  báº¡n cÃ³ thá»ƒ Ä‘á»ƒ code VBA nÃ y trong file Excel Ä‘Ã­ch (DestinationFile.xlsx).
2. Thiáº¿t láº­p trong Power Automate Desktop
Sá»­ dá»¥ng chuá»—i hÃ nh Ä‘á»™ng sau:
1. Má»Ÿ file Excel cÃ³ chá»©a Macro
 * Action: Launch Excel (Khá»Ÿi cháº¡y Excel)
 * Parameters:
   * Launch mode: Open the following document (Má»Ÿ tÃ i liá»‡u sau)
   * Document path: ÄÆ°á»ng dáº«n Ä‘áº¿n file chá»©a code VBA (vÃ­ dá»¥: DestinationFile.xlsx).
   * Variables produced: %ExcelInstance%
2. Cháº¡y Macro
 * Action: Run Excel macro (Cháº¡y Macro Excel)
 * Parameters:
   * Excel instance: %ExcelInstance% (GiÃ¡ trá»‹ tá»« bÆ°á»›c 1)
   * Macro name: CopyDataByColumnName (TÃªn Sub)
   * Macro arguments (CÃ¡c tham sá»‘):
     * Argument 1 (SourcePath): %SourceFilePath% (Táº¡o biáº¿n nÃ y trÆ°á»›c Ä‘Ã³)
       * VÃ­ dá»¥: C:\Data\SourceFile.xlsx
     * Argument 2 (DestinationPath): %DestinationFilePath% (Táº¡o biáº¿n nÃ y trÆ°á»›c Ä‘Ã³)
       * VÃ­ dá»¥: C:\Data\DestinationFile.xlsx
     * Argument 3 (ColumnMapping): %MappingString% (Táº¡o biáº¿n nÃ y trÆ°á»›c Ä‘Ã³)
       * VÃ­ dá»¥: "TÃªn Sáº£n Pháº©m,1;GiÃ¡ BÃ¡n,3;MÃ£ Sá»‘,5"
3. ÄÃ³ng Excel
 * Action: Close Excel (ÄÃ³ng Excel)
 * Parameters:
   * Excel instance: %ExcelInstance%
   * Before closing: Do not save document (VÃ¬ macro Ä‘Ã£ tá»± lÆ°u)
Báº¡n cÃ³ muá»‘n tÃ´i mÃ´ phá»ng hoáº·c viáº¿t má»™t Ä‘oáº¡n Power Automate Desktop Flow (báº±ng pseudo-code) Ä‘á»ƒ lÃ m rÃµ hÆ¡n cÃ¡ch truyá»n biáº¿n khÃ´ng?
