Ch√†o b·∫°n,
Y√™u c·∫ßu n√†y c·ªßa b·∫°n kh√¥ng ch·ªâ ƒë∆°n thu·∫ßn l√† Format (thay ƒë·ªïi c√°ch hi·ªÉn th·ªã) m√† l√† Transformation (thay ƒë·ªïi gi√° tr·ªã d·ªØ li·ªáu th·ª±c t·∫ø).
 * C·ªôt K, L, M (Format '005): B·∫°n mu·ªën chuy·ªÉn s·ªë 5 th√†nh chu·ªói k√Ω t·ª± "005". Trong Excel, n·∫øu ch·ªâ Format 000 th√¨ n√≥ v·∫´n l√† s·ªë. ƒê·ªÉ th√†nh Text '005, ta c·∫ßn ƒë·ªïi ƒë·ªãnh d·∫°ng √¥ th√†nh Text v√† d√πng h√†m format l·∫°i gi√° tr·ªã.
 * C·ªôt N (2025 -> 5): ƒê√¢y l√† x·ª≠ l√Ω logic l·∫•y k√Ω t·ª± cu·ªëi c√πng. Format th√¥ng th∆∞·ªùng kh√¥ng l√†m ƒë∆∞·ª£c vi·ªác n√†y (Format y trong Excel ra 2 s·ªë cu·ªëi ho·∫∑c ng√†y trong nƒÉm, kh√¥ng ra 1 s·ªë cu·ªëi).
V√¨ v·∫≠y, t√¥i vi·∫øt th√™m m·ªôt Function m·ªõi l√† TransformColumnData. Function n√†y m·∫°nh m·∫Ω h∆°n, cho ph√©p x·ª≠ l√Ω logic d·ªØ li·ªáu.
1. üìÑ Function VBA M·ªõi: TransformColumnData
B·∫°n copy Function n√†y d√°n v√†o Module c√πng v·ªõi c√°c Function tr∆∞·ªõc ƒë√≥.
Logic h·ªó tr·ª£:
 * TEXT_000: Chuy·ªÉn s·ªë th√†nh chu·ªói 3 k√Ω t·ª± (v√≠ d·ª•: 5 -> "005"). √Åp d·ª•ng cho K, L, M.
 * YEAR_LAST_DIGIT: L·∫•y s·ªë cu·ªëi c√πng c·ªßa nƒÉm (v√≠ d·ª•: 2025 -> 5). √Åp d·ª•ng cho N.
<!-- end list -->
' ------------------------------------------------------------------------------------------
' FUNCTION 4: TRANSFORM DATA (Apply logic to change values)
' ------------------------------------------------------------------------------------------
' Mapping Format: "ColIndex|OperationCode"
' Supported Codes:
' - TEXT_000        : Converts 5 -> "005" (Text format)
' - YEAR_LAST_DIGIT : Converts 2025 -> 5, 2026 -> 6
' ------------------------------------------------------------------------------------------
Public Function TransformColumnData(ByVal DestinationPath As String, _
                                    ByVal TransformMapping As String) As String

    Dim wbDest As Workbook
    Dim wsDest As Worksheet
    Dim arrMapping As Variant
    Dim arrPair As Variant
    Dim lDestIndex As Long
    Dim sOperation As String
    Dim lLastRow As Long
    Dim lHeaderRow As Long
    Dim i As Long
    Dim rng As Range, cell As Range
    Dim vValue As Variant

    TransformColumnData = "Success"
    On Error GoTo ErrorHandler

    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    ' Open Destination Workbook
    Set wbDest = Workbooks.Open(DestinationPath)
    Set wsDest = wbDest.Sheets(1)
    lHeaderRow = 1

    ' Determine the last used row
    On Error Resume Next
    lLastRow = wsDest.Cells.Find(What:="*", After:=wsDest.Range("A1"), _
               LookIn:=xlValues, LookAt:=xlPart, SearchOrder:=xlByRows, _
               SearchDirection:=xlPrevious).Row
    On Error GoTo ErrorHandler

    If lLastRow <= lHeaderRow Then
        TransformColumnData = "Success (No Data Rows Found)"
        GoTo Finalize
    End If

    ' --- Process Mapping (Using "#" delimiter) ---
    arrMapping = Split(TransformMapping, "#")

    ' --- Start Transformation Process ---
    For i = LBound(arrMapping) To UBound(arrMapping)
        If Trim(arrMapping(i)) <> "" Then
            ' Split pair using "|" delimiter
            arrPair = Split(arrMapping(i), "|")
            
            If UBound(arrPair) = 1 Then
                ' Get Column Index
                On Error Resume Next
                lDestIndex = CLng(Trim(arrPair(0)))
                On Error GoTo ErrorHandler
                
                ' Get Operation Code
                sOperation = UCase(Trim(arrPair(1))) ' Convert to Uppercase for check
                
                If lDestIndex > 0 Then
                    ' Define Range to process
                    Set rng = wsDest.Range(wsDest.Cells(lHeaderRow + 1, lDestIndex), wsDest.Cells(lLastRow, lDestIndex))
                    
                    ' Loop through each cell to apply logic
                    ' (Looping is necessary for value transformation based on logic)
                    For Each cell In rng
                        vValue = cell.Value
                        
                        If Not IsError(vValue) And Len(CStr(vValue)) > 0 Then
                            Select Case sOperation
                                Case "TEXT_000"
                                    ' Force Cell to Text Format first
                                    cell.NumberFormat = "@"
                                    ' Format value to 000 (e.g., 5 -> "005")
                                    If IsNumeric(vValue) Then
                                        cell.Value = Format(vValue, "000")
                                    End If
                                    
                                Case "YEAR_LAST_DIGIT"
                                    ' Logic: Take the last character of the year
                                    ' Handle 2025 (number) or Date format
                                    Dim sYear As String
                                    If IsDate(vValue) Then
                                        sYear = CStr(Year(vValue))
                                    Else
                                        sYear = CStr(vValue)
                                    End If
                                    
                                    ' Take rightmost character
                                    If Len(sYear) > 0 Then
                                        cell.Value = Right(sYear, 1)
                                    End If
                            End Select
                        End If
                    Next cell
                End If
            End If
        End If
    Next

    ' Save changes
    wbDest.Save

Finalize:
    wbDest.Close SaveChanges:=False
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    Exit Function

ErrorHandler:
    Dim sErrorLog As String
    sErrorLog = "VBA Runtime Error: " & Err.Description
    TransformColumnData = "Fatal Error: " & sErrorLog
    
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    On Error Resume Next
    If Not wbDest Is Nothing Then wbDest.Close SaveChanges:=False
End Function

2. ü§ñ C·∫•u h√¨nh trong Power Automate Desktop (PAD)
B·∫°n c·∫ßn x√°c ƒë·ªãnh Index c·ªßa c√°c c·ªôt K, L, M, N:
 * K = 11
 * L = 12
 * M = 13
 * N = 14
B∆∞·ªõc 1: T·∫°o bi·∫øn Mapping cho Transform (%TransformMapping%)
Trong PAD, b·∫°n t·∫°o bi·∫øn Set variable v·ªõi gi√° tr·ªã sau:
 * Variable Name: %TransformMapping%
 * Value:
   11|TEXT_000#12|TEXT_000#13|TEXT_000#14|YEAR_LAST_DIGIT
   (Gi·∫£i th√≠ch: C·ªôt 11, 12, 13 d√πng logic format 3 s·ªë 0. C·ªôt 14 d√πng logic l·∫•y s·ªë cu·ªëi c·ªßa nƒÉm).
B∆∞·ªõc 2: G·ªçi Macro Transform (Sau khi Copy/Fill)
Th√™m h√†nh ƒë·ªông n√†y v√†o Flow c·ªßa b·∫°n (sau b∆∞·ªõc Fill Default):
 * Action: Run Excel macro
   * Excel instance: %ExcelInstance%
   * Macro name: TransformColumnData
   * Macro arguments: %DestPath%; %TransformMapping%
   * Variables produced: %TransformResult%
 * Action: If (Ki·ªÉm tra l·ªói)
   * If %TransformResult% Not Contains Success -> Display Message Error.
T√≥m t·∫Øt lu·ªìng x·ª≠ l√Ω d·ªØ li·ªáu c·ªßa b·∫°n hi·ªán t·∫°i:
 * Copy Data: L·∫•y d·ªØ li·ªáu th√¥ t·ª´ ngu·ªìn.
 * Fill Default: ƒêi·ªÅn c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh cho c·ªôt tr·ªëng.
 * Format (T√πy ch·ªçn): Format ng√†y th√°ng th√¥ng th∆∞·ªùng (dd/mm/yyyy).
 * Transform (M·ªõi): Bi·∫øn ƒë·ªïi d·ªØ li·ªáu ph·ª©c t·∫°p (2025 -> 5, 5 -> "005").
Code n√†y ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u ƒë·ªÉ x·ª≠ l√Ω ch√≠nh x√°c y√™u c·∫ßu "2025 th√†nh 5" v√† "'005" d·∫°ng Text c·ªßa b·∫°n.
                       
